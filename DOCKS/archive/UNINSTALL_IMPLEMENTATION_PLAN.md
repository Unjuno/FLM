# FLM - アンインストール機能実装計画

**目的**: アプリケーションのアンインストール時にユーザーデータを完全に削除する機能を実装

---

## 📊 現在の状況

### ✅ 実装済み
- **インストーラー標準機能**: MSI/NSISは標準でアンインストール機能を提供
- **データ保存場所の明確化**: `get_app_data_dir()`でOS別のデータ保存場所を取得

### ❌ 未実装
- **カスタムアンインストールスクリプト**: ユーザーデータの削除機能がない
- **アプリケーション内のアンインストール機能**: 設定からアンインストールする機能がない
- **データ削除の確認**: ユーザーに削除確認を求める機能がない

---

## 📋 データ保存場所

### Windows
- **データベース**: `%LOCALAPPDATA%\FLM\flm.db`
- **データディレクトリ**: `%LOCALAPPDATA%\FLM\`
- **WALファイル**: `%LOCALAPPDATA%\FLM\flm.db-wal`, `flm.db-shm`

### macOS
- **データベース**: `~/Library/Application Support/FLM/flm.db`
- **データディレクトリ**: `~/Library/Application Support/FLM/`

### Linux
- **データベース**: `~/.local/share/FLM/flm.db`
- **データディレクトリ**: `~/.local/share/FLM/`

---

## 🎯 実装計画

### Phase 1: アンインストールコマンドの実装（バックエンド）

#### 1.1 IPCコマンドの追加

**ファイル**: `src-tauri/src/commands/uninstall.rs` (新規作成)

**機能**:
- データディレクトリの削除
- データベースファイルの削除
- 関連ファイルの削除（WAL、SHM、ログファイル等）

#### 1.2 データクリーンアップ関数

**実装内容**:
- アプリケーションデータディレクトリ全体を削除
- エラーハンドリング（ファイルが使用中の場合等）

---

### Phase 2: アンインストールUIの実装（フロントエンド）

#### 2.1 設定画面にアンインストールボタンを追加

**ファイル**: `src/pages/Settings.tsx` (新規作成または既存を拡張)

**機能**:
- アンインストール確認ダイアログ
- データ削除確認チェックボックス
- アンインストール実行

---

### Phase 3: インストーラーのカスタムアンインストールスクリプト（オプション）

#### 3.1 NSISアンインストールスクリプト

**目的**: インストーラーからアンインストールする際に自動でデータを削除

**実装方法**: TauriのNSISカスタムスクリプト機能を使用

---

## 🔧 実装詳細

### 削除対象ファイル・ディレクトリ

1. **データベースファイル**
   - `flm.db`
   - `flm.db-wal` (WALモード時のログファイル)
   - `flm.db-shm` (WALモード時の共有メモリファイル)

2. **設定ファイル** (将来実装される場合)
   - `config.json`
   - その他の設定ファイル

3. **ログファイル** (将来実装される場合)
   - `app.log`
   - その他のログファイル

4. **一時ファイル**
   - ダウンロード中のファイル
   - 一時キャッシュ

5. **データディレクトリ全体**
   - `%LOCALAPPDATA%\FLM\` (Windows)
   - `~/Library/Application Support/FLM/` (macOS)
   - `~/.local/share/FLM/` (Linux)

---

## 📝 実装チェックリスト

### バックエンド
- [ ] アンインストールコマンドの実装 (`commands/uninstall.rs`)
- [ ] データクリーンアップ関数の実装
- [ ] エラーハンドリング
- [ ] IPCコマンドの登録

### フロントエンド
- [ ] 設定画面の作成/拡張
- [ ] アンインストール確認ダイアログ
- [ ] データ削除確認UI
- [ ] エラーメッセージ表示

### ドキュメント
- [ ] アンインストール手順の更新
- [ ] データ保存場所の明記
- [ ] トラブルシューティングガイドの更新

---

## ⚠️ 注意事項

1. **データ削除の確認**: ユーザーに必ず確認を求める
2. **実行中のプロセスの停止**: アンインストール前に実行中のAPIやプロキシを停止
3. **Ollamaデータ**: Ollamaのモデルデータは削除しない（Ollamaは別アプリ）
4. **エラーハンドリング**: ファイルが使用中などのエラーを適切に処理

---

## 🚀 実装の優先順位

### 優先度: 高
1. **アンインストールコマンドの実装** - バックエンドのコア機能
2. **設定画面の実装** - ユーザーがアクセスできるUI

### 優先度: 中
3. **インストーラーのカスタムスクリプト** - より完全なアンインストール

---

## 📋 次のステップ

1. `src-tauri/src/commands/uninstall.rs` を作成
2. IPCコマンドを `lib.rs` に登録
3. 設定画面 (`src/pages/Settings.tsx`) を作成
4. アンインストール機能のテスト
