# FLM - AIエージェント構成設計書

## 文書情報

- **プロジェクト名**: FLM
- **バージョン**: 1.0.0
- **作成日**: 2024年
- **目的**: 複数AIエージェントによる効率的な開発構成の設計

---

## 目次

1. [エージェント構成の概要](#エージェント構成の概要)
2. [エージェントの役割定義](#エージェントの役割定義)
3. [開発フェーズ別の構成](#開発フェーズ別の構成)
4. [並列実行戦略](#並列実行戦略)
5. [品質保証フロー](#品質保証フロー)
6. [エージェント間のコミュニケーション](#エージェント間のコミュニケーション)
7. [推奨実装順序](#推奨実装順序)

---

## エージェント構成の概要

### 基本方針

**「最短時間 × 最高品質」を実現するために、専門性の高いエージェントで並列開発**

### 構成の特徴

1. **専門性の高い役割分担**: 各エージェントが特定の技術領域に特化
2. **並列実行可能な設計**: 依存関係の少ない部分を同時に開発
3. **品質保証の二重チェック**: 実装エージェント + レビューエージェント
4. **統合・検証の自動化**: 継続的な統合と品質確認

---

## エージェントの役割定義

### 1. アーキテクト/設計エージェント (Architect Agent)

**役割**: 
- システム全体のアーキテクチャ設計
- 技術選定の最終決定
- モジュール間のインターフェース定義
- 開発方針の統一

**担当領域**:
- Tauri vs Electron の最終選定（技術検証結果を基に決定）
- フロントエンド・バックエンド・認証プロキシ間の通信仕様
- データベーススキーマ設計
- IPC (Inter-Process Communication) 仕様

**出力物**:
- `ARCHITECTURE.md`: システムアーキテクチャ設計書
- `INTERFACE_SPEC.md`: モジュール間インターフェース仕様
- `DATABASE_SCHEMA.sql`: SQLiteスキーマ定義

**必要知識**:
- Tauri/Electron アーキテクチャ
- Rust + TypeScript/JavaScript の統合方法
- SQLite データベース設計
- IPC 通信のベストプラクティス

---

### 2. フロントエンド開発エージェント (Frontend Agent)

**役割**:
- Tauri フロントエンド（React/Vue）の実装
- UI コンポーネントの開発
- ユーザーインターフェースの実装
- IPC クライアント側の実装

**担当機能**:
- F001: API作成機能のUI部分
- F002: API利用機能のUI部分
- F003: API管理機能のUI部分
- F004: モデル管理機能のUI部分
- F008: 公式Webサイト（HTML/CSS/JavaScriptのみ）

**担当ファイル（推定）**:
- `src/frontend/`: React/Vue コンポーネント
- `src/components/`: UIコンポーネント
- `src/pages/`: ページコンポーネント
- `src/hooks/`: カスタムフック（状態管理、IPC呼び出し）
- `WEB/`: 公式Webサイト（静的HTML/CSS/JavaScript）

**必要知識**:
- React または Vue.js
- TypeScript/JavaScript
- Tauri IPC クライアント API
- モダンなUI/UXデザインパターン
- 非開発者向けUI設計（専門用語の排除、ガイド表示）

---

### 3. バックエンド開発エージェント (Backend Agent)

**役割**:
- Tauri Rust バックエンドの実装
- Ollama プロセス管理
- ファイルシステム操作
- IPC サーバー側の実装

**担当機能**:
- F009: Ollama自動インストール機能（最優先）
- F001: API作成機能のバックエンド部分（Ollama起動、プロセス管理）
- F003: API管理機能のバックエンド部分（起動/停止）
- ファイルダウンロード・解凍・実行権限設定

**担当ファイル（推定）**:
- `src-tauri/src/`: Rust バックエンドコード
- `src-tauri/src/commands.rs`: Tauri コマンド定義
- `src-tauri/src/ollama.rs`: Ollama 統合モジュール
- `src-tauri/src/database.rs`: SQLite 操作モジュール

**必要知識**:
- Rust プログラミング言語
- Tauri フレームワーク
- プロセス管理（std::process、tokio）
- ファイルシステム操作
- クロスプラットフォーム対応（Windows/macOS/Linux）

---

### 4. 認証・セキュリティエージェント (Auth Agent)

**役割**:
- 認証プロキシ（Express.js）の実装
- APIキー生成・検証ロジック
- セキュリティベストプラクティスの実装
- Ollama API へのプロキシ実装

**担当機能**:
- F005: 認証機能（APIキー生成・検証）
- 認証プロキシサーバー（express-http-proxy）
- OpenAI互換APIエンドポイント実装

**担当ファイル（推定）**:
- `src/backend/auth/`: 認証プロキシコード
- `src/backend/auth/proxy.ts`: HTTPプロキシ実装
- `src/backend/auth/keygen.ts`: APIキー生成
- `src/backend/auth/validator.ts`: APIキー検証

**必要知識**:
- Node.js + Express.js
- HTTP プロキシの実装
- JWT/APIキー認証
- OpenAI API 仕様の理解
- セキュリティベストプラクティス

---

### 5. データベース・データ管理エージェント (Database Agent)

**役割**:
- SQLite スキーマ設計・実装
- データアクセス層の実装
- モデルカタログ情報の管理
- データマイグレーション

**担当機能**:
- データベーススキーマ実装
- API設定の永続化
- モデル情報のキャッシュ管理（F004の一部）
- ログ保存（F006、将来実装）

**担当ファイル（推定）**:
- `src-tauri/src/database/schema.sql`: SQLite スキーマ
- `src-tauri/src/database/migrations/`: データマイグレーション
- `src-tauri/src/database/models.rs`: データモデル定義
- `src-tauri/src/database/repository.rs`: データアクセス層

**必要知識**:
- SQLite データベース設計
- Rust SQLite ライブラリ（rusqlite 等）
- データマイグレーション戦略
- データ整合性保証

---

### 6. テスト・品質保証エージェント (QA Agent)

**役割**:
- 単体テストの作成・実行
- 統合テストの作成・実行
- E2E テストの作成・実行
- コード品質チェック（リント、型チェック）

**担当タスク**:
- 各機能のテストケース作成
- テスト自動化の実装
- CI/CD パイプラインの設定
- カバレッジレポートの生成

**担当ファイル（推定）**:
- `tests/`: テストコード
- `tests/unit/`: 単体テスト
- `tests/integration/`: 統合テスト
- `tests/e2e/`: E2E テスト
- `.github/workflows/`: CI/CD 設定

**必要知識**:
- Jest（JavaScript テスト）
- Pytest（Python テスト、必要に応じて）
- Playwright（E2E テスト）
- CI/CD ベストプラクティス

---

### 7. 統合・デプロイエージェント (DevOps Agent)

**役割**:
- モジュール間の統合
- ビルド・パッケージングの自動化
- クロスプラットフォームビルド設定
- インストーラーの生成

**担当タスク**:
- Tauri ビルド設定の最適化
- Windows インストーラー生成（.exe）
- macOS インストーラー生成（.dmg、将来）
- Linux インストーラー生成（.AppImage、将来）
- GitHub Actions の設定

**担当ファイル（推定）**:
- `tauri.conf.json`: Tauri 設定
- `.github/workflows/build.yml`: ビルド自動化
- `package.json`: ビルドスクリプト

**必要知識**:
- Tauri ビルドプロセス
- クロスプラットフォームビルド
- GitHub Actions
- インストーラー生成（electron-builder、Tauri CLI）

---

### 8. ドキュメント・UXエージェント (Documentation Agent)

**役割**:
- ユーザー向けドキュメント作成
- 開発者向けドキュメント作成
- UI/UX 設計の検証
- 非開発者向け用語の統一

**担当タスク**:
- 使い方ガイドの作成
- API ドキュメント生成
- README.md の作成・更新
- エラーメッセージのレビュー（非開発者向けの表現）

**担当ファイル（推定）**:
- `docs/`: ドキュメントディレクトリ
- `docs/user-guide.md`: ユーザーガイド
- `docs/developer-guide.md`: 開発者ガイド
- `README.md`: プロジェクト概要

**必要知識**:
- 技術文書作成のベストプラクティス
- 非開発者向けの説明技術
- Markdown 記法

---

## 開発フェーズ別の構成

### フェーズ1: 技術検証・基盤構築（1-2週間）

**目標**: Tauri vs Electron の選定、プロジェクト初期化

**エージェント構成**:
1. **アーキテクトエージェント**: 技術選定、アーキテクチャ設計
2. **バックエンドエージェント**: Tauri プロジェクト初期化、基本的なIPC実装
3. **フロントエンドエージェント**: 基本的なUIフレームワーク設定

**並列実行**:
- アーキテクトエージェント → バックエンドエージェント + フロントエンドエージェント

**出力物**:
- プロジェクト構造
- 基本的なIPC通信の実装
- 技術選定レポート

---

### フェーズ2: 基盤機能実装（2-3週間）

**目標**: データベース、認証プロキシ、Ollama統合の基盤

**エージェント構成**:
1. **データベースエージェント**: SQLite スキーマ実装、データアクセス層
2. **認証エージェント**: 認証プロキシの基本実装
3. **バックエンドエージェント**: Ollama統合モジュール（F009最優先）

**並列実行**:
- データベースエージェント || 認証エージェント || バックエンドエージェント（独立）

**出力物**:
- SQLite スキーマ
- 認証プロキシサーバー（基本機能）
- Ollama自動インストール機能（F009）

---

### フェーズ3: コア機能実装（4-6週間）

**目標**: MVP 必須機能の実装

**エージェント構成**:

#### 並列グループ1: API関連機能（F001, F002, F003）
- **フロントエンドエージェント**: API作成・利用・管理のUI実装
- **バックエンドエージェント**: API作成・管理のバックエンド実装
- **認証エージェント**: API利用時の認証プロキシ統合

#### 並列グループ2: モデル管理機能（F004）
- **フロントエンドエージェント**: モデル管理UI（検索・ダウンロード・一覧）
- **バックエンドエージェント**: Ollama API統合（モデル一覧・ダウンロード）
- **データベースエージェント**: モデルカタログ情報のキャッシュ管理

**並列実行**:
- グループ1 || グループ2（独立）
- 各グループ内は依存関係に注意して並列実行

**出力物**:
- F001: API作成機能（完全実装）
- F002: API利用機能（完全実装）
- F003: API管理機能（完全実装）
- F004: モデル管理機能（完全実装）
- F005: 認証機能（完全実装）

---

### フェーズ4: 統合・テスト・品質保証（2-3週間）

**目標**: 全体統合、テスト、品質向上

**エージェント構成**:
1. **統合エージェント**: 全モジュールの統合、ビルド設定
2. **QAエージェント**: テスト作成・実行、品質チェック
3. **ドキュメントエージェント**: ドキュメント作成、UX検証
4. **フロントエンドエージェント**: UI/UX改善、バグ修正
5. **バックエンドエージェント**: パフォーマンス最適化、バグ修正

**並列実行**:
- 統合エージェント → QAエージェント（統合後にテスト）
- ドキュメントエージェント（独立）
- フロントエンドエージェント + バックエンドエージェント（フィードバックベースで改善）

**出力物**:
- 統合されたアプリケーション
- テストスイート（カバレッジ80%以上）
- ユーザーガイド
- ビルド可能なパッケージ（Windows .exe）

---

### フェーズ5: 公式Webサイト実装（1-2週間、並列可能）

**目標**: 公式Webサイト（F008）の実装

**エージェント構成**:
1. **フロントエンドエージェント**: 静的HTML/CSS/JavaScriptサイト実装
2. **ドキュメントエージェント**: サイトコンテンツの作成

**並列実行**:
- フロントエンドエージェント || ドキュメントエージェント（コンテンツ作成）

**出力物**:
- 公式Webサイト（GitHub Pages対応）

---

## 並列実行戦略

### 依存関係の最小化

**原則**: 依存関係の少ない機能を優先的に並列実行

**独立して実装可能な機能**:
1. **データベーススキーマ** ← 他の機能に依存しない
2. **認証プロキシ基本機能** ← Ollama統合以外は独立
3. **公式Webサイト** ← アプリ本体と完全独立
4. **ドキュメント** ← 実装完了後でも並列可能

**依存関係がある機能**:
- API作成機能（F001）: Ollama統合 ← バックエンドエージェントが先
- API利用機能（F002）: 認証プロキシ ← 認証エージェントが先
- モデル管理機能（F004）: Ollama統合 ← バックエンドエージェントが先

### 並列実行の例

```
週1-2: 技術検証・基盤構築
├─ アーキテクトエージェント (技術選定)
└─ バックエンドエージェント (プロジェクト初期化) || フロントエンドエージェント (UI設定)

週3-4: 基盤機能実装
├─ データベースエージェント (SQLiteスキーマ)
├─ 認証エージェント (認証プロキシ基本)
└─ バックエンドエージェント (Ollama統合、F009)

週5-10: コア機能実装
├─ [グループ1] API機能 (F001, F002, F003)
│  ├─ フロントエンドエージェント (UI)
│  ├─ バックエンドエージェント (バックエンド)
│  └─ 認証エージェント (認証統合)
└─ [グループ2] モデル管理 (F004)
   ├─ フロントエンドエージェント (UI)
   ├─ バックエンドエージェント (Ollama API統合)
   └─ データベースエージェント (キャッシュ)

週11-13: 統合・テスト・品質保証
├─ 統合エージェント (統合)
├─ QAエージェント (テスト作成・実行)
├─ ドキュメントエージェント (ドキュメント作成)
└─ フロントエンド・バックエンドエージェント (改善・修正)

週14-15: 公式Webサイト (並列)
└─ フロントエンドエージェント (サイト実装) || ドキュメントエージェント (コンテンツ)
```

---

## 品質保証フロー

### 二段階レビュープロセス

**ステップ1: 実装エージェント**
- 機能実装
- 基本的な単体テスト作成
- リント・型チェック通過

**ステップ2: QAエージェント**
- コードレビュー
- 追加テストケースの提案
- 統合テストの作成
- パフォーマンステスト

**ステップ3: 統合エージェント（必要に応じて）**
- モジュール間の統合検証
- エンドツーエンドテスト

### 品質チェックリスト

各エージェントは実装時に以下を確認:

- [ ] コードスタイル（リント通過）
- [ ] 型安全性（TypeScript型チェック通過）
- [ ] 基本的なエラーハンドリング
- [ ] 非開発者向けのエラーメッセージ（専門用語の排除）
- [ ] 基本的な単体テスト
- [ ] ドキュメントコメント（関数・クラス）

---

## エージェント間のコミュニケーション

### コミュニケーションチャネル

1. **共有ドキュメント**:
   - `ARCHITECTURE.md`: アーキテクチャ設計（アーキテクトエージェントが管理）
   - `INTERFACE_SPEC.md`: モジュール間インターフェース仕様
   - `DATABASE_SCHEMA.sql`: データベーススキーマ（データベースエージェントが管理）
   - `API_SPEC.md`: API仕様（認証エージェントが管理）

2. **コードレビュー**:
   - GitHub Pull Request（各エージェントが実装後、QAエージェントがレビュー）

3. **定期的な同期**:
   - 週次進捗報告（各エージェントが担当機能の進捗を報告）
   - 依存関係の調整（必要な場合のみ）

### インターフェース定義の優先度

**最優先**: モジュール間インターフェース（IPC、データベーススキーマ、API仕様）
- アーキテクトエージェントが先に設計
- 実装エージェントがその仕様に従って実装

**次優先**: UI/UX仕様
- フロントエンドエージェントが UI_MAP.md に基づいて実装
- 必要に応じてドキュメントエージェントがレビュー

---

## 推奨実装順序

### MVP 優先度順（実装順序）

1. **最優先（フェーズ2）**:
   - F009: Ollama自動インストール機能
   - 理由: 他の機能の前提条件、非開発者体験のため必須

2. **高優先（フェーズ3 - 並列グループ1）**:
   - F001: API作成機能
   - F005: 認証機能
   - 理由: コア機能、MVPの最重要機能

3. **高優先（フェーズ3 - 並列グループ1）**:
   - F002: API利用機能
   - F003: API管理機能
   - 理由: F001とセットで必要

4. **高優先（フェーズ3 - 並列グループ2）**:
   - F004: モデル管理機能
   - 理由: API作成に必要な機能（モデル選択）

5. **中優先（フェーズ5、並列実行）**:
   - F008: 公式Webサイト
   - 理由: アプリ本体と独立、並列実装可能

---

## エージェント使用のベストプラクティス

### 1. 明確な役割分担
- 各エージェントは自分の担当領域に集中
- 他エージェントの領域に踏み込まない（必要に応じて相談）

### 2. ドキュメント優先
- 実装前にインターフェース仕様を明確化
- 変更時はドキュメントを先に更新

### 3. 並列実行の最大化
- 依存関係の少ない機能は同時に実装
- 統合・テストは最後にまとめて実施

### 4. 品質の継続的確認
- 実装後すぐにQAエージェントがレビュー
- 問題は早期発見・早期修正

### 5. 非開発者体験の徹底
- 全てのエージェントが非開発者向けのUXを意識
- 専門用語の排除、わかりやすいエラーメッセージ

---

## 想定開発期間（最適化後）

### 従来の直列開発: 約12-16週間
- フェーズ1: 2週間
- フェーズ2: 3週間
- フェーズ3: 6-8週間
- フェーズ4: 3週間
- フェーズ5: 2週間

### エージェント並列開発: 約8-11週間（約30%短縮）

**内訳**:
- フェーズ1: 1-2週間（並列実行で短縮）
- フェーズ2: 2週間（3エージェント並列）
- フェーズ3: 4-5週間（2グループ並列）
- フェーズ4: 2-3週間（統合・テスト）
- フェーズ5: 1週間（公式サイト、アプリ本体と並列）

**短縮の根拠**:
- 基盤機能の並列実装（データベース、認証、Ollama統合）
- コア機能の2グループ並列実装
- 公式サイトの完全並列実装

---

## まとめ

### 最適なエージェント構成

1. **8つの専門エージェント**: アーキテクト、フロントエンド、バックエンド、認証、データベース、QA、統合、ドキュメント
2. **並列実行の最大化**: 依存関係の少ない機能を同時実装
3. **品質保証の二重チェック**: 実装エージェント + QAエージェント
4. **明確な役割分担**: 各エージェントが特定領域に特化

### 期待される効果

- **開発期間の短縮**: 約30%削減（12-16週間 → 8-11週間）
- **品質の向上**: 専門性の高いエージェントによる実装、二重レビュー
- **並列実行**: 複数エージェントによる同時開発
- **非開発者体験の徹底**: 全エージェントがUXを意識

---

**この構成により、最短時間で最高品質のFLMアプリケーションを実現できます。**

