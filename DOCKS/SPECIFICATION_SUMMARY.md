# FLM - 仕様明確化サマリー

## 📋 仕様の明確化 - 主要ポイント

### 🎯 **プロジェクト目標**

**FLMは、初心者でも外部に公開して使える安全なAPIが、インストールして実行するだけで手に入るデスクトップアプリケーション**

技術知識がなくても、コードを書かずに、直感的なUIでローカルLLMのAPIを作成・デプロイし、そのAPIを外部からも安全に利用できます。セキュリティ設定（APIキー認証など）は自動化されているため、ユーザーは意識せずに安全なAPIを作成・公開できます。

**実現目標**: 初心者が5分以内で外部からも利用可能な安全なローカルLLM APIを作成できる

---

### 🏗️ **システムアーキテクチャ（確定）**

```
FLM (Tauri)
  ↓ IPC (React/Vue Frontend)
認証プロキシ (express-http-proxy)
  ↓ HTTP (認証済み)
Ollama REST API
  ↓
ローカルLLMモデル (Ollama管理)
```

**確定事項**:
- ✅ **UI**: Tauri（推奨、最終選定は技術検証後）
- ✅ **LLM実行**: Ollama（必須、ユーザー事前インストール）
- ✅ **認証**: Express.js + express-http-proxy（OSS）
- ✅ **データ保存**: SQLite（OSS）

---

### 🔧 **主要機能仕様（8機能）**

#### **F001: API作成機能（優先度: 最高）**
**実装方法**: 
- Ollama API (`GET /api/tags`) でモデル一覧取得
- ユーザーがモデル選択 → 設定入力 → 「作成」ボタン
- Ollama起動 → 認証プロキシ起動 → API情報表示

**UIフロー**: 
ホーム画面 → 「新しいAPIを作成」 → モデル選択 → 設定 → 「作成」 → 進行中表示 → 成功画面

---

#### **F002: API利用機能（優先度: 最高）**
**実装方法**:
- 作成済みAPIの一覧表示（SQLiteから読み込み）
- テスト用チャットインターフェース: 認証プロキシ経由でOllama API (`POST /api/chat`) を呼び出し
- API情報表示: エンドポイントURL、APIキー、サンプルコード

---

#### **F003: API管理機能（優先度: 高）**
**実装方法**:
- 起動/停止: Ollamaプロセスの起動・停止をTauriバックエンドで管理
- 設定変更: SQLiteの設定データを更新
- 削除: SQLiteから削除、Ollamaプロセス停止

---

#### **F004: モデル管理機能（優先度: 高）**
**実装方法**:
- **モデル一覧**: Ollama API (`GET /api/tags`) を呼び出し
- **モデルダウンロード**: Ollama API (`POST /api/pull`) を呼び出し、ストリーミング進捗をUIに表示
- **モデル削除**: Ollama API (`POST /api/delete`) を呼び出し
- **保存場所**: Ollamaのデフォルト（Windows: `%USERPROFILE%\.ollama\models\`）

---

#### **F005: 認証機能（優先度: 高）**
**実装方法**:
- APIキー生成: crypto（Node.js標準）でランダム文字列生成（32文字以上）
- 認証プロキシ: express-http-proxyでAPIキー検証 → Ollama APIへ転送
- 保存: SQLiteに暗号化して保存

---

#### **F006: ログ表示（優先度: 中、v1.1実装）**
**実装方法**: 
- 認証プロキシでリクエスト/レスポンスをログに記録
- SQLiteに保存、UIで表示・フィルタリング

---

#### **F007: パフォーマンス監視（優先度: 低、v1.1実装）**
**実装方法**: 
- リクエスト数、レスポンス時間、エラー率を集計
- SQLiteに記録、ダッシュボードで表示

---

#### **F008: 公式Webサイト（優先度: 高）**
**実装方法**:
- **技術**: HTML、CSS、JavaScriptのみ（静的サイト）
- **ホスティング**: GitHub Pages（無料）
- **必須ページ**: ホーム、ダウンロード、機能紹介、ドキュメント

**詳細仕様**: `DOCKS/公式サイト仕様書.md` を参照

---

### 🛠️ **技術仕様（確定事項）**

#### **OSS選定の確定**

| カテゴリ | 選定OSS | 理由 | 実装方法 |
|---------|---------|------|----------|
| **UIフレームワーク** | Tauri（推奨） | 軽量、インストーラー自動生成 | React/Vue + Rustバックエンド |
| **LLM実行** | Ollama（必須） | REST API提供、OpenAI互換 | ユーザー事前インストール、API直接利用 |
| **認証プロキシ** | Express.js + express-http-proxy | OSS、軽量 | Node.jsで実装 |
| **データベース** | SQLite | 軽量、OSS | 設定・APIキー保存 |
| **モデル管理** | Ollama API | 既存機能利用 | API直接呼び出し |

#### **OSS優先の判断基準（確定）**

1. **最優先**: 既存OSSの直接利用（例: Ollama API）
2. **次優先**: OSSライブラリの統合（例: JWTライブラリ）
3. **第3優先**: OSSフレームワークを使用（例: Tauri）
4. **最後の手段**: 独自実装（OSSが存在しない場合のみ）

**例外条件**: OSSで機能要件を満たせない場合のみプロプライエタリ検討（理由を文書化）

---

### 📅 **開発計画（明確化）**

#### **MVP（3-4ヶ月）**

**必須機能（確定）**:
- ✅ F001: API作成（Ollama統合）
- ✅ F002: API利用（基本テスト）
- ✅ F003: API管理（起動/停止）
- ✅ F004: モデル管理（Ollama API経由）
- ✅ F005: 認証（基本APIキー生成）

**技術スタック（MVP、確定）**:
- UI: **Tauri**（技術検証後確定）またはElectron（代替案）
- LLM実行: **Ollama**（必須、ユーザー事前インストール）
- 認証: **express-http-proxy**（OSS）
- データ保存: **SQLite**（OSS）
- OS対応: **Windowsのみ**（初期実装）

**除外機能（確定）**:
- ❌ F006: ログ表示 → v1.1で実装
- ❌ F007: パフォーマンス監視 → v1.1で実装
- ❌ macOS/Linux対応 → v1.0で実装
- ❌ 高度な認証（OAuth等） → v2.0で実装

#### **v1.0（MVP後2-3ヶ月）**

**追加機能（確定）**:
- ✅ 全コア機能実装（F006、F007含む）
- ✅ クロスプラットフォーム対応（macOS、Linux）
- ✅ 高度なエラーハンドリング
- ✅ 使い方ガイド自動生成

---

### 🔒 **セキュリティ仕様（明確化）**

1. **APIキー**:
   - 長さ: 32文字以上
   - 生成: crypto（Node.js標準）でランダム生成
   - 保存: SQLiteに暗号化保存
   - 認証: Bearer Token形式

2. **通信**:
   - デフォルト: `localhost:8080`（ローカルホストのみ）
   - 外部アクセス: 基本的に許可しない
   - HTTPS: 将来的に検討（自己署名証明書）

3. **データ保護**:
   - モデルファイル: Ollamaが管理（暗号化不要、ローカル保存）
   - ログ: 個人情報自動マスキング（将来的に）

---

### ⚡ **パフォーマンス要件（明確化）**

- **API作成**: 30秒以内（モデルインストール済みの場合）
- **API起動**: 10秒以内
- **APIレスポンス**: モデル依存（目標: 1-5秒）
- **メモリ**: 使用モデルサイズ + 2GB（アプリ自体）
- **CPU**: アイドル時 < 5%
- **同時リクエスト**: 初期実装は1リクエスト/秒

---

### 🌐 **公式Webサイト仕様（明確化）**

**技術**: HTML、CSS、JavaScriptのみ（静的サイト、フレームワーク不使用）

**重要**: React、Vue等のフレームワークは使用しません。純粋なHTML/CSS/JavaScriptのみで実装します。

**必須ページ**:
1. ホームページ（index.html）
2. ダウンロードページ（download.html）
3. 機能紹介ページ（features.html）
4. ドキュメント・チュートリアル

**必須機能**:
- OS自動検出（JavaScriptで適切なインストーラーを推奨）
- バージョン情報表示
- レスポンシブデザイン

**ホスティング**: GitHub Pages（無料、OSSプロジェクト向け）

---

### 📊 **OSS活用による工数削減（確定）**

| フェーズ | 使用OSS | 削減工数 |
|---------|---------|---------|
| LLM実行エンジン | Ollama | 4-6週間 → 2-3週間 |
| UIフレームワーク | Tauri | 6-8週間 → 4-5週間 |
| インストーラー作成 | Tauri内蔵 | 2-3週間 → 1週間 |
| APIサーバー実装 | Ollama API直接利用 | 4-5週間 → 1-2週間 |

**合計削減効果**: 約2.5-4ヶ月（約30-40%削減）

---

### ✅ **実装前の確定事項**

1. **Tauri vs Electron**: 1週間の技術検証（プロトタイプ作成）で最終決定
2. **Ollama**: 必須（ユーザー事前インストール、API直接利用）
3. **認証プロキシ**: Express.js + express-http-proxy（確定）
4. **データ保存**: SQLite（確定）
5. **MVP範囲**: Windowsのみ、基本機能のみ（確定）

---

### 📝 **仕様変更の管理**

**変更履歴**: SPECIFICATION.mdの「変更履歴」に全て記録

**現在のバージョン**: 1.2.1
- 1.0.0: 初版作成
- 1.1.0: OSS統合方法の詳細化
- 1.2.0: 公式Webサイト仕様追加
- 1.2.1: OSS優先の判断基準明確化

---

**この仕様サマリーは、SPECIFICATION.mdの主要な確定事項を明確化したものです。**
