# FLM - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“‹ æ–‡æ›¸æƒ…å ±

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: FLM
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
- **ä½œæˆæ—¥**: 2024å¹´
- **ç›£æŸ»ç¯„å›²**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€è¨­è¨ˆã€å®Ÿè£…å‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
- **ç›£æŸ»æ–¹æ³•**: ä»•æ§˜æ›¸åˆ†æã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æ¤œè¨¼

---

## ğŸ¯ ç›£æŸ»æ¦‚è¦

### ç›£æŸ»ç›®çš„

æœ¬ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆã¯ã€FLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªåˆ†æã‚’è¡Œã„ã€ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰æ½œåœ¨çš„ãªå•é¡Œç‚¹ã¨æ”¹å–„ç­–ã‚’æç¤ºã—ã¾ã™ï¼š

1. **å¿œç­”æ™‚é–“ã®æœ€é©åŒ–**
2. **ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ã®æœ€å°åŒ–**
3. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®ç¢ºä¿**
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š**

### ç›£æŸ»çµæœã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | è©•ä¾¡ | å•é¡Œæ•° |
|---------|------|--------|
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆUIï¼‰** | âš ï¸ è¦æ”¹å–„ | 7 |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆèªè¨¼ãƒ—ãƒ­ã‚­ã‚·ï¼‰** | âš ï¸ è¦æ”¹å–„ | 6 |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteï¼‰** | âš ï¸ è¦æ”¹å–„ | 5 |
| **ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†** | âš ï¸ è¦æ”¹å–„ | 4 |
| **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡** | âœ… è‰¯å¥½ | 3 |
| **ãƒ¡ãƒ¢ãƒªç®¡ç†** | ğŸ”´ è¦å¯¾å¿œ | 6 |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥** | ğŸ”´ è¦å¯¾å¿œ | 4 |

**ç·åˆè©•ä¾¡**: âš ï¸ **è¦æ”¹å–„** - å®Ÿè£…å‰ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯¾ç­–ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨

---

## ğŸ”´ é«˜å„ªå…ˆåº¦å•é¡Œ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯¾ç­–ã®æ¬ å¦‚

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: SQLiteã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã¯å­˜åœ¨ã™ã‚‹ãŒã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆãŒæœªå®šç¾©
- **å½±éŸ¿**: APIä¸€è¦§å–å¾—ã€è¨­å®šæ¤œç´¢æ™‚ã«ãƒ•ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
- **æ·±åˆ»åº¦**: é«˜ï¼ˆãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ æ™‚ã«è‘—ã—ã„æ€§èƒ½åŠ£åŒ–ï¼‰

#### æ¨å¥¨æ”¹å–„ç­–

```sql
-- æ”¹å–„ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼‰
CREATE TABLE apis (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  port INTEGER DEFAULT 8080,
  api_key TEXT NOT NULL,
  model_name TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  status TEXT DEFAULT 'stopped',  -- running/stopped
  last_used_at TIMESTAMP
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
CREATE INDEX idx_apis_status ON apis(status);
CREATE INDEX idx_apis_created_at ON apis(created_at DESC);
CREATE INDEX idx_apis_last_used_at ON apis(last_used_at DESC);

-- ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆF006å®Ÿè£…æ™‚ï¼‰
CREATE TABLE logs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  api_id TEXT NOT NULL,
  request_path TEXT,
  response_status INTEGER,
  response_time_ms INTEGER,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (api_id) REFERENCES apis(id)
);

-- ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_logs_api_id ON logs(api_id);
CREATE INDEX idx_logs_created_at ON logs(created_at DESC);
CREATE INDEX idx_logs_api_created ON logs(api_id, created_at DESC);

-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆF007å®Ÿè£…æ™‚ï¼‰
CREATE TABLE performance_metrics (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  api_id TEXT NOT NULL,
  metric_type TEXT NOT NULL,  -- request_count, avg_response_time, error_rate
  value REAL NOT NULL,
  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (api_id) REFERENCES apis(id)
);

CREATE INDEX idx_metrics_api_type_timestamp ON performance_metrics(api_id, metric_type, timestamp DESC);
```

**å®Ÿè£…æ¨å¥¨äº‹é …**:
- ã‚¯ã‚¨ãƒªã®æº–å‚™æ¸ˆã¿ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆï¼ˆprepared statementsï¼‰ã‚’ä½¿ç”¨
- ãƒãƒƒãƒæ›´æ–°å‡¦ç†ã‚’å®Ÿè£…
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°ã®æ¤œè¨ï¼ˆè¤‡æ•°APIåŒæ™‚å®Ÿè¡Œæ™‚ï¼‰

---

### 2. åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚­ãƒ¥ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®æ¬ å¦‚

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: åˆæœŸå®Ÿè£…ã¯1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãŒã€ã‚­ãƒ¥ãƒ¼ç®¡ç†ã®å®Ÿè£…æ–¹é‡ãŒä¸æ˜ç¢º
- **å½±éŸ¿**: è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒåŒæ™‚ã«æ¥ãŸå ´åˆã®å‡¦ç†é †åºãŒæœªå®šç¾©
- **æ·±åˆ»åº¦**: é«˜ï¼ˆã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®å•é¡Œï¼‰

#### æ¨å¥¨æ”¹å–„ç­–

**èªè¨¼ãƒ—ãƒ­ã‚­ã‚·å´ï¼ˆExpress.jsï¼‰ã«ã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…**:

```javascript
// ã‚­ãƒ¥ãƒ¼ç®¡ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæ¨å¥¨å®Ÿè£…ä¾‹ï¼‰
class RequestQueue {
  constructor(maxConcurrent = 1) {
    this.queue = [];
    this.processing = 0;
    this.maxConcurrent = maxConcurrent;
  }

  async add(requestHandler) {
    return new Promise((resolve, reject) => {
      this.queue.push({ requestHandler, resolve, reject });
      this.process();
    });
  }

  async process() {
    if (this.processing >= this.maxConcurrent || this.queue.length === 0) {
      return;
    }

    this.processing++;
    const { requestHandler, resolve, reject } = this.queue.shift();

    try {
      const result = await requestHandler();
      resolve(result);
    } catch (error) {
      reject(error);
    } finally {
      this.processing--;
      this.process();
    }
  }

  // è¨­å®šå¯èƒ½ãªåŒæ™‚å®Ÿè¡Œæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ï¼‰
  setMaxConcurrent(max) {
    this.maxConcurrent = max;
  }
}

// ä½¿ç”¨ä¾‹ï¼ˆèªè¨¼ãƒ—ãƒ­ã‚­ã‚·ã§ï¼‰
const queue = new RequestQueue(1); // åˆæœŸã¯1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’

app.post('/v1/chat/completions', async (req, res) => {
  await queue.add(async () => {
    // APIã‚­ãƒ¼æ¤œè¨¼
    const apiKey = req.headers.authorization?.replace('Bearer ', '');
    if (!validateApiKey(apiKey)) {
      return res.status(401).json({ error: 'Unauthorized' });
    }

    // Ollama APIã¸è»¢é€
    return proxyRequest(req, res);
  });
});
```

**å°†æ¥çš„ãªæ‹¡å¼µ**:
- å„ªå…ˆåº¦ä»˜ãã‚­ãƒ¥ãƒ¼ï¼ˆVIPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å„ªå…ˆå‡¦ç†ï¼‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
- ã‚­ãƒ¥ãƒ¼ã®é•·ã•åˆ¶é™ï¼ˆãƒ¡ãƒ¢ãƒªä¿è­·ï¼‰

---

### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¬ å¦‚

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: ãƒ¢ãƒ‡ãƒ«ä¸€è¦§å–å¾—ï¼ˆOllama APIï¼‰ã‚’æ¯å›å‘¼ã³å‡ºã™å¯èƒ½æ€§ãŒã‚ã‚‹
- **å½±éŸ¿**: ä¸è¦ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã€Ollamaã¸ã®è² è·å¢—åŠ ã€UIå¿œç­”æ€§ã®ä½ä¸‹
- **æ·±åˆ»åº¦**: ä¸­ï½é«˜ï¼ˆé »ç¹ãªã‚¢ã‚¯ã‚»ã‚¹æ™‚ï¼‰

#### æ¨å¥¨æ”¹å–„ç­–

**1. ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥**:

```javascript
// ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆæ¨å¥¨å®Ÿè£…ä¾‹ï¼‰
class ModelCache {
  constructor(ttl = 60000) { // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 60ç§’
    this.cache = null;
    this.timestamp = 0;
    this.ttl = ttl;
  }

  async getModels() {
    const now = Date.now();
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹ãªå ´åˆã¯è¿”ã™
    if (this.cache && (now - this.timestamp) < this.ttl) {
      return this.cache;
    }

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„ã€ã¾ãŸã¯æœŸé™åˆ‡ã‚Œã®å ´åˆã¯å–å¾—
    try {
      const response = await fetch('http://localhost:11434/api/tags');
      const data = await response.json();
      this.cache = data;
      this.timestamp = now;
      return data;
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°è¿”ã™ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
      if (this.cache) {
        console.warn('Ollama API error, using cached data:', error);
        return this.cache;
      }
      throw error;
    }
  }

  invalidate() {
    this.cache = null;
    this.timestamp = 0;
  }
}

const modelCache = new ModelCache(60000); // 60ç§’TTL
```

**2. APIè¨­å®šã®ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥**:

```javascript
// APIè¨­å®šã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆæ¨å¥¨å®Ÿè£…ä¾‹ï¼‰
class ApiConfigCache {
  constructor() {
    this.cache = new Map();
    this.listeners = [];
  }

  async getApiConfig(apiId) {
    // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
    if (this.cache.has(apiId)) {
      return this.cache.get(apiId);
    }

    // SQLiteã‹ã‚‰å–å¾—ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    const config = await db.getApiConfig(apiId);
    if (config) {
      this.cache.set(apiId, config);
    }
    return config;
  }

  invalidate(apiId) {
    this.cache.delete(apiId);
    this.notifyListeners(apiId);
  }

  clear() {
    this.cache.clear();
  }

  // è¨­å®šå¤‰æ›´æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
  onConfigChanged(callback) {
    this.listeners.push(callback);
  }

  notifyListeners(apiId) {
    this.listeners.forEach(cb => cb(apiId));
  }
}
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
- ãƒ¢ãƒ‡ãƒ«ä¸€è¦§: ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰/å‰Šé™¤æ™‚ã€æ‰‹å‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æ™‚
- APIè¨­å®š: è¨­å®šå¤‰æ›´æ™‚ã€APIä½œæˆ/å‰Šé™¤æ™‚

---

### 4. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–ã®æ¬ å¦‚

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: é•·æ™‚é–“å®Ÿè¡Œæ™‚ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–ãŒä¸æ˜ç¢º
- **å½±éŸ¿**: é•·æ™‚é–“å®Ÿè¡Œæ™‚ã«ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¢—åŠ ã—ç¶šã‘ã‚‹å¯èƒ½æ€§
- **æ·±åˆ»åº¦**: é«˜ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œã‚’æƒ³å®šï¼‰

#### æ¨å¥¨æ”¹å–„ç­–

**1. ãƒ¡ãƒ¢ãƒªç›£è¦–æ©Ÿèƒ½ã®å®Ÿè£…**:

```rust
// Tauriãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ï¼ˆRustï¼‰ã§ã®ãƒ¡ãƒ¢ãƒªç›£è¦–
use sysinfo::{System, SystemExt, ProcessExt};

#[tauri::command]
pub async fn get_memory_usage() -> Result<u64, String> {
    let mut system = System::new_all();
    system.refresh_all();
    
    let pid = std::process::id();
    if let Some(process) = system.process(sysinfo::Pid::from_u32(pid)) {
        Ok(process.memory() * 1024) // KB to bytes
    } else {
        Err("Process not found".to_string())
    }
}

// å®šæœŸçš„ãªãƒ¡ãƒ¢ãƒªãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨: 5åˆ†ã”ã¨ï¼‰
#[tauri::command]
pub async fn check_memory_health() -> Result<bool, String> {
    let usage = get_memory_usage().await?;
    let limit = 2 * 1024 * 1024 * 1024; // 2GBåˆ¶é™
    
    if usage > limit {
        // è­¦å‘Šã‚’UIã«é€šçŸ¥
        Ok(false)
    } else {
        Ok(true)
    }
}
```

**2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®ãƒ¡ãƒ¢ãƒªç®¡ç†**:

```typescript
// React/Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–
// - ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
// - ã‚¿ã‚¤ãƒãƒ¼ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
// - å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‚ç…§è§£é™¤

// Reactä¾‹
useEffect(() => {
  const timer = setInterval(() => {
    // å‡¦ç†
  }, 1000);

  return () => {
    clearInterval(timer); // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  };
}, []);

// Vueä¾‹
onUnmounted(() => {
  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
});
```

**3. èªè¨¼ãƒ—ãƒ­ã‚­ã‚·å´ã®ãƒ¡ãƒ¢ãƒªç®¡ç†**:

```javascript
// Express.jsã§ã®ãƒ¡ãƒ¢ãƒªç®¡ç†
// - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ã‚µã‚¤ã‚ºåˆ¶é™
app.use(express.json({ limit: '10mb' })); // é©åˆ‡ãªåˆ¶é™ã‚’è¨­å®š

// - ãƒ­ã‚°ã®ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨å®šæœŸçš„ãªãƒ•ãƒ©ãƒƒã‚·ãƒ¥
class LogBuffer {
  constructor(maxSize = 1000) {
    this.buffer = [];
    this.maxSize = maxSize;
  }

  add(log) {
    this.buffer.push(log);
    if (this.buffer.length >= this.maxSize) {
      this.flush();
    }
  }

  async flush() {
    if (this.buffer.length === 0) return;
    
    const logs = this.buffer.splice(0);
    await db.batchInsertLogs(logs);
  }
}

// å®šæœŸçš„ãªãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆ5åˆ†ã”ã¨ï¼‰
setInterval(() => logBuffer.flush(), 5 * 60 * 1000);
```

---

## ğŸŸ¡ ä¸­å„ªå…ˆåº¦å•é¡Œ

### 5. UIå¿œç­”æ€§ã®æœ€é©åŒ–

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: é‡ã„å‡¦ç†ï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç­‰ï¼‰ãŒUIã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å¯èƒ½æ€§
- **å½±éŸ¿**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä½ä¸‹ã€ãƒ•ãƒªãƒ¼ã‚ºæ„Ÿ

#### æ¨å¥¨æ”¹å–„ç­–

**1. éåŒæœŸå‡¦ç†ã¨ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º**:

```typescript
// ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®éåŒæœŸå‡¦ç†ï¼ˆæ¨å¥¨å®Ÿè£…ï¼‰
async function downloadModel(modelName: string) {
  try {
    // UIã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ãŸã‚ã€å³åº§ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    setLoading(true);
    setProgress(0);

    // Web Workerã¾ãŸã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã‚’ä½¿ç”¨
    const response = await fetch('http://localhost:11434/api/pull', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: modelName, stream: true })
    });

    // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é€²æ—ã®å‡¦ç†
    const reader = response.body?.getReader();
    const decoder = new TextDecoder();

    if (reader) {
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n').filter(line => line.trim());

        for (const line of lines) {
          try {
            const data = JSON.parse(line);
            if (data.completed) {
              setProgress(100);
            } else if (data.total && data.completed) {
              const percent = (data.completed / data.total) * 100;
              setProgress(percent);
            }
          } catch (e) {
            // ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
          }
        }
      }
    }

    setLoading(false);
  } catch (error) {
    setError(error.message);
    setLoading(false);
  }
}
```

**2. ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ™‚ï¼‰**:

```typescript
// å¤§é‡ã®APIä¸€è¦§ã‚„ãƒ­ã‚°è¡¨ç¤ºæ™‚ã«ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨
import { useVirtualizer } from '@tanstack/react-virtual';

// ä¾‹: APIä¸€è¦§ã®ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
const rowVirtualizer = useVirtualizer({
  count: apis.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 80,
  overscan: 5
});
```

---

### 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: ã‚¯ã‚¨ãƒªæœ€é©åŒ–ã®æ–¹é‡ãŒæœªå®šç¾©
- **å½±éŸ¿**: ãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ æ™‚ã®æ€§èƒ½åŠ£åŒ–

#### æ¨å¥¨æ”¹å–„ç­–

**1. ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–**:

```javascript
// éåŠ¹ç‡ãªã‚¯ã‚¨ãƒªï¼ˆæ”¹å–„å‰ï¼‰
// SELECT * FROM apis; // å…¨ä»¶å–å¾—

// åŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªï¼ˆæ”¹å–„å¾Œï¼‰
// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
const getApis = async (limit = 20, offset = 0) => {
  return db.all(`
    SELECT id, name, port, model_name, status, created_at 
    FROM apis 
    ORDER BY created_at DESC 
    LIMIT ? OFFSET ?
  `, [limit, offset]);
};

// å¿…è¦ãªåˆ—ã®ã¿å–å¾—ï¼ˆSELECT *ã‚’é¿ã‘ã‚‹ï¼‰
const getApiById = async (id) => {
  return db.get(`
    SELECT id, name, port, model_name, status 
    FROM apis 
    WHERE id = ?
  `, [id]);
};
```

**2. ãƒãƒƒãƒå‡¦ç†ã®å®Ÿè£…**:

```javascript
// è¤‡æ•°ã®ãƒ­ã‚°ã‚’ä¸€åº¦ã«æŒ¿å…¥ï¼ˆF006å®Ÿè£…æ™‚ï¼‰
const insertLogsBatch = async (logs) => {
  const placeholders = logs.map(() => '(?, ?, ?, ?, ?)').join(',');
  const values = logs.flatMap(log => [
    log.api_id,
    log.request_path,
    log.response_status,
    log.response_time_ms,
    log.created_at
  ]);

  return db.run(`
    INSERT INTO logs (api_id, request_path, response_status, response_time_ms, created_at)
    VALUES ${placeholders}
  `, values);
};
```

---

### 7. ãƒ­ã‚°ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿

#### å•é¡Œç‚¹

- **ç¾çŠ¶**: ãƒ­ã‚°æ©Ÿèƒ½ï¼ˆF006ï¼‰ã®å®Ÿè£…æ™‚ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ãŒä¸æ˜ç¢º
- **å½±éŸ¿**: å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ­ã‚°è¨˜éŒ²ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‹å¯èƒ½æ€§

#### æ¨å¥¨æ”¹å–„ç­–

**1. éåŒæœŸãƒ­ã‚°è¨˜éŒ²**:

```javascript
// éåŒæœŸãƒ­ã‚°è¨˜éŒ²ï¼ˆæ¨å¥¨å®Ÿè£…ï¼‰
class AsyncLogger {
  constructor(bufferSize = 100, flushInterval = 5000) {
    this.buffer = [];
    this.bufferSize = bufferSize;
    this.flushInterval = flushInterval;
    this.startFlushTimer();
  }

  log(entry) {
    this.buffer.push({
      ...entry,
      timestamp: Date.now()
    });

    // ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚ºã«é”ã—ãŸã‚‰å³åº§ã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
    if (this.buffer.length >= this.bufferSize) {
      this.flush();
    }
  }

  async flush() {
    if (this.buffer.length === 0) return;

    const logs = this.buffer.splice(0);
    
    // éåŒæœŸã§DBã«æ›¸ãè¾¼ã¿ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ï¼‰
    setImmediate(async () => {
      try {
        await db.batchInsertLogs(logs);
      } catch (error) {
        console.error('Failed to flush logs:', error);
        // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒãƒƒãƒ•ã‚¡ã«æˆ»ã™ï¼ˆé‡è¦åº¦ã®é«˜ã„ãƒ­ã‚°ã®ã¿ï¼‰
      }
    });
  }

  startFlushTimer() {
    setInterval(() => this.flush(), this.flushInterval);
  }
}

// ä½¿ç”¨ä¾‹
const logger = new AsyncLogger(100, 5000);

app.use((req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    logger.log({
      api_id: req.apiId, // èªè¨¼å¾Œã«è¨­å®š
      request_path: req.path,
      response_status: res.statusCode,
      response_time_ms: duration
    });
  });
  
  next();
});
```

**2. ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®è¨­å®š**:

```javascript
// ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®è¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯æœ€å°é™ï¼‰
const LOG_LEVEL = process.env.LOG_LEVEL || 'info'; // debug, info, warn, error

const shouldLog = (level) => {
  const levels = { debug: 0, info: 1, warn: 2, error: 3 };
  return levels[level] >= levels[LOG_LEVEL];
};

if (shouldLog('debug')) {
  logger.log({ level: 'debug', message: '...' });
}
```

---

## ğŸŸ¢ ä½å„ªå…ˆåº¦å•é¡Œ

### 8. èµ·å‹•æ™‚é–“ã®æœ€é©åŒ–

#### æ¨å¥¨æ”¹å–„ç­–

```rust
// ä¸¦åˆ—åˆæœŸåŒ–å‡¦ç†ï¼ˆæ¨å¥¨å®Ÿè£…ï¼‰
use tokio::task;

#[tauri::command]
pub async fn initialize_app() -> Result<AppState, String> {
    // ä¸¦åˆ—ã§åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè¡Œ
    let (db_result, ollama_check) = tokio::join!(
        initialize_database(),
        check_ollama_status()
    );

    let db = db_result?;
    let ollama_status = ollama_check?;

    Ok(AppState {
        db,
        ollama_status,
        // ...
    })
}
```

---

### 9. ãƒ—ãƒ­ã‚­ã‚·å¿œç­”æ™‚é–“ã®æœ€é©åŒ–

#### æ¨å¥¨æ”¹å–„ç­–

```javascript
// ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã®æœ€é©åŒ–
const proxyOptions = {
  target: 'http://localhost:11434',
  changeOrigin: true,
  timeout: 30000, // é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
  proxyTimeout: 30000,
  // æ¥ç¶šãƒ—ãƒ¼ãƒ«ã®è¨­å®š
  agent: new http.Agent({
    keepAlive: true,
    maxSockets: 5,
    maxFreeSockets: 2
  })
};
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã¨ç›®æ¨™å€¤

### ç¾åœ¨ã®ç›®æ¨™å€¤ï¼ˆä»•æ§˜æ›¸ã‚ˆã‚Šï¼‰

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | ç¾çŠ¶è©•ä¾¡ |
|------|--------|----------|
| APIä½œæˆæ™‚é–“ | 30ç§’ä»¥å†… | âš ï¸ å®Ÿè£…å¾…ã¡ |
| APIèµ·å‹•æ™‚é–“ | 10ç§’ä»¥å†… | âš ï¸ å®Ÿè£…å¾…ã¡ |
| APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ | 1-5ç§’ï¼ˆãƒ¢ãƒ‡ãƒ«ä¾å­˜ï¼‰ | âš ï¸ å®Ÿè£…å¾…ã¡ |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º + 2GB | âš ï¸ ç›£è¦–æ©Ÿèƒ½æœªå®Ÿè£… |
| CPUä½¿ç”¨ç‡ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ï¼‰ | < 5% | âš ï¸ ç›£è¦–æ©Ÿèƒ½æœªå®Ÿè£… |
| åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•° | 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’ï¼ˆåˆæœŸï¼‰ | âš ï¸ ã‚­ãƒ¥ãƒ¼ç®¡ç†æœªå®Ÿè£… |

### æ¨å¥¨è¿½åŠ æŒ‡æ¨™

| æŒ‡æ¨™ | æ¨å¥¨ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|------|-----------|----------|
| UIå¿œç­”æ€§ | æ“ä½œå¾Œ100msä»¥å†…ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¸¬å®š |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæ™‚é–“ | å˜ä¸€ã‚¯ã‚¨ãƒª < 10ms | SQLite EXPLAIN QUERY PLAN |
| ãƒ—ãƒ­ã‚­ã‚·ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ | < 50ms | ãƒ—ãƒ­ã‚­ã‚·å‰å¾Œã®æ™‚é–“å·®æ¸¬å®š |
| ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯æ¤œå‡º | 1æ™‚é–“ã§å¢—åŠ  < 10MB | å®šæœŸçš„ãªãƒ¡ãƒ¢ãƒªæ¸¬å®š |
| èµ·å‹•æ™‚é–“ | < 3ç§’ | ã‚¢ãƒ—ãƒªèµ·å‹•ã‹ã‚‰UIè¡¨ç¤ºã¾ã§ |

---

## ğŸ› ï¸ å®Ÿè£…æ¨å¥¨äº‹é …ï¼ˆå„ªå…ˆé †ä½é †ï¼‰

### Phase 1: å¿…é ˆå®Ÿè£…ï¼ˆMVPå‰ï¼‰

1. âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¿½åŠ **
   - ãƒ•ã‚¡ã‚¤ãƒ«: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - å·¥æ•°è¦‹ç©: 0.5æ—¥

2. âœ… **ã‚­ãƒ¥ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/proxy/request-queue.js`
   - å·¥æ•°è¦‹ç©: 2æ—¥

3. âœ… **åŸºæœ¬çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®å®Ÿè£…**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/utils/model-cache.js`, `src/utils/api-config-cache.js`
   - å·¥æ•°è¦‹ç©: 2æ—¥

### Phase 2: é«˜å„ªå…ˆåº¦ï¼ˆMVPå¾Œã™ãï¼‰

4. âœ… **ãƒ¡ãƒ¢ãƒªç›£è¦–æ©Ÿèƒ½ã®å®Ÿè£…**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src-tauri/src/memory_monitor.rs`
   - å·¥æ•°è¦‹ç©: 3æ—¥

5. âœ… **éåŒæœŸãƒ­ã‚°è¨˜éŒ²ã®å®Ÿè£…**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/proxy/async-logger.js`
   - å·¥æ•°è¦‹ç©: 2æ—¥

6. âœ… **UIå¿œç­”æ€§ã®æœ€é©åŒ–**
   - ãƒ•ã‚¡ã‚¤ãƒ«: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - å·¥æ•°è¦‹ç©: 3æ—¥

### Phase 3: ä¸­å„ªå…ˆåº¦ï¼ˆv1.0ï¼‰

7. âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–**
   - ãƒ•ã‚¡ã‚¤ãƒ«: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹å±¤
   - å·¥æ•°è¦‹ç©: 2æ—¥

8. âœ… **èµ·å‹•æ™‚é–“ã®æœ€é©åŒ–**
   - ãƒ•ã‚¡ã‚¤ãƒ«: åˆæœŸåŒ–å‡¦ç†
   - å·¥æ•°è¦‹ç©: 1æ—¥

---

## ğŸ“ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ†ã‚¹ãƒˆé …ç›®

1. **è² è·ãƒ†ã‚¹ãƒˆ**
   - åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°: 1, 5, 10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   - æŒç¶šæ™‚é–“: 10åˆ†
   - æ¸¬å®šæŒ‡æ¨™: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã€ã‚¨ãƒ©ãƒ¼ç‡ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

2. **é•·æ™‚é–“å®Ÿè¡Œãƒ†ã‚¹ãƒˆ**
   - å®Ÿè¡Œæ™‚é–“: 24æ™‚é–“
   - æ¸¬å®šæŒ‡æ¨™: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã€CPUä½¿ç”¨ç‡

3. **ãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ ãƒ†ã‚¹ãƒˆ**
   - APIæ•°: 10, 100, 1000å€‹
   - ãƒ­ã‚°æ•°: 1000, 10000, 100000ä»¶
   - æ¸¬å®šæŒ‡æ¨™: ã‚¯ã‚¨ãƒªå®Ÿè¡Œæ™‚é–“ã€UIè¡¨ç¤ºæ™‚é–“

4. **èµ·å‹•æ™‚é–“ãƒ†ã‚¹ãƒˆ**
   - æ¸¬å®š: ã‚¢ãƒ—ãƒªèµ·å‹•ã‹ã‚‰UIè¡¨ç¤ºã¾ã§
   - ç›®æ¨™: < 3ç§’

### ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«æ¨å¥¨

- **è² è·ãƒ†ã‚¹ãƒˆ**: Apache Bench (ab), k6, Artillery
- **ãƒ¡ãƒ¢ãƒªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°**: Chrome DevTools, Valgrind (Rust)
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°**: SQLite EXPLAIN QUERY PLAN

---

## ğŸ¯ ã¾ã¨ã‚

### ä¸»è¦ãªç™ºè¦‹äº‹é …

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆãŒå¿…é ˆã€‚å®Ÿè£…å‰ã«ã‚¹ã‚­ãƒ¼ãƒã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã€‚

2. **ã‚­ãƒ¥ãƒ¼ç®¡ç†**: åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯¾å¿œã®ãŸã‚ã€æ—©æœŸå®Ÿè£…ãŒå¿…è¦ã€‚

3. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã€APIè¨­å®šï¼‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…ãŒå¿…è¦ã€‚

4. **ãƒ¡ãƒ¢ãƒªç®¡ç†**: é•·æ™‚é–“å®Ÿè¡Œã‚’æƒ³å®šã—ãŸç›£è¦–æ©Ÿèƒ½ã¨ãƒªãƒ¼ã‚¯å¯¾ç­–ãŒå¿…è¦ã€‚

5. **ãƒ­ã‚°**: éåŒæœŸãƒ­ã‚°è¨˜éŒ²ã‚’å®Ÿè£…ã—ãªã„ã¨ã€ãƒ­ã‚°æ©Ÿèƒ½ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚

### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **å³åº§ã«å¯¾å¿œ**: Phase 1ã®å®Ÿè£…ã‚’MVPå‰ã«å®Œäº†ã•ã›ã‚‹
2. **ç›£è¦–ä½“åˆ¶**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®æ¸¬å®šã‚’å®Ÿè£…æ™‚ã«çµ„ã¿è¾¼ã‚€
3. **ç¶™ç¶šçš„ãªæ”¹å–„**: å®šæœŸçš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£æŸ»ã®å®Ÿæ–½

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [SQLite Performance Optimization](https://www.sqlite.org/performance.html)
- [Express.js Best Practices](https://expressjs.com/en/advanced/best-practice-performance.html)
- [Tauri Performance](https://tauri.app/v1/guides/features/performance)
- [React Performance Optimization](https://react.dev/learn/render-and-commit)

---

**ç›£æŸ»å®Œäº†æ—¥**: 2024å¹´  
**æ¬¡å›ç›£æŸ»æ¨å¥¨æ™‚æœŸ**: å®Ÿè£…å®Œäº†å¾Œã€æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹å‰

