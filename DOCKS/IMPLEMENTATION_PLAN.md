# FLM - 実装計画書

## 📋 プロジェクト概要

**FLM（Local LLM API Manager）**は、技術知識がなくても、コードを書かずに、ローカルLLMのAPIを作成・利用できるデスクトップアプリケーションです。

### 目的
非開発者が5分以内でローカルLLM APIを作成し、利用できることを目標としています。

### 技術スタック
- **フロントエンド**: React 19.x + TypeScript + Tauri 2.x
- **バックエンド**: Rust (Tauri)
- **データベース**: SQLite
- **LLM実行**: Ollama
- **認証プロキシ**: Express.js + express-http-proxy

---

## ✅ v1.0完了状況（現在）

### 実装済み機能

| 機能ID | 機能名 | 状態 | 実装内容 |
|--------|--------|------|----------|
| F001 | API作成機能 | ✅ 完了 | モデル選択、設定、自動起動まで完全実装 |
| F002 | API利用機能 | ✅ 完了 | チャットインターフェース、API情報表示実装済み |
| F003 | API管理機能 | ✅ 完了 | 起動/停止、設定変更、削除機能実装済み |
| F004 | モデル管理機能 | ✅ 完了 | モデル検索・ダウンロード・削除機能実装済み |
| F005 | 認証機能 | ✅ 完了 | APIキー生成・暗号化保存・検証実装済み |
| F009 | Ollama自動インストール | ✅ 完了 | 検出・ダウンロード・起動機能実装済み |
| F008 | 公式Webサイト | ✅ 完了 | 全ページ実装完了 |

### 基盤実装済み（UI未実装）

| 機能ID | 機能名 | 状態 | 備考 |
|--------|--------|------|------|
| F006 | ログ表示機能 | ⚠️ 基盤実装済み | バックエンド・データベース実装済み、UI未実装 |
| F007 | パフォーマンス監視 | ❌ 未実装 | データベース設計のみ、実装未開始 |

---

## 📝 残っている実装タスク

### 🎯 v1.1実装計画（高優先度）

#### 1. F006: ログ表示機能のUI実装

**現状**:
- ✅ データベーステーブル `request_logs` 実装済み
- ✅ バックエンドIPCコマンド実装済み（ログ保存・取得）
- ✅ 認証プロキシでのログ記録実装済み
- ❌ **フロントエンドUI未実装**

**実装タスク**:

1. **ログ一覧ページの作成**
   - ファイル: `src/pages/ApiLogs.tsx`, `src/pages/ApiLogs.css`
   - 機能:
     - API選択ドロップダウン
     - ログ一覧テーブル表示
     - ページネーション
     - リアルタイム更新（ポーリング）

2. **ログフィルタ機能**
   - ファイル: `src/components/api/LogFilter.tsx`
   - 機能:
     - 日時範囲フィルタ（開始日時・終了日時）
     - ステータスコードフィルタ（200, 400, 500等）
     - エンドポイントパス検索
     - エラーログのみ表示オプション

3. **ログ詳細表示**
   - ファイル: `src/components/api/LogDetail.tsx`
   - 機能:
     - モーダルまたはサイドパネルで詳細表示
     - リクエストヘッダー・ボディ表示
     - レスポンスヘッダー・ボディ表示
     - コピーボタン

4. **統計情報表示**
   - ファイル: `src/components/api/LogStatistics.tsx`
   - 機能:
     - リクエスト総数
     - 平均レスポンス時間
     - エラー率（%）
     - ステータスコード分布（円グラフまたは棒グラフ）

5. **IPCコマンド連携**
   - 既存コマンド確認:
     - `get_request_logs(api_id: String, limit: Option<u32>, offset: Option<u32>)`
     - 追加実装が必要な可能性:
       - 日時範囲指定でのログ取得
       - フィルタ条件でのログ取得
       - 統計情報取得コマンド

**推定工数**: 5-7日

**依存関係**:
- 既存のIPCコマンドの確認・拡張
- データベースクエリの最適化（大量ログ対応）

---

#### 2. F007: パフォーマンス監視機能

**現状**:
- ❌ データベーステーブル未作成
- ❌ バックエンド実装未開始
- ❌ フロントエンド未実装

**実装タスク**:

1. **データベーススキーマ実装**
   - ファイル: `src-tauri/src/database/migrations.rs`
   - テーブル: `performance_metrics`
   - カラム:
     - `id`: INTEGER PRIMARY KEY
     - `api_id`: TEXT NOT NULL (FK)
     - `metric_type`: TEXT NOT NULL (request_count, avg_response_time, error_rate, cpu_usage, memory_usage)
     - `value`: REAL NOT NULL
     - `timestamp`: TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   - インデックス作成

2. **バックエンドメトリクス収集**
   - ファイル: `src-tauri/src/commands/performance.rs` (新規作成)
   - 機能:
     - 認証プロキシからのメトリクス収集
     - 定期的なメトリクス記録（1分間隔）
     - IPCコマンド実装:
       - `record_performance_metric`
       - `get_performance_metrics`
       - `get_performance_summary`

3. **認証プロキシでのメトリクス収集**
   - ファイル: `src/backend/auth/proxy.ts` (拡張)
   - 機能:
     - リクエストごとのレスポンス時間記録
     - CPU使用率監視（Node.jsプロセス）
     - メモリ使用量監視
     - メトリクスのバックエンドへの送信

4. **パフォーマンスダッシュボードUI**
   - ファイル: `src/pages/PerformanceDashboard.tsx`, `src/pages/PerformanceDashboard.css`
   - 機能:
     - API選択
     - リアルタイムグラフ表示:
       - レスポンス時間（時系列）
       - リクエスト数（時系列）
       - CPU/メモリ使用量（時系列）
       - エラー率（時系列）
     - 統計サマリー:
       - 現在のリクエスト数/秒
       - 平均レスポンス時間
       - ピークレスポンス時間
       - エラー率

5. **グラフライブラリの統合**
   - 推奨: `recharts` (React用グラフライブラリ)
   - 実装:
     - 時系列グラフ（Line Chart）
     - 統計サマリーカード

**推定工数**: 8-10日

**依存関係**:
- データベーススキーマ作成
- バックエンドメトリクス収集ロジック
- グラフライブラリの選定・統合

---

### 🎯 v1.2実装計画（中優先度）

#### 3. モデルカタログ機能の拡張

**現状**:
- ✅ 基本的なモデル一覧表示実装済み
- ❌ 詳細情報（説明、カテゴリ、作成者、ライセンス）未実装
- ❌ 定期的なカタログ更新未実装

**実装タスク**:

1. **モデル詳細情報の取得**
   - ファイル: `src-tauri/src/commands/model.rs` (拡張)
   - 機能:
     - Ollama公式APIまたはウェブスクレイピング
     - モデルメタデータの取得・保存

2. **データベース拡張**
   - テーブル: `model_metadata` (新規作成)
   - カラム:
     - `model_name`: TEXT PRIMARY KEY
     - `description`: TEXT
     - `category`: TEXT
     - `author`: TEXT
     - `license`: TEXT
     - `last_updated`: TIMESTAMP

3. **UI拡張**
   - ファイル: `src/components/models/ModelCard.tsx` (拡張)
   - 機能:
     - 詳細情報の表示
     - カテゴリフィルタ
     - ライセンス情報表示

4. **定期更新機能**
   - ファイル: `src-tauri/src/commands/model.rs` (拡張)
   - 機能:
     - バックグラウンドジョブ（日次または週次）
     - カタログ更新通知

**推定工数**: 4-5日

---

#### 4. バックアップ・復元機能

**現状**:
- ❌ 未実装

**実装タスク**:

1. **エクスポート機能**
   - ファイル: `src-tauri/src/commands/backup.rs` (新規作成)
   - 機能:
     - API設定のJSONエクスポート
     - APIキーの暗号化エクスポート（オプション）

2. **インポート機能**
   - ファイル: `src-tauri/src/commands/backup.rs`
   - 機能:
     - JSONファイルの読み込み
     - バリデーション
     - データベースへのインポート

3. **UI実装**
   - ファイル: `src/pages/Settings.tsx` (拡張)
   - 機能:
     - エクスポートボタン
     - インポートボタン
     - ファイル選択ダイアログ

**推定工数**: 3-4日

---

### 🔧 技術的改善タスク（継続的）

#### 5. パフォーマンス最適化

**タスク**:
- データベースクエリの最適化
- インデックスの追加
- UIレンダリング最適化（メモ化の追加）
- 起動時間の短縮

**推定工数**: 3-5日

---

#### 6. テストカバレッジ向上

**タスク**:
- テストカバレッジを80%以上に向上
- E2Eテストの拡充
- パフォーマンステストの自動化

**推定工数**: 継続的（各機能実装時に追加）

---

#### 7. クロスプラットフォーム対応

**タスク**:
- macOS向けビルド設定
- Linux向けビルド設定
- プラットフォーム固有機能の実装

**推定工数**: 5-7日（プラットフォームごと）

---

## 📊 実装優先度マトリックス

| 機能 | 優先度 | 工数 | バージョン | ステータス |
|------|--------|------|-----------|----------|
| F006: ログ表示UI | 🔴 高 | 5-7日 | v1.1 | ⚠️ 基盤実装済み |
| F007: パフォーマンス監視 | 🔴 高 | 8-10日 | v1.1 | ❌ 未実装 |
| モデルカタログ拡張 | 🟡 中 | 4-5日 | v1.2 | 📅 計画中 |
| バックアップ・復元 | 🟡 中 | 3-4日 | v1.2 | 📅 計画中 |
| パフォーマンス最適化 | 🟢 低 | 3-5日 | 継続的 | 📅 計画中 |
| クロスプラットフォーム | 🟡 中 | 5-7日/OS | 将来的 | 📅 計画中 |

---

## 🚀 実装開始推奨順序

### Phase 1: v1.1必須機能（2-3週間）

1. **F006: ログ表示UI実装** (Week 1)
   - Day 1-2: IPCコマンド確認・拡張、データベースクエリ最適化
   - Day 3-4: ログ一覧ページ実装
   - Day 5: フィルタ機能実装
   - Day 6-7: 統計情報・詳細表示実装

2. **F007: パフォーマンス監視** (Week 2-3)
   - Week 2 Day 1-2: データベーススキーマ実装
   - Week 2 Day 3-4: バックエンドメトリクス収集実装
   - Week 2 Day 5: 認証プロキシ拡張
   - Week 3 Day 1-3: ダッシュボードUI実装
   - Week 3 Day 4-5: テスト・調整

### Phase 2: v1.2機能（1-2週間）

3. **モデルカタログ拡張** (Week 4)
4. **バックアップ・復元** (Week 5)

### Phase 3: 継続的改善

5. **パフォーマンス最適化** (継続的)
6. **テストカバレッジ向上** (継続的)

---

## 📋 実装チェックリスト

### F006: ログ表示UI

- [ ] IPCコマンド確認・拡張
- [ ] データベースクエリ最適化
- [ ] ログ一覧ページ実装
- [ ] ログフィルタ機能実装
- [ ] ログ詳細表示実装
- [ ] 統計情報表示実装
- [ ] リアルタイム更新実装
- [ ] テスト実装

### F007: パフォーマンス監視

- [ ] データベーススキーマ実装
- [ ] バックエンドメトリクス収集実装
- [ ] 認証プロキシ拡張
- [ ] ダッシュボードUI実装
- [ ] グラフライブラリ統合
- [ ] リアルタイム更新実装
- [ ] テスト実装

---

## 🔗 関連ドキュメント

- [機能仕様書](./SPECIFICATION.md) - 完全な機能仕様
- [将来の拡張計画](../docs/FUTURE_EXTENSIONS.md) - 詳細な拡張計画
- [アーキテクチャ設計書](./ARCHITECTURE.md) - システムアーキテクチャ
- [APIドキュメント](../docs/API_DOCUMENTATION.md) - IPCコマンド仕様

---

**作成日**: 2024年  
**最終更新**: 2024年  
**ステータス**: 実装計画確定

