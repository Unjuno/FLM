# FLM 倫理監査レポート

## 監査日
2025年1月

## 監査概要

本レポートは、FLM（Local LLM API Manager）アプリケーションの倫理的側面に関する包括的な監査結果をまとめたものです。プライバシー、データ保護、透明性、ユーザー権利、セキュリティ、外部サービス連携などの観点から評価を行いました。

---

## 1. プライバシーとデータ保護

### 1.1 データ収集の透明性 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- プライバシーポリシーページが実装されている（`src/pages/PrivacyPolicy.tsx`）
- データ収集の目的と方法が明確に記載されている
- ローカルデータのみを保存し、外部送信を行わない方針が明記されている

**実装状況**:
```12:73:src/pages/PrivacyPolicy.tsx
export const PrivacyPolicy: React.FC = () => {
  // ... プライバシーポリシーの内容が明確に記載
  // 2.1 ローカルデータ: すべてのデータをユーザーのローカルデバイスに保存
  // 2.2 外部サービスへの送信: ユーザーの許可なく、個人情報を外部サービスに送信しない
```

**推奨事項**:
- ✅ 現在の実装で十分
- プライバシーポリシーの更新日時が動的に表示されている点も良好

---

### 1.2 データのローカル保存 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- すべてのデータがローカルSQLiteデータベースに保存される
- 外部サーバーへの自動送信機能がない
- クラウド同期機能はオプション（ユーザーが明示的に有効化する必要がある）

**実装状況**:
- データベース: SQLite（ローカルファイル）
- APIキー: AES-256-GCMで暗号化保存
- リクエストログ: ローカルデータベースに保存
- 設定情報: ローカルデータベースに保存

**推奨事項**:
- ✅ 現在の実装で十分
- データの暗号化が適切に実装されている

---

### 1.3 機密情報の保護 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- APIキーはAES-256-GCMで暗号化保存
- リクエストログでは機密情報が自動的にマスキングされる
- タイミング攻撃対策として`crypto.timingSafeEqual`を使用

**実装状況**:
```308:360:src/backend/auth/server.ts
  const maskSensitiveData = (obj: any): any => {
    // APIキー、パスワード、トークンなどの機密情報を自動的にマスキング
    const sensitiveFields = [
      'api_key', 'apiKey', 'apikey',
      'password', 'passwd', 'pwd',
      'token', 'access_token', 'refresh_token',
      'secret', 'secret_key', 'private_key',
      'authorization',
    ];
    // 機密情報をマスキング（最初の4文字と最後の4文字を表示、中間は***）
  };
```

**推奨事項**:
- ✅ 現在の実装で十分
- 機密情報のマスキング機能が適切に実装されている

---

## 2. 外部サービス連携とデータ送信

### 2.1 外部APIへの接続 ⚠️ 改善の余地あり

**評価**: ⚠️ **改善の余地あり**

**確認内容**:
- GitHub API: アップデートチェック用（`https://api.github.com`）
- Hugging Face Hub API: モデル検索・情報取得用（`https://huggingface.co`）
- これらの接続はユーザーに明示的に通知されていない可能性がある

**実装状況**:
```27:27:src-tauri/tauri.conf.json
      "csp": "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' http://localhost:11434 http://localhost:1420 https://api.github.com https://huggingface.co https://*.huggingface.co; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;"
```

**問題点**:
1. 外部APIへの接続が自動的に行われる（ユーザーの明示的な同意なし）
2. プライバシーポリシーに外部API接続についての記載が不十分

**推奨事項**:
- 🟡 **中優先度**: プライバシーポリシーに外部API接続についての詳細な説明を追加
- 🟡 **中優先度**: 初回起動時または設定画面で外部API接続についてユーザーに通知
- 🟢 **低優先度**: 外部API接続をオプション化（オフライン機能を維持）

---

### 2.2 モデル共有機能 ⚠️ 改善の余地あり

**評価**: ⚠️ **改善の余地あり**

**確認内容**:
- Hugging Face Hubへのモデルアップロード機能が実装されている
- ユーザーが明示的に共有を選択する必要があるが、同意プロセスが不十分

**実装状況**:
```103:180:src-tauri/src/utils/model_sharing.rs
async fn upload_to_huggingface_hub(config: &ModelSharingConfigExtended) -> Result<SharedModelInfo, AppError> {
    // Hugging Face Hub APIへのアップロードには認証トークンが必要
    let token = config.platform_token.as_ref().ok_or_else(|| AppError::ApiError {
        message: "Hugging Face Hubの認証トークンが必要です".to_string(),
        code: "TOKEN_REQUIRED".to_string(),
        source_detail: None,
    })?;
    // ... リポジトリ作成とアップロード処理
}
```

**問題点**:
1. モデル共有時の同意プロセスが不明確
2. 共有されるデータの範囲が明確でない
3. 共有後のデータ削除方法が不明確

**推奨事項**:
- 🟡 **中優先度**: モデル共有前に明確な同意ダイアログを表示
- 🟡 **中優先度**: 共有されるデータの詳細を明示（モデルファイル、メタデータ、ライセンス情報など）
- 🟡 **中優先度**: 共有後のデータ削除方法を明確化

---

### 2.3 クラウド同期機能 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- GitHub Gistへの同期機能が実装されている
- ユーザーが明示的に有効化する必要がある
- アクセストークンが必要（ユーザーが提供）

**実装状況**:
```146:155:src-tauri/src/utils/remote_sync.rs
async fn sync_to_github_gist(
    config: &RemoteAccessConfig,
    settings_data: &str,
) -> Result<(), AppError> {
    if config.access_token.is_none() {
        return Err(AppError::ApiError {
            message: "GitHubアクセストークンが必要です".to_string(),
            code: "MISSING_TOKEN".to_string(),
            source_detail: None
        });
    }
    // ... 同期処理
}
```

**推奨事項**:
- ✅ 現在の実装で十分
- オプトイン方式で実装されており、ユーザーの明示的な同意が必要

---

## 3. トラッキングと分析

### 3.1 アプリケーション内トラッキング ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- Cookieやトラッキング技術を使用していない
- ローカルストレージの使用は最小限（設定情報のみ）
- 外部の分析サービス（Google Analytics等）を使用していない

**実装状況**:
```133:144:src/pages/PrivacyPolicy.tsx
          <section className="privacy-policy-section">
            <h2 className="privacy-policy-section-title">
              7. Cookieとトラッキング
            </h2>
            <div className="privacy-policy-text-content">
              <p>
                本アプリケーションは、Cookieやトラッキング技術を使用しません。
                すべてのデータはローカルデバイス上で処理されます。
              </p>
            </div>
          </section>
```

**推奨事項**:
- ✅ 現在の実装で十分

---

### 3.2 ウェブサイトのトラッキング ⚠️ 改善の余地あり

**評価**: ⚠️ **改善の余地あり**

**確認内容**:
- ウェブサイト（`WEB/`ディレクトリ）にGoogle Analyticsの統合準備がある
- ダウンロード追跡機能が実装されている（ローカルストレージ使用）

**実装状況**:
```63:78:WEB/js/download.js
function trackDownload(os) {
  // 将来的にGoogle Analytics等のトラッキングコードを追加可能
  console.log(`Download initiated for OS: ${os}`);
  
  // ローカルストレージに記録（オプション）
  try {
    const downloads = JSON.parse(localStorage.getItem('flm_downloads') || '[]');
    downloads.push({
      os: os,
      timestamp: new Date().toISOString()
    });
    localStorage.setItem('flm_downloads', JSON.stringify(downloads));
  } catch (e) {
    // エラーは無視
  }
}
```

**問題点**:
1. Google Analytics統合の準備がされているが、プライバシーポリシーに記載がない
2. ダウンロード追跡がローカルストレージに保存される（ユーザーに通知されていない）

**推奨事項**:
- 🟡 **中優先度**: ウェブサイトにプライバシーポリシーを追加
- 🟡 **中優先度**: Google Analyticsを使用する場合は、ユーザーにCookie同意を求める
- 🟢 **低優先度**: ダウンロード追跡をオプトイン方式に変更

---

## 4. ユーザー権利と透明性

### 4.1 データアクセス権 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- ユーザーは自分のデータにアクセスできる
- エクスポート機能が実装されている
- データベースファイルに直接アクセス可能

**実装状況**:
```147:158:src/pages/PrivacyPolicy.tsx
          <section className="privacy-policy-section">
            <h2 className="privacy-policy-section-title">8. ユーザーの権利</h2>
            <div className="privacy-policy-text-content">
              <p>ユーザーは以下の権利を有します：</p>
              <ul>
                <li>自分のデータにアクセスする権利</li>
                <li>データの修正・更新する権利</li>
                <li>データの削除を要求する権利</li>
                <li>データのエクスポートする権利</li>
              </ul>
            </div>
          </section>
```

**推奨事項**:
- ✅ 現在の実装で十分

---

### 4.2 データ削除権 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- アプリケーション内からログを削除できる
- アンインストール時にデータを削除できる
- データベースファイルを手動で削除可能

**実装状況**:
```120:131:src/pages/PrivacyPolicy.tsx
          <section className="privacy-policy-section">
            <h2 className="privacy-policy-section-title">6. データの削除</h2>
            <div className="privacy-policy-text-content">
              <p>ユーザーは、いつでも以下の方法でデータを削除できます：</p>
              <ul>
                <li>アプリケーション内の設定画面からログを削除</li>
                <li>アプリケーションのアンインストール</li>
                <li>データベースファイルの手動削除</li>
              </ul>
            </div>
          </section>
```

**推奨事項**:
- ✅ 現在の実装で十分

---

### 4.3 透明性 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- プライバシーポリシーが明確に記載されている
- データの使用目的が明記されている
- オープンソースプロジェクトとして透明性が高い

**推奨事項**:
- ✅ 現在の実装で十分

---

## 5. セキュリティと倫理

### 5.1 APIキーの管理 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- APIキーは32文字以上のランダム文字列
- AES-256-GCMで暗号化保存
- SHA256ハッシュによる検証
- タイミング攻撃対策が実装されている

**推奨事項**:
- ✅ 現在の実装で十分

---

### 5.2 通信のセキュリティ ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- HTTPS必須実装（HTTPは完全に無効化）
- 自己署名証明書を自動生成
- HTTP→HTTPS自動リダイレクト

**実装状況**:
```1:22:SECURITY_POLICY.md
# FLM セキュリティポリシー

## 🔒 セキュリティ方針

**FLMは、すべてのAPI通信をHTTPSで暗号化します。HTTPは使用できません。**

### 理由

1. **パスワード・APIキーの保護**: HTTPではAPIキーやパスワードが平文で送信されるため、中間者攻撃（MITM）で漏洩するリスクがあります
2. **データ改ざん防止**: HTTPSにより通信内容の改ざんを検知できます
3. **プライバシー保護**: ユーザーのリクエスト内容が暗号化されます
```

**推奨事項**:
- ✅ 現在の実装で十分

---

### 5.3 外部公開時のセキュリティ ⚠️ 改善の余地あり

**評価**: ⚠️ **改善の余地あり**

**確認内容**:
- デフォルトで外部（ローカルネットワーク）からのアクセスに対応
- IPホワイトリスト機能が実装されている
- レート制限機能が実装されている

**問題点**:
1. 外部公開時のリスクについての警告が不十分
2. デフォルトで外部アクセス可能な設定がユーザーに明確に通知されていない

**推奨事項**:
- 🟡 **中優先度**: 外部公開時に明確な警告を表示
- 🟡 **中優先度**: 外部公開のリスクについてのドキュメントを追加
- 🟢 **低優先度**: 外部公開をオプトイン方式に変更（デフォルトはlocalhostのみ）

---

## 6. バイアスと差別

### 6.1 言語サポート ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- 多言語対応（日本語、英語、中国語、韓国語、スペイン語、フランス語、ドイツ語）
- 言語設定はユーザーが自由に選択可能

**実装状況**:
```340:347:src/pages/Settings.tsx
                  <option value="ja">{t('settings.language.japanese')}</option>
                  <option value="en">{t('settings.language.english')}</option>
                  <option value="zh">{t('settings.language.chinese')}</option>
                  <option value="ko">{t('settings.language.korean')}</option>
                  <option value="es">{t('settings.language.spanish')}</option>
                  <option value="fr">{t('settings.language.french')}</option>
                  <option value="de">{t('settings.language.german')}</option>
```

**推奨事項**:
- ✅ 現在の実装で十分

---

### 6.2 アクセシビリティ ⚠️ 改善の余地あり

**評価**: ⚠️ **改善の余地あり**

**確認内容**:
- ARIAラベルが一部のコンポーネントに実装されている
- キーボードショートカットが実装されている

**問題点**:
1. すべてのUIコンポーネントにARIAラベルが実装されていない可能性
2. スクリーンリーダー対応が完全ではない可能性

**推奨事項**:
- 🟡 **中優先度**: アクセシビリティ監査を実施
- 🟡 **中優先度**: すべてのインタラクティブ要素にARIAラベルを追加
- 🟢 **低優先度**: WCAG 2.1 AA準拠を目指す

---

## 7. 同意とオプトイン/オプトアウト

### 7.1 初回起動時の同意 ✅ 良好

**評価**: ✅ **良好**

**確認内容**:
- オンボーディング機能が実装されている
- プライバシーポリシーへのアクセスが容易

**推奨事項**:
- 🟡 **中優先度**: 初回起動時にプライバシーポリシーへの同意を明示的に求める

---

### 7.2 機能別の同意 ⚠️ 改善の余地あり

**評価**: ⚠️ **改善の余地あり**

**問題点**:
1. 外部API接続（GitHub、Hugging Face）についての明示的な同意がない
2. モデル共有機能についての同意プロセスが不十分

**推奨事項**:
- 🟡 **中優先度**: 外部API接続時にユーザーに通知
- 🟡 **中優先度**: モデル共有前に明確な同意ダイアログを表示

---

## 8. 総合評価と推奨事項

### 8.1 総合評価

**評価**: ✅ **良好（改善の余地あり）**

FLMアプリケーションは、全体的にプライバシーとユーザー権利を尊重する設計となっています。主な強みは以下の通りです：

1. ✅ **ローカルデータ保存**: すべてのデータがローカルに保存され、外部送信が最小限
2. ✅ **透明性**: プライバシーポリシーが明確に記載されている
3. ✅ **セキュリティ**: 強力な暗号化とHTTPS必須実装
4. ✅ **ユーザー権利**: データアクセス、削除、エクスポート機能が実装されている

一方で、以下の点で改善の余地があります：

1. ⚠️ **外部API接続の透明性**: GitHub APIやHugging Face Hub APIへの接続について、ユーザーへの通知が不十分
2. ⚠️ **モデル共有の同意プロセス**: 共有前の明確な同意ダイアログが必要
3. ⚠️ **ウェブサイトのトラッキング**: Google Analytics統合準備があるが、プライバシーポリシーに記載がない

---

### 8.2 優先度別推奨事項

#### 🔴 高優先度（即座に対応推奨）
なし

#### 🟡 中優先度（近い将来に対応推奨）
1. **プライバシーポリシーの拡充**
   - 外部API接続（GitHub、Hugging Face）についての詳細な説明を追加
   - ウェブサイトのトラッキングについての記載を追加

2. **外部API接続の通知**
   - 初回起動時または設定画面で外部API接続についてユーザーに通知
   - 外部API接続をオプション化（オフライン機能を維持）

3. **モデル共有の同意プロセス**
   - モデル共有前に明確な同意ダイアログを表示
   - 共有されるデータの詳細を明示
   - 共有後のデータ削除方法を明確化

4. **外部公開時の警告**
   - 外部公開時に明確な警告を表示
   - 外部公開のリスクについてのドキュメントを追加

#### 🟢 低優先度（将来的な改善として検討）
1. **アクセシビリティの向上**
   - アクセシビリティ監査を実施
   - WCAG 2.1 AA準拠を目指す

2. **ウェブサイトのトラッキング**
   - Google Analyticsを使用する場合は、ユーザーにCookie同意を求める
   - ダウンロード追跡をオプトイン方式に変更

---

## 9. 結論

FLMアプリケーションは、プライバシーとユーザー権利を尊重する設計となっており、全体的に倫理的な実装がなされています。主な改善点は、外部API接続の透明性向上と、モデル共有機能の同意プロセス強化です。これらの改善により、さらに高いレベルの倫理的実装を達成できると考えられます。

---

**監査実施者**: AI Assistant  
**最終更新**: 2025年1月  
**次回監査推奨時期**: 新機能追加時、または6ヶ月後

