# プライバシー監査レポート 包括版（第5回監査）

**プロジェクト名**: FLM (Local LLM API Manager)  
**監査日**: 2025年1月（第5回監査）  
**バージョン**: 1.0.0  
**監査者**: AI アシスタント  
**監査範囲**: コードベース全体の完全な分析（プラグイン、スケジューラー、診断、アップデーター、モデル共有を含む）

---

## エグゼクティブサマリー

本レポートは、FLMアプリケーションのプライバシーに関する第5回目の包括的な監査結果をまとめたものです。これまでの監査で見落としていた可能性のある領域（プラグインシステム、スケジューラー、診断機能、アップデーター、モデル共有）を詳細に分析し、完全なプライバシー評価を提示します。

### 総合評価

**プライバシー保護レベル**: ⚠️ **中程度（前回と同様）**

### 新たに発見された重要な問題

1. **診断機能でのシステム情報収集**: CPU、メモリ、ディスク情報が収集される
2. **アップデーター機能での通信**: GitHub APIに接続してバージョン情報を取得
3. **モデル共有機能**: 外部サービスへの送信の可能性
4. **プラグインシステム**: プラグインがデータにアクセスする可能性
5. **スケジューラー機能**: 自動タスクでのデータ処理

---

## 1. 診断機能での情報収集

### 1.1 収集される情報

**ファイル**: `src/pages/Diagnostics.tsx`, `src-tauri/src/commands/system.rs`

#### 収集内容
1. **システムリソース情報**
   - 総メモリ、利用可能メモリ
   - CPUコア数、CPU使用率
   - 総ディスク容量、利用可能ディスク容量
   - リソースレベル評価

2. **ファイルシステム情報**
   - ディスク容量の十分性
   - 利用可能ディスク容量（GB）

3. **Ollama情報**
   - ポート番号
   - パス情報（ポータブルパス、システムパス）

4. **API情報**
   - API一覧
   - ポートステータス

5. **データベース情報**
   - 整合性チェック結果

6. **エンジン情報**
   - インストール済みエンジン一覧

7. **モデル情報**
   - インストール済みモデル一覧

8. **プラグイン情報**
   - プラグイン一覧

9. **スケジュールタスク情報**
   - スケジュールタスク一覧

#### 評価: ⚠️ **改善推奨**
- **問題点**:
  - システム情報（CPU、メモリ、ディスク）が収集される
  - ファイルパス情報が含まれる
  - 個人を特定できる情報ではないが、システム情報が含まれる
- **推奨事項**:
  - プライバシーポリシーに明記
  - 診断情報の収集をオプトイン方式に変更
  - 診断情報の保存期間を設定

### 1.2 診断情報の保存

#### 保存場所
- メモリ内キャッシュ（30秒間）
- データベースには保存されない

#### 評価: ✅ **良好**
- 一時的な保存のみ
- 外部送信は行われない

---

## 2. アップデーター機能

### 2.1 アップデートチェック

**ファイル**: `src-tauri/src/commands/updater.rs`

#### 通信内容
- **接続先**: GitHub API
- **送信データ**: なし（GETリクエストのみ）
- **受信データ**: 最新バージョン情報

#### 評価: ✅ **問題なし**
- 技術的な情報のみ
- 個人情報は含まれない
- バージョン情報のみを取得

### 2.2 アップデート情報の保存

#### 保存場所
- メモリ内（一時的）
- データベースには保存されない

#### 評価: ✅ **良好**
- 一時的な保存のみ

---

## 3. モデル共有機能

### 3.1 モデル共有の実装

**ファイル**: `src-tauri/src/commands/model_sharing.rs`, `src-tauri/src/utils/model_sharing.rs`

#### 機能
- モデルの共有
- 共有モデルの検索
- 共有モデルのダウンロード

#### 評価: ⚠️ **要確認**
- **問題点**:
  - 外部サービスへの送信の可能性
  - 送信されるデータの内容が不明確
- **推奨事項**:
  - モデル共有機能の実装詳細を確認
  - 送信されるデータの内容を明確化
  - プライバシーポリシーに明記

---

## 4. プラグインシステム

### 4.1 プラグインのデータアクセス

**ファイル**: `src-tauri/src/commands/plugin.rs`

#### プラグインの種類
- Logging（ロギング）
- その他のプラグインタイプ

#### プラグインコンテキスト
```rust
pub struct PluginContext {
    pub data: serde_json::Value,
}
```

#### 評価: ⚠️ **改善推奨**
- **問題点**:
  - プラグインがデータにアクセスする可能性
  - プラグインが外部にデータを送信する可能性
  - プラグインの動作が不明確
- **推奨事項**:
  - プラグインの権限管理
  - プラグインのデータアクセス制限
  - プラグインの動作監査

---

## 5. スケジューラー機能

### 5.1 スケジュールタスク

**ファイル**: `src-tauri/src/commands/scheduler.rs`

#### タスクの種類
1. **UpdateModelCatalog**（モデルカタログの更新）
   - 評価: ✅ 問題なし（ローカルデータのみ）

2. **CleanupLogs**（ログのクリーンアップ）
   - 評価: ✅ 問題なし（ローカルデータのみ）

3. **AutoBackup**（自動バックアップ）
   - 評価: ⚠️ **改善推奨**（バックアップファイルの暗号化が必要）

#### 評価: ⚠️ **改善推奨**
- **問題点**:
  - 自動バックアップが暗号化されていない可能性
  - スケジュールタスクの実行ログが不明確
- **推奨事項**:
  - 自動バックアップの暗号化
  - スケジュールタスクの実行ログの管理

---

## 6. Hugging Face API統合

### 6.1 モデル検索

**ファイル**: `src-tauri/src/utils/huggingface.rs`

#### 通信内容
- **接続先**: `https://huggingface.co/api/models`
- **送信データ**: 検索クエリ（URLエンコード）
- **受信データ**: モデル情報

#### 評価: ✅ **問題なし**
- 技術的な情報のみ
- 個人情報は含まれない
- 検索クエリのみを送信

---

## 7. システム情報収集の詳細

### 7.1 収集されるシステム情報

**ファイル**: `src-tauri/src/commands/system.rs`

#### 収集内容
1. **メモリ情報**
   - 総メモリ（バイト）
   - 利用可能メモリ（バイト）

2. **CPU情報**
   - CPUコア数
   - CPU使用率（%）

3. **ディスク情報**
   - 総ディスク容量（バイト）
   - 利用可能ディスク容量（バイト）

4. **リソースレベル評価**
   - "low", "medium", "high" などの評価

#### 評価: ⚠️ **改善推奨**
- **問題点**:
  - システム情報が収集される
  - 個人を特定できる情報ではないが、システム構成情報が含まれる
- **推奨事項**:
  - プライバシーポリシーに明記
  - システム情報収集のオプトアウト機能
  - システム情報の保存期間を設定

---

## 8. 前回監査からの改善状況

### 8.1 改善された点

1. **エラーハンドリング**: 機密情報の漏洩を防ぐ設計が確認された（✅）
2. **バックアップ機能**: APIキーは暗号化された状態でバックアップされる（✅）
3. **デバッグログ**: リリースビルドで無効化される（✅）
4. **パフォーマンスメトリクス**: ローカルデータベースにのみ保存（✅）

### 8.2 依然として改善が必要な点

1. **リクエストログの管理**: ログ保存期間の設定がない（⚠️）
2. **データ保持期間**: 不明確（⚠️）
3. **プライバシーポリシー**: 診断機能、システム情報収集が明記されていない（⚠️）
4. **OAuthトークンの保存**: 暗号化の有無が不明確（⚠️）
5. **バックアップファイル**: 暗号化されていない（⚠️）
6. **ウェブサイトでの追跡**: ユーザーに通知されていない（⚠️）
7. **パフォーマンスメトリクス**: CPU/メモリ使用率の収集が明記されていない（⚠️）
8. **IPアドレスの使用**: レート制限での使用が明記されていない（⚠️）

### 8.3 新たに発見された問題

1. **診断機能でのシステム情報収集**: CPU、メモリ、ディスク情報（⚠️）
2. **プラグインシステム**: データアクセスの制限が不明確（⚠️）
3. **スケジューラー機能**: 自動バックアップの暗号化が必要（⚠️）
4. **モデル共有機能**: 外部送信の詳細が不明確（⚠️）

---

## 9. 優先度別改善提案（完全版）

### 🔴 高優先度（即座に対応すべき項目）

1. **プライバシーポリシーの包括的な更新**
   - 診断機能でのシステム情報収集を明記
   - パフォーマンスメトリクスの収集を明記
   - IPアドレスの使用を明記
   - プラグインシステムのデータアクセスを明記
   - スケジューラー機能を明記

2. **ウェブサイトでのダウンロード追跡の改善**
   - プライバシーポリシーに明記
   - オプトイン方式に変更
   - ユーザーへの通知

3. **バックアップファイルの暗号化**
   - バックアップファイルの暗号化オプション
   - パスワード保護機能
   - 自動バックアップの暗号化

4. **バックアップ時のリクエストログ除外オプション**
   - バックアップ時にリクエストボディを除外するオプション
   - デフォルトで除外する設定

### 🟡 中優先度（近い将来に対応すべき項目）

1. **OAuthトークンの暗号化保存**
   - トークンの保存場所を確認
   - APIキーと同様の暗号化を実装

2. **リクエストログの改善**
   - ログ保存期間の設定機能
   - 自動ログ削除機能
   - マスク処理の強化

3. **IPアドレスのハッシュ化**
   - レート制限でのIPアドレスハッシュ化
   - ログにIPアドレスを含めない設定

4. **パフォーマンスメトリクスのオプトアウト**
   - メトリクス収集の有効/無効設定
   - CPU/メモリ使用率の収集を無効化するオプション

5. **診断機能のオプトイン**
   - 診断情報収集の有効/無効設定
   - システム情報収集のオプトアウト機能

6. **プラグインシステムの権限管理**
   - プラグインの権限設定
   - プラグインのデータアクセス制限
   - プラグインの動作監査

7. **環境変数のドキュメント**
   - 環境変数の一覧と説明
   - 機密情報を含む環境変数の明確化

8. **データ保持期間の明確化**
   - データ保持期間の設定機能
   - 自動削除機能の実装

### 🟢 低優先度（長期的に対応すべき項目）

1. **データベースの暗号化**
   - SQLCipherなどの使用を検討

2. **キャッシュの暗号化**
   - メモリ内キャッシュの暗号化（低優先度）

3. **デバイスIDの改善**
   - オプトアウト機能の提供
   - デバイスIDの使用目的の明確化

4. **モデル共有機能の詳細確認**
   - 外部送信の詳細を確認
   - プライバシーポリシーに明記

---

## 10. コード実装の推奨事項

### 10.1 診断機能のオプトイン

```typescript
// src/pages/Diagnostics.tsx に追加
interface DiagnosticsSettings {
  enabled: boolean;
  collectSystemInfo: boolean;
  collectResourceInfo: boolean;
}

const [diagnosticsSettings, setDiagnosticsSettings] = useState<DiagnosticsSettings>({
  enabled: false, // デフォルトで無効
  collectSystemInfo: false,
  collectResourceInfo: false,
});
```

### 10.2 プラグインの権限管理

```rust
// src-tauri/src/commands/plugin.rs に追加
pub struct PluginPermissions {
    pub can_access_api_keys: bool,
    pub can_access_request_logs: bool,
    pub can_access_performance_metrics: bool,
    pub can_send_external_data: bool,
}

pub struct PluginContext {
    pub data: serde_json::Value,
    pub permissions: PluginPermissions,
}
```

### 10.3 自動バックアップの暗号化

```rust
// src-tauri/src/commands/scheduler.rs に追加
pub async fn execute_auto_backup_task() -> Result<(), AppError> {
    let backup_data = create_backup_data().await?;
    let encrypted = encrypt_backup(&backup_data, &get_backup_password())?;
    save_encrypted_backup(&encrypted).await?;
    Ok(())
}
```

---

## 11. プライバシーポリシーの更新推奨事項（完全版）

### 11.1 追加すべき項目（完全リスト）

1. **診断機能**
   - 診断情報の収集目的
   - 収集されるシステム情報（CPU、メモリ、ディスク）
   - 診断情報の保存場所
   - 診断情報の保存期間
   - オプトイン/オプトアウト方法

2. **パフォーマンスメトリクスの収集**
   - 収集されるメトリクスの種類
   - CPU/メモリ使用率の収集
   - メトリクスの保存場所
   - オプトアウト方法

3. **IPアドレスの使用**
   - レート制限での使用目的
   - 証明書生成での使用目的
   - IPアドレスの保存場所
   - ハッシュ化の有無

4. **キャッシュ機能**
   - キャッシュの種類
   - キャッシュに保存されるデータ
   - キャッシュの保持期間
   - キャッシュのクリア方法

5. **プラグインシステム**
   - プラグインのデータアクセス権限
   - プラグインの外部送信の有無
   - プラグインの動作監査

6. **スケジューラー機能**
   - スケジュールタスクの種類
   - 自動バックアップの設定
   - スケジュールタスクの実行ログ

7. **アップデーター機能**
   - アップデートチェックの頻度
   - 送信されるデータ
   - 受信されるデータ

8. **モデル共有機能**
   - モデル共有の仕組み
   - 外部送信の有無
   - 送信されるデータ

9. **Hugging Face API統合**
   - 接続先
   - 送信されるデータ
   - 受信されるデータ

10. **ブラウザストレージの使用**
    - localStorageの使用目的
    - 保存されるデータの種類
    - データの保持期間

11. **ウェブサイトでの追跡**
    - ダウンロード追跡の目的
    - 収集されるデータ
    - オプトアウト方法

12. **バックアップ機能**
    - バックアップに含まれるデータ
    - バックアップファイルの保存場所
    - バックアップファイルの暗号化

13. **環境変数**
    - 使用される環境変数
    - 機密情報を含む環境変数
    - 環境変数の管理方法

---

## 12. 結論

### 総合評価

- **暗号化実装**: ✅ 優秀（OSキーストアの使用）
- **データ収集**: ⚠️ 中程度のリスク（診断機能、パフォーマンスメトリクス、システム情報）
- **データ保存**: ⚠️ 中程度のリスク（キャッシュ、バックアップファイルの暗号化）
- **データ送信**: ⚠️ 中程度のリスク（リモート同期、アップデーター、Hugging Face API）
- **ユーザーコントロール**: ⚠️ 改善が必要（プライバシー設定の追加、オプトイン/オプトアウト機能）

### 前回監査との比較

- **改善された点**: パフォーマンスメトリクス、エラーハンドリングの詳細が確認された
- **新たに発見された問題**: 診断機能、プラグインシステム、スケジューラー機能、モデル共有機能
- **依然として改善が必要**: ログ管理、データ保持期間、プライバシーポリシー

### 監査履歴

- **第1回監査**: 基本的なプライバシー監査
- **第2回監査**: 詳細なコード分析
- **第3回監査**: 包括的な分析（バックアップ、ウェブサイト）
- **第4回監査**: 最終詳細分析（パフォーマンスメトリクス、キャッシュ、アラート、証明書生成）
- **第5回監査**: 完全包括的分析（プラグイン、スケジューラー、診断、アップデーター、モデル共有）

### 次のステップ

1. 高優先度項目の実装（プライバシーポリシー更新、ウェブサイト追跡改善、バックアップ暗号化）
2. 中優先度項目の実装（診断機能オプトイン、プラグイン権限管理、IPアドレスハッシュ化）
3. ユーザーへの通知と同意取得
4. 定期的な監査の実施（3ヶ月ごと推奨）

---

## 付録

### A. 確認したファイル一覧（完全版）

#### Rust実装
- `src-tauri/src/database/encryption.rs` - 暗号化実装（✅ 優秀）
- `src-tauri/src/commands/database.rs` - データベース操作
- `src-tauri/src/commands/oauth.rs` - OAuth認証（⚠️ 改善必要）
- `src-tauri/src/commands/backup.rs` - バックアップ機能（⚠️ 改善必要）
- `src-tauri/src/commands/performance.rs` - パフォーマンスメトリクス（⚠️ 改善推奨）
- `src-tauri/src/commands/alerts.rs` - アラート機能（✅ 問題なし）
- `src-tauri/src/commands/system.rs` - システム情報収集（⚠️ 改善推奨）
- `src-tauri/src/commands/plugin.rs` - プラグインシステム（⚠️ 改善推奨）
- `src-tauri/src/commands/scheduler.rs` - スケジューラー機能（⚠️ 改善推奨）
- `src-tauri/src/commands/updater.rs` - アップデーター機能（✅ 問題なし）
- `src-tauri/src/commands/model_sharing.rs` - モデル共有機能（⚠️ 要確認）
- `src-tauri/src/utils/remote_sync.rs` - リモート同期（⚠️ 改善必要）
- `src-tauri/src/utils/cache.rs` - キャッシュ機能（⚠️ 改善推奨）
- `src-tauri/src/utils/huggingface.rs` - Hugging Face API統合（✅ 問題なし）
- `src-tauri/src/utils/audit_log.rs` - 監査ログ
- `src-tauri/src/utils/error.rs` - エラーハンドリング（✅ 良好）
- `src-tauri/src/lib.rs` - メインライブラリ（✅ デバッグログ制御良好）

#### TypeScript実装
- `src/backend/auth/server.ts` - 認証サーバー、リクエストログ、パフォーマンスメトリクス（⚠️ 改善推奨）
- `src/backend/auth/database.ts` - データベース操作
- `src/backend/auth/rate-limit.ts` - レート制限（⚠️ IPアドレス使用）
- `src/backend/auth/rate-limit-redis.ts` - Redisレート制限（⚠️ IPアドレス使用）
- `src/backend/auth/certificate-generator.ts` - 証明書生成（✅ 問題なし）
- `src/utils/errorHandler.ts` - エラーハンドリング（✅ 良好）
- `src/utils/logger.ts` - ロガー（⚠️ ログレベル制御改善必要）
- `src/components/onboarding/Onboarding.tsx` - オンボーディング（✅ 問題なし）
- `src/pages/Diagnostics.tsx` - 診断機能（⚠️ システム情報収集）

#### ウェブサイト
- `WEB/js/download.js` - ダウンロード追跡（⚠️ 改善必要）

#### 設定ファイル
- `src-tauri/tauri.conf.json` - Tauri設定、CSPポリシー（✅ 適切）
- `DOCKS/DATABASE_SCHEMA.sql` - データベーススキーマ

### B. データフロー図（完全版）

```
ユーザー入力
    ↓
フロントエンド（React）
    ├─ 診断機能（システム情報収集）⚠️
    ├─ パフォーマンスダッシュボード
    └─ その他のUI
    ↓
Tauri IPC
    ↓
バックエンド（Rust）
    ├─ プラグインシステム（データアクセス）⚠️
    ├─ スケジューラー（自動タスク）⚠️
    └─ その他のコマンド
    ↓
SQLiteデータベース
    ├─ APIキー（暗号化）✅
    ├─ パフォーマンスメトリクス（CPU/メモリ使用率）⚠️
    ├─ リクエストログ（マスク処理あり）⚠️
    └─ アラート履歴 ✅
    ↓
メモリ内キャッシュ（API設定）⚠️
    ↓
外部サービス
    ├─ GitHub API（アップデートチェック）✅
    ├─ Hugging Face API（モデル検索）✅
    ├─ リモート同期（GitHub Gists/Google Drive/Dropbox）⚠️
    └─ モデル共有（詳細不明）⚠️
    ↓
バックアップ（JSON、暗号化なし）⚠️
```

### C. プライバシーリスクマトリックス（完全版）

| データ種別 | 収集 | 保存 | 送信 | リスクレベル |
|-----------|------|------|------|------------|
| APIキー | ✅ | ✅（暗号化） | ❌ | 🟢 低 |
| OAuthトークン | ✅ | ⚠️（不明） | ❌ | 🟡 中 |
| リクエストログ | ✅ | ✅ | ❌ | 🟡 中 |
| パフォーマンスメトリクス | ✅ | ✅ | ❌ | 🟡 中 |
| システム情報（診断） | ✅ | ⚠️（一時的） | ❌ | 🟡 中 |
| IPアドレス | ✅ | ⚠️（一時的） | ❌ | 🟡 中 |
| 設定情報 | ✅ | ✅ | ⚠️（リモート同期） | 🟡 中 |
| デバイスID | ✅ | ✅ | ⚠️（リモート同期） | 🟡 中 |
| ダウンロード追跡 | ✅ | ✅（localStorage） | ❌ | 🟢 低 |
| キャッシュ（API設定） | ✅ | ⚠️（メモリ内） | ❌ | 🟢 低 |
| プラグインデータ | ⚠️ | ⚠️ | ⚠️（不明） | 🟡 中 |
| バージョン情報 | ✅ | ⚠️（一時的） | ⚠️（GitHub API） | 🟢 低 |

### D. 外部サービス接続一覧（完全版）

1. **GitHub API** (`https://api.github.com`)
   - 用途: アップデートチェック、Gist同期
   - 送信データ: なし（GETリクエストのみ）、設定データ（Gist）
   - プライバシーリスク: 低（技術情報のみ）

2. **Hugging Face API** (`https://huggingface.co`, `https://*.huggingface.co`)
   - 用途: モデル取得、モデル検索
   - 送信データ: 検索クエリ
   - プライバシーリスク: 低（技術情報のみ）

3. **Google Drive API** (`https://www.googleapis.com`)
   - 用途: リモート同期
   - 送信データ: 設定データ、デバイスID
   - プライバシーリスク: 中（設定データが含まれる）

4. **Dropbox API** (`https://content.dropboxapi.com`)
   - 用途: リモート同期
   - 送信データ: 設定データ、デバイスID
   - プライバシーリスク: 中（設定データが含まれる）

5. **モデル共有サービス**（詳細不明）
   - 用途: モデル共有
   - 送信データ: 不明
   - プライバシーリスク: 不明（要確認）

---

**レポート作成日**: 2025年1月（第5回監査）  
**次回監査推奨日**: 2025年4月（3ヶ月後）  
**監査方法**: コードベース全体の完全な分析、実装コードの詳細確認、データフローの完全な追跡、新機能の包括的分析

