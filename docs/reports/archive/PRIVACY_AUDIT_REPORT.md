# プライバシー監査レポート

**プロジェクト名**: FLM (Local LLM API Manager)  
**監査日**: 2025年1月  
**バージョン**: 1.0.0  
**監査者**: AI アシスタント

---

## エグゼクティブサマリー

本レポートは、FLMアプリケーションのプライバシーに関する包括的な監査結果をまとめたものです。データ収集、保存、送信、処理に関する実装を詳細に分析し、プライバシーリスクと改善提案を提示します。

### 総合評価

**プライバシー保護レベル**: ⚠️ **中程度**

主な懸念事項：
- リクエストログに個人情報が含まれる可能性
- リモート同期機能による外部サービスへのデータ送信
- ログファイルの保存期間と削除ポリシーの不明確さ

---

## 1. データ収集と保存

### 1.1 データベースに保存される情報

#### 1.1.1 API設定情報 (`apis` テーブル)
- **保存データ**: API名、モデル名、ポート番号、認証設定、ステータス
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし
  - 技術的な設定情報のみで、個人を特定できる情報は含まれない

#### 1.1.2 APIキー (`api_keys` テーブル)
- **保存データ**: 暗号化されたAPIキー（AES-256-GCM）
- **プライバシーリスク**: 中
- **評価**: ⚠️ 改善推奨
  - **現状**: 暗号化は実装されているが、暗号化キーの管理方法が不明確
  - **推奨事項**:
    - 暗号化キーの保存場所を明確に文書化
    - OSのキーチェーン/資格情報マネージャーの使用を検討
    - 暗号化キーのローテーション機能の実装

#### 1.1.3 リクエストログ (`request_logs` テーブル)
- **保存データ**: 
  - HTTPメソッド、パス
  - リクエストボディ（10KB以下、マスク処理あり）
  - レスポンスステータス、レスポンス時間
  - エラーメッセージ
  - タイムスタンプ
- **プライバシーリスク**: 高
- **評価**: ⚠️ **要改善**
  - **現状**: 
    - リクエストボディに個人情報が含まれる可能性がある
    - マスク処理は実装されているが、完全性が不明
    - ログの保存期間が不明確
  - **現状のマスク処理**:
    - 以下のフィールドがマスク対象: `api_key`, `password`, `token`, `access_token`, `refresh_token`, `secret`, `authorization` など
    - マスク方法: 最初の4文字と最後の4文字を表示、中間を`***`で置換
    - 8文字以下の場合は完全に`***MASKED***`で置換
  - **推奨事項**:
    - ログ保存期間の設定機能を追加
    - 自動ログ削除機能の実装
    - マスク処理の強化（クレジットカード番号、メールアドレス、電話番号、IPアドレスなど）
    - ログ保存のオプトアウト機能
    - リクエストボディ全体のログ保存を無効化するオプション

#### 1.1.4 監査ログ (`audit_log` テーブル)
- **保存データ**: ログイン/ログアウトイベント、API ID、タイムスタンプ
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし
  - 個人を特定できる情報は含まれない

#### 1.1.5 ユーザー設定 (`user_settings` テーブル)
- **保存データ**: アプリケーション設定（Ollamaパス、ポート、テーマなど）
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし

#### 1.1.6 インストール済みモデル情報 (`installed_models` テーブル)
- **保存データ**: モデル名、サイズ、使用回数、最終使用日時
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし

### 1.2 ローカルファイルシステム

#### 1.2.1 データベースファイル
- **場所**: SQLiteデータベースファイル（通常はアプリケーションディレクトリ）
- **プライバシーリスク**: 中
- **評価**: ⚠️ 改善推奨
  - **推奨事項**:
    - データベースファイルのパーミッション設定を確認
    - 暗号化されたデータベースの使用を検討（SQLCipherなど）

#### 1.2.2 証明書ファイル
- **場所**: 証明書生成ディレクトリ
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし

---

## 2. 外部サービスへのデータ送信

### 2.1 リモート同期機能

#### 2.1.1 GitHub Gists API
- **送信データ**: アプリケーション設定（JSON形式）
- **プライバシーリスク**: 中
- **評価**: ⚠️ **要改善**
  - **現状**: 
    - 設定データがGitHub Gistsに保存される
    - 公開/非公開設定が不明確
  - **推奨事項**:
    - デフォルトで非公開Gistを使用
    - ユーザーに明示的な同意を取得
    - 送信前に機密情報をマスク

#### 2.1.2 Google Drive API
- **送信データ**: アプリケーション設定
- **プライバシーリスク**: 中
- **評価**: ⚠️ 改善推奨
  - **推奨事項**:
    - OAuth認証の適切な実装確認
    - スコープの最小化
    - ユーザーへの明示的な説明

#### 2.1.3 Dropbox API
- **送信データ**: アプリケーション設定
- **プライバシーリスク**: 中
- **評価**: ⚠️ 改善推奨
  - **推奨事項**: 上記と同様

### 2.2 モデル取得

#### 2.2.1 Hugging Face API
- **送信データ**: モデル名、ダウンロードリクエスト
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし
  - 技術的な情報のみで、個人情報は含まれない

### 2.3 アップデートチェック

#### 2.3.1 GitHub API
- **送信データ**: アプリケーション名、バージョン情報
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし

---

## 3. 認証情報の管理

### 3.1 OAuthトークン
- **保存場所**: データベースまたはメモリ
- **プライバシーリスク**: 高
- **評価**: ⚠️ **要改善**
  - **現状**: 
    - OAuthトークンが保存されるが、暗号化の有無が不明確
    - トークンの有効期限管理が実装されている
  - **推奨事項**:
    - OAuthトークンの暗号化保存
    - OSのキーチェーン/資格情報マネージャーの使用
    - トークンの自動リフレッシュ機能の確認

### 3.2 APIキー
- **保存方法**: AES-256-GCM暗号化
- **プライバシーリスク**: 中
- **評価**: ⚠️ 改善推奨
  - **推奨事項**: 1.1.2と同様

---

## 4. ログ記録と監視

### 4.1 リクエストログ
- **記録内容**: HTTPリクエスト/レスポンス情報
- **プライバシーリスク**: 高
- **評価**: ⚠️ **要改善**
  - **詳細**: 1.1.3を参照

### 4.2 監査ログ
- **記録内容**: 認証イベント
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし

### 4.3 パフォーマンスメトリクス
- **記録内容**: APIレスポンス時間、使用統計
- **プライバシーリスク**: 低
- **評価**: ✅ 問題なし

### 4.4 コンソールログ
- **記録内容**: デバッグ情報、エラーメッセージ
- **プライバシーリスク**: 中
- **評価**: ⚠️ 改善推奨
  - **推奨事項**:
    - 本番環境でのログレベルの調整
    - 機密情報のログ出力を避ける
    - ログファイルの自動ローテーション

---

## 5. ネットワーク通信

### 5.1 Content Security Policy (CSP)
- **設定**: `tauri.conf.json`でCSPが設定されている
- **許可された接続先**:
  - `http://localhost:11434` (Ollama)
  - `http://localhost:1420` (開発サーバー)
  - `https://api.github.com` (GitHub API)
  - `https://huggingface.co` (Hugging Face)
  - `https://*.huggingface.co` (Hugging Face CDN)
- **評価**: ✅ 適切に設定されている

### 5.2 HTTPS通信
- **評価**: ✅ 外部APIはすべてHTTPSを使用

---

## 6. データ保持と削除

### 6.1 データ保持期間
- **現状**: 不明確
- **評価**: ⚠️ **要改善**
  - **推奨事項**:
    - データ保持期間の設定機能
    - 自動削除機能の実装
    - ユーザーによる手動削除機能

### 6.2 データ削除機能
- **現状**: 不明確
- **評価**: ⚠️ **要改善**
  - **推奨事項**:
    - アプリケーションアンインストール時のデータ削除
    - ユーザーによるデータ削除機能
    - ログの一括削除機能

---

## 7. ユーザーコントロール

### 7.1 プライバシー設定
- **現状**: ログ記録の有効/無効設定が不明確
- **評価**: ⚠️ **要改善**
  - **推奨事項**:
    - ログ記録の有効/無効設定
    - リモート同期の有効/無効設定
    - データ収集のオプトアウト機能

### 7.2 データエクスポート/インポート
- **現状**: リモート同期機能あり
- **評価**: ⚠️ 改善推奨
  - **推奨事項**:
    - エクスポート前に機密情報をマスク
    - エクスポート形式の明確化

---

## 8. サードパーティライブラリ

### 8.1 依存関係の確認
- **評価**: ⚠️ 改善推奨
  - **推奨事項**:
    - 定期的なセキュリティ監査（`npm audit`, `cargo audit`）
    - 依存関係の更新
    - 脆弱性の監視

---

## 9. プライバシーポリシー

### 9.1 プライバシーポリシーの存在
- **現状**: 不明確
- **評価**: ⚠️ **要改善**
  - **推奨事項**:
    - プライバシーポリシーの作成
    - アプリケーション内での表示
    - ユーザーへの通知

---

## 10. 優先度別改善提案

### 🔴 高優先度（即座に対応すべき項目）

1. **リクエストログの改善**
   - ログ保存期間の設定機能
   - 自動ログ削除機能
   - マスク処理の強化

2. **データ保持期間の明確化**
   - データ保持期間の設定機能
   - 自動削除機能の実装

3. **プライバシーポリシーの作成**
   - データ収集・使用・保存に関する明確な説明

### 🟡 中優先度（近い将来に対応すべき項目）

1. **OAuthトークンの暗号化**
   - OSのキーチェーン/資格情報マネージャーの使用

2. **リモート同期の改善**
   - デフォルトで非公開設定
   - ユーザーへの明示的な同意取得

3. **プライバシー設定の追加**
   - ログ記録の有効/無効設定
   - データ収集のオプトアウト機能

### 🟢 低優先度（長期的に対応すべき項目）

1. **データベースの暗号化**
   - SQLCipherなどの使用を検討

2. **依存関係の監視**
   - 定期的なセキュリティ監査の自動化

---

## 11. 推奨される実装

### 11.1 ログ管理機能

```typescript
// ログ保持期間の設定
interface LogRetentionSettings {
  requestLogsDays: number; // リクエストログの保持日数
  auditLogsDays: number;   // 監査ログの保持日数
  enableAutoDelete: boolean; // 自動削除の有効/無効
}

// マスク処理の強化（現在の実装を拡張）
function maskSensitiveData(data: any): any {
  // 現在実装済み: api_key, password, token, access_token, refresh_token, secret, authorization
  // 追加推奨:
  // - メールアドレス（正規表現で検出）
  // - 電話番号（正規表現で検出）
  // - クレジットカード番号（Luhnアルゴリズムで検証後マスク）
  // - IPアドレス（IPv4/IPv6）
  // - 個人名（設定可能なキーワードリスト）
  // - 住所情報
}
```

### 11.2 プライバシー設定UI

- ログ記録の有効/無効
- データ保持期間の設定
- リモート同期の有効/無効
- データ削除機能

### 11.3 プライバシーポリシー

- データ収集の目的
- データの使用方法
- データの保存期間
- データの共有先
- ユーザーの権利

---

## 12. 結論

FLMアプリケーションは、基本的なプライバシー保護機能は実装されていますが、いくつかの改善点があります。特に、リクエストログの管理、データ保持期間の明確化、プライバシーポリシーの作成が重要です。

### 総合評価

- **データ収集**: ⚠️ 中程度のリスク
- **データ保存**: ⚠️ 中程度のリスク
- **データ送信**: ⚠️ 中程度のリスク
- **ユーザーコントロール**: ⚠️ 改善が必要

### 次のステップ

1. 高優先度項目の実装
2. プライバシーポリシーの作成
3. ユーザーへの通知
4. 定期的な監査の実施

---

## 付録

### A. 確認したファイル一覧

- `src-tauri/tauri.conf.json` - Tauri設定、CSPポリシー
- `DOCKS/DATABASE_SCHEMA.sql` - データベーススキーマ
- `src-tauri/src/commands/database.rs` - データベース操作
- `src-tauri/src/commands/oauth.rs` - OAuth認証
- `src-tauri/src/utils/audit_log.rs` - 監査ログ
- `src-tauri/src/utils/remote_sync.rs` - リモート同期
- `src/backend/auth/server.ts` - 認証サーバー、リクエストログ

### B. 外部サービス一覧

- GitHub Gists API - リモート同期
- Google Drive API - リモート同期
- Dropbox API - リモート同期
- Hugging Face API - モデル取得
- GitHub API - アップデートチェック

---

**レポート作成日**: 2025年1月  
**次回監査推奨日**: 2025年4月（3ヶ月後）

