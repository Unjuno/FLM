# FLM - トラブルシューティングガイド

## フェーズ4: ドキュメントエージェント (DOC) 実装

このガイドは、FLMアプリケーションで発生する可能性のある問題とその解決方法を説明します。

---

## 目次

1. [Ollama関連の問題](#ollama関連の問題)
2. [API関連の問題](#api関連の問題)
3. [モデル関連の問題](#モデル関連の問題)
4. [データベース関連の問題](#データベース関連の問題)
5. [認証関連の問題](#認証関連の問題)
6. [パフォーマンスの問題](#パフォーマンスの問題)

---

## Ollama関連の問題

### 問題1: Ollamaが起動しない

#### 症状
- 「Ollamaが実行されていません」というエラー
- API作成時に失敗

#### 原因
- Ollamaのダウンロードが失敗
- Ollamaの実行権限がない（Unix系OS）
- ポート11434が使用されている

#### 解決方法

1. **Ollamaの状態を確認**
   - アプリケーションを再起動して、Ollamaの状態を確認

2. **手動でOllamaを起動**
   ```bash
   # Windows
   ollama serve
   
   # macOS/Linux
   ollama serve
   ```

3. **ポートの確認**
   - ポート11434が他のアプリケーションで使用されていないか確認
   - タスクマネージャー（Windows）または`lsof`コマンド（Unix系）で確認

4. **再ダウンロード**
   - Ollamaの自動ダウンロードを再試行

---

### 問題2: Ollamaのダウンロードが遅い・失敗する

#### 症状
- ダウンロード進捗が進まない
- ダウンロードが途中で失敗

#### 原因
- インターネット接続の問題
- GitHub Releases APIへのアクセス制限
- ディスク容量不足

#### 解決方法

1. **インターネット接続を確認**
   - インターネット接続が安定しているか確認
   - プロキシ設定を確認

2. **再試行**
   - ダウンロードを再試行
   - 数回試しても失敗する場合、手動でOllamaをインストール

3. **ディスク容量を確認**
   - 十分な空き容量があるか確認（最低10GB）

---

## API関連の問題

### 問題3: APIが起動しない

#### 症状
- 「起動」ボタンをクリックしても起動しない
- ステータスが「停止中」のまま

#### 原因
- Ollamaが起動していない
- ポート番号が使用されている
- 認証プロキシの起動に失敗

#### 解決方法

1. **Ollamaの状態を確認**
   - Ollamaが起動しているか確認（問題1を参照）

2. **ポート番号を確認**
   - 設定したポート番号が使用されていないか確認
   - 別のポート番号を試す

3. **ログを確認**
   - アプリケーションのログを確認
   - エラーメッセージの内容を確認

---

### 問題4: APIがすぐに停止する

#### 症状
- APIを起動してもすぐに停止する
- ステータスが「error」になる

#### 原因
- 認証プロキシの起動エラー
- モデルが見つからない
- ポート競合

#### 解決方法

1. **モデルの確認**
   - 指定したモデルがダウンロードされているか確認
   - モデル管理画面でインストール済みモデルを確認

2. **ポートの確認**
   - ポート番号が使用されていないか確認
   - 別のポート番号を試す

3. **APIを再作成**
   - 一度APIを削除して、再度作成

---

### 問題5: ポート番号エラー

#### 症状
- 「ポート番号が既に使用されています」というエラー
- API作成時に失敗

#### 原因
- 指定したポート番号が他のアプリケーションで使用されている
- 以前に作成したAPIがまだ実行中

#### 解決方法

1. **使用中のポートを確認**
   ```bash
   # Windows
   netstat -ano | findstr :8080
   
   # macOS/Linux
   lsof -i :8080
   ```

2. **別のポート番号を使用**
   - 8081、8082などの別のポート番号を選択

3. **実行中のAPIを停止**
   - API一覧で実行中のAPIを停止

---

## モデル関連の問題

### 問題6: モデルのダウンロードが失敗する

#### 症状
- ダウンロードが途中で停止
- エラーメッセージが表示される

#### 原因
- インターネット接続の問題
- ディスク容量不足
- Ollama APIのエラー

#### 解決方法

1. **インターネット接続を確認**
   - 接続が安定しているか確認

2. **ディスク容量を確認**
   - 十分な空き容量があるか確認
   - 不要なファイルを削除

3. **再試行**
   - ダウンロードを再試行
   - 数回試しても失敗する場合、別のモデルを試す

---

### 問題7: モデル一覧が表示されない

#### 症状
- モデル一覧が空
- 「モデルが見つかりません」というメッセージ

#### 原因
- Ollamaが起動していない
- Ollama APIへの接続エラー
- モデルがインストールされていない

#### 解決方法

1. **Ollamaの状態を確認**
   - Ollamaが起動しているか確認

2. **手動でモデルをインストール**
   ```bash
   ollama pull llama3:8b
   ```

3. **アプリケーションを再起動**

---

## データベース関連の問題

### 問題8: データベース接続エラー

#### 症状
- 「データベース接続エラー」が表示される
- API一覧が表示されない

#### 原因
- データベースファイルへのアクセス権限がない
- データベースファイルが破損
- ディスク容量不足

#### 解決方法

1. **アプリケーションを再起動**
   - 一時的な問題の可能性

2. **アクセス権限を確認**
   - アプリケーションデータディレクトリのアクセス権限を確認

3. **データベースファイルを確認**
   - データベースファイルが存在するか確認
   - ファイルが破損していないか確認

4. **再インストール**
   - 問題が解決しない場合、アプリケーションを再インストール
   - 注意: 既存のデータは削除されます

---

### 問題9: API設定が保存されない

#### 症状
- APIを作成しても一覧に表示されない
- 設定変更が反映されない

#### 原因
- データベースへの書き込み権限がない
- データベースがロックされている

#### 解決方法

1. **アプリケーションを再起動**
   - データベースのロックを解除

2. **アクセス権限を確認**
   - アプリケーションデータディレクトリの書き込み権限を確認

---

## 認証関連の問題

### 問題10: APIキーが表示されない

#### 症状
- API作成後、APIキーが表示されない
- API詳細画面でAPIキーが表示されない

#### 原因
- 認証設定が無効
- APIキーの復号化エラー

#### 解決方法

1. **認証設定を確認**
   - API作成時に認証設定が有効になっていたか確認

2. **APIキーを再生成**
   - 設定変更画面でAPIキーを再生成

3. **APIを再作成**
   - 認証設定を有効にしてAPIを再作成

---

### 問題11: APIキーで認証が失敗する

#### 症状
- APIキーを使用しても認証が失敗
- 401エラーが返される

#### 原因
- APIキーが間違っている
- APIキーが無効になっている（再生成済み）
- 認証プロキシの設定エラー

#### 解決方法

1. **APIキーを確認**
   - 正しいAPIキーを使用しているか確認
   - コピー＆ペースト時に余分なスペースが含まれていないか確認

2. **APIキーを再生成**
   - 設定変更画面でAPIキーを再生成
   - 新しいAPIキーを使用

3. **認証プロキシを再起動**
   - APIを停止してから再起動

---

## パフォーマンスの問題

### 問題12: APIの応答が遅い

#### 症状
- APIのレスポンスに時間がかかる
- タイムアウトエラーが発生

#### 原因
- モデルが大きすぎる
- CPU/メモリのリソース不足
- 同時リクエストが多い

#### 解決方法

1. **軽量モデルを使用**
   - より小さなモデルを試す

2. **リソースを確認**
   - CPU/メモリの使用率を確認
   - 他のアプリケーションを終了

3. **リクエストの頻度を減らす**
   - 同時リクエストの数を減らす

---

### 問題13: メモリ使用量が高い

#### 症状
- システムのメモリ使用量が高い
- アプリケーションが重い

#### 原因
- モデルサイズが大きい
- 複数のAPIが同時に実行されている

#### 解決方法

1. **軽量モデルを使用**
   - より小さなモデルを選択

2. **実行中のAPIを減らす**
   - 不要なAPIを停止

3. **システムリソースを確認**
   - 他のアプリケーションのメモリ使用量を確認

---

## その他の問題

### 問題14: アプリケーションが起動しない

#### 症状
- アプリケーションが起動しない
- エラーダイアログが表示される

#### 解決方法

1. **システム要件を確認**
   - 必要なシステム要件を満たしているか確認

2. **再インストール**
   - アプリケーションを再インストール

3. **ログを確認**
   - エラーログを確認
   - ログファイルの場所: アプリケーションデータディレクトリ

---

### 問題15: アップデート後にエラーが発生

#### 症状
- アップデート後に機能が動作しない
- データが表示されない

#### 解決方法

1. **アプリケーションを再起動**
   - アップデート後に一度再起動

2. **データベースマイグレーション**
   - データベースのマイグレーションが自動実行されます
   - エラーが発生する場合、アプリケーションを再インストール

---

## サポート

問題が解決しない場合は、以下を参照してください：

- [FAQ](./FAQ.md): よくある質問と回答
- [ユーザーガイド](./USER_GUIDE.md): 使用方法の詳細
- [GitHub Issues](https://github.com/your-repo/issues): バグ報告・機能要望

---

## ログの収集

問題を報告する際は、以下の情報を収集してください：

1. **エラーメッセージ**: 表示されたエラーメッセージの全文
2. **操作手順**: 問題が発生した操作手順
3. **環境情報**:
   - OSのバージョン
   - FLMのバージョン
   - Ollamaのバージョン
4. **ログファイル**: アプリケーションデータディレクトリのログファイル

---

**このガイドで問題が解決しない場合は、GitHub Issuesで報告してください。**

