# 回帰テスト計画書（Regression Test Plan）

## 文書情報

- **プロジェクト名**: FLM
- **テストタイプ**: 回帰テスト（Regression Test）
- **作成日**: 2024年
- **バージョン**: 1.0.0

---

## 1. 概要

### 1.1 目的

回帰テストは、修正や新機能追加による既存機能への影響を検証するテストです。既存の機能が正常に動作し続けることを確認し、バグの再発を防ぐことを目的とします。

### 1.2 対象範囲

- 既存機能の動作確認
- 修正による影響範囲の確認
- バグ修正の検証
- 新機能追加による既存機能への影響確認

### 1.3 テストフレームワーク

- **フレームワーク**: Jest + ts-jest
- **自動化ツール**: MagicPod、TestComplete（オプション）

---

## 2. テスト対象とテスト項目

### 2.1 既存機能の回帰テスト

#### 2.1.1 API作成機能（F001）

**テスト項目**:
- API作成の基本動作
- モデル選択機能
- 設定入力機能
- APIキー生成機能
- データベース保存機能

**既存テストファイル**: `tests/integration/f001-api-creation.test.ts`

#### 2.1.2 API利用機能（F002）

**テスト項目**:
- API一覧表示
- API詳細表示
- チャットインターフェース
- サンプルコード生成

#### 2.1.3 API管理機能（F003）

**テスト項目**:
- API起動/停止
- API設定変更
- API削除
- 複数APIの同時管理

**既存テストファイル**: `tests/integration/f003-api-management.test.ts`

#### 2.1.4 モデル管理機能（F004）

**テスト項目**:
- モデル検索
- モデルダウンロード
- モデル削除
- インストール済みモデル一覧

**既存テストファイル**: `tests/integration/f004-model-management.test.ts`

#### 2.1.5 認証機能（F005）

**テスト項目**:
- APIキー生成
- APIキー検証
- APIキー再生成
- 認証プロキシの動作

**既存テストファイル**: 
- `tests/integration/auth-proxy.test.ts`
- `tests/unit/auth-f005.test.ts`

#### 2.1.6 ログ表示機能（F006）

**テスト項目**:
- ログ一覧表示
- ログフィルタリング
- ログエクスポート
- ログ削除

**既存テストファイル**: `tests/integration/f006-log-display.test.ts`

#### 2.1.7 パフォーマンス監視機能（F007）

**テスト項目**:
- パフォーマンスデータの収集
- 統計情報の表示
- グラフ表示
- アラート機能

**既存テストファイル**: `tests/integration/f007-performance-monitoring.test.ts`

#### 2.1.8 Ollama自動インストール機能（F009）

**テスト項目**:
- Ollama検出
- Ollama自動起動
- ポータブル版ダウンロード

**既存テストファイル**: 
- `tests/integration/ollama-auto-start.test.ts`
- `tests/integration/ollama-install.test.ts`

### 2.2 バグ修正の検証

**テスト項目**:
- 修正されたバグが再発していないこと
- 修正による副作用がないこと
- 関連機能への影響がないこと

### 2.3 新機能追加による影響確認

**テスト項目**:
- 既存機能の動作に影響がないこと
- 既存のAPIとの互換性が保たれていること
- データベーススキーマの変更による影響がないこと

---

## 3. テスト実装方針

### 3.1 テストスイートの構成

回帰テストは、既存の単体テスト、結合テスト、E2Eテストを組み合わせて実行します。

```typescript
// 回帰テストの実行例
describe('回帰テストスイート', () => {
  describe('F001: API作成機能の回帰テスト', () => {
    // 既存のテストケースを実行
    require('./f001-api-creation.test.ts');
  });
  
  describe('F003: API管理機能の回帰テスト', () => {
    // 既存のテストケースを実行
    require('./f003-api-management.test.ts');
  });
  
  // ... 他の機能のテスト
});
```

### 3.2 テスト実行タイミング

- **プルリクエスト作成時**: 変更された機能の回帰テスト
- **マージ前**: 全機能の回帰テスト
- **リリース前**: 全機能の包括的な回帰テスト

### 3.3 テストデータの管理

- テスト用のデータベーススナップショット
- テスト用のAPIデータ
- テスト用のモデルデータ

---

## 4. 回帰テストチェックリスト

### 4.1 基本機能チェックリスト

- [ ] API作成機能が正常に動作する
- [ ] API利用機能が正常に動作する
- [ ] API管理機能が正常に動作する
- [ ] モデル管理機能が正常に動作する
- [ ] 認証機能が正常に動作する
- [ ] ログ表示機能が正常に動作する
- [ ] パフォーマンス監視機能が正常に動作する
- [ ] Ollama自動インストール機能が正常に動作する

### 4.2 UI操作チェックリスト

- [ ] 画面遷移が正常に動作する
- [ ] フォーム入力が正常に動作する
- [ ] ボタン操作が正常に動作する
- [ ] モーダル・ダイアログが正常に動作する
- [ ] エラーメッセージが適切に表示される

### 4.3 データ整合性チェックリスト

- [ ] データベースへの保存が正常に動作する
- [ ] データベースからの取得が正常に動作する
- [ ] データの更新が正常に動作する
- [ ] データの削除が正常に動作する

---

## 5. テスト実行方法

### 5.1 全機能の回帰テストを実行

```bash
# すべてのテストを実行（回帰テスト）
npm test
```

### 5.2 特定機能の回帰テストを実行

```bash
# API作成機能の回帰テスト
npm test -- tests/integration/f001-api-creation.test.ts

# API管理機能の回帰テスト
npm test -- tests/integration/f003-api-management.test.ts
```

### 5.3 カバレッジを含む回帰テスト

```bash
# カバレッジレポートを生成
npm run test:coverage
```

### 5.4 ウォッチモードで実行

```bash
# 変更を監視して自動実行
npm run test:watch
```

---

## 6. バグ修正時の回帰テスト

### 6.1 バグ修正の検証手順

1. **バグの再現確認**
   - 修正前の状態でバグを再現
   - バグの原因を特定

2. **修正の実施**
   - バグを修正
   - 修正内容の確認

3. **修正の検証**
   - バグが修正されていることを確認
   - 関連機能への影響を確認

4. **回帰テストの実行**
   - 修正された機能の回帰テスト
   - 関連機能の回帰テスト

### 6.2 バグ修正記録

- バグID
- バグの説明
- 修正内容
- 回帰テスト結果
- 修正日時

---

## 7. 新機能追加時の回帰テスト

### 7.1 新機能追加の検証手順

1. **新機能の実装**
   - 新機能の開発
   - 新機能の単体テスト

2. **既存機能への影響確認**
   - 既存機能の回帰テスト
   - データベーススキーマの変更確認

3. **統合テスト**
   - 新機能と既存機能の統合テスト

4. **包括的な回帰テスト**
   - 全機能の回帰テスト

---

## 8. テスト実装優先順位

### 優先度: 高

1. **基本機能の回帰テスト**
   - API作成・管理・利用機能
   - 認証機能

2. **データ整合性の回帰テスト**
   - データベース操作
   - データ永続化

### 優先度: 中

3. **UI操作の回帰テスト**
   - 画面遷移
   - フォーム操作

4. **パフォーマンスの回帰テスト**
   - 応答時間
   - メモリ使用量

### 優先度: 低

5. **エッジケースの回帰テスト**
   - 異常系の処理
   - 境界値の処理

---

## 9. CI/CDへの統合

### 9.1 自動実行

- プルリクエスト作成時に自動実行
- マージ前に必須チェック

### 9.2 テスト結果の通知

- テスト失敗時の通知
- カバレッジレポートの共有

---

## 10. トラブルシューティング

### 10.1 よくある問題

**問題**: 回帰テストが頻繁に失敗する
- **解決策**: テストの安定性を向上させる、テストデータの管理を改善

**問題**: テスト実行時間が長い
- **解決策**: テストの並列実行、不要なテストの削除

---

## 11. 参考資料

- 既存のテストファイル（`tests/`）
- [Jest公式ドキュメント](https://jestjs.io/docs/getting-started)
- [MagicPod公式ドキュメント](https://magicpod.com/)
- [TestComplete公式ドキュメント](https://support.smartbear.com/testcomplete/)
