# コードレビューガイドライン

## 目的

このドキュメントは、FLMプロジェクトのコードレビュープロセスを明確化し、レビュー品質の向上と開発効率の改善を目的としています。

## コードレビューの原則

### 1. 建設的なフィードバック

- コードを批判するのではなく、改善を提案する
- 具体的で実行可能なフィードバックを提供する
- 良い点も指摘し、バランスの取れたレビューを行う

### 2. 学習の機会

- コードレビューは学習の機会として活用する
- 質問や疑問点を積極的に共有する
- 知識やベストプラクティスを共有する

### 3. 効率的なレビュー

- レビューは迅速に行う（24時間以内を目標）
- 優先度の高い問題から対応する
- 細かいスタイルの問題は自動化ツールに任せる

## レビューのチェックリスト

### 機能性

- [ ] コードは要件を満たしているか
- [ ] エッジケースが適切に処理されているか
- [ ] エラーハンドリングが適切か
- [ ] テストが追加されているか（新機能の場合）

### コード品質

- [ ] コードは読みやすく、理解しやすいか
- [ ] 適切な命名規則が使用されているか
- [ ] コードの重複がないか（DRY原則）
- [ ] 適切な抽象化レベルが使用されているか
- [ ] コメントが適切に追加されているか（必要に応じて）

### セキュリティ

- [ ] 入力値の検証が適切に行われているか
- [ ] SQLインジェクションやXSSの脆弱性がないか
- [ ] 機密情報がハードコードされていないか
- [ ] 適切な認証・認可が実装されているか

### パフォーマンス

- [ ] 不要な計算やクエリがないか
- [ ] メモリリークの可能性がないか
- [ ] 適切なインデックスが使用されているか（データベースクエリの場合）

### テスト

- [ ] テストが追加されているか（新機能の場合）
- [ ] 既存のテストが壊れていないか
- [ ] テストカバレッジが適切か

### ドキュメント

- [ ] 新しい機能についてドキュメントが更新されているか
- [ ] 複雑なロジックにコメントが追加されているか
- [ ] APIの変更がドキュメントに反映されているか

## レビューの優先度

### 🔴 高優先度（必須修正）

- セキュリティ脆弱性
- データ損失の可能性
- クラッシュの原因となる問題
- パフォーマンスの重大な問題

### 🟡 中優先度（できるだけ早く修正）

- コードの可読性の問題
- エラーハンドリングの改善
- テストの追加
- ドキュメントの更新

### 🟢 低優先度（時間があるときに修正）

- スタイルの統一
- コメントの改善
- リファクタリングの提案

## レビューの流れ

### 1. Pull Requestの作成

- 明確なタイトルと説明を記入
- 関連するIssue番号を記載
- 変更内容の概要を説明
- スクリーンショットを添付（UI変更の場合）

### 2. 自動チェックの確認

- CI/CDパイプラインが成功しているか
- テストがすべて通過しているか
- リンターエラーがないか
- カバレッジが閾値を満たしているか

### 3. コードレビュー

- レビュアーは上記のチェックリストを使用
- コメントを追加（必須修正、提案、質問など）
- 承認または変更要求を選択

### 4. 修正と再レビュー

- 作成者はフィードバックに対応
- 必要に応じて追加の説明を提供
- 再レビューを依頼

### 5. マージ

- すべてのレビューが承認されたらマージ
- マージ前に最終確認（CI/CDの成功、テストの通過）

## レビューコメントの書き方

### 良いコメントの例

```
✅ 良い点:
- エラーハンドリングが適切に実装されています
- テストが包括的で、エッジケースもカバーされています

🔧 改善提案:
- この関数は長すぎるので、2つの関数に分割することを検討してください
- この部分は型安全性を向上させるために、型アサーションの代わりに型ガードを使用することをお勧めします

❓ 質問:
- この条件分岐の意図を教えてください。コメントを追加していただけますか？
```

### 避けるべきコメント

- 「このコードは良くない」
- 「もっと良い方法がある」
- 「なぜこのように実装したのか理解できない」

## 承認基準

以下の条件をすべて満たす場合、Pull Requestを承認できます：

1. ✅ 機能が要件を満たしている
2. ✅ セキュリティ上の問題がない
3. ✅ テストが追加され、すべて通過している
4. ✅ コードが読みやすく、保守しやすい
5. ✅ ドキュメントが更新されている（必要に応じて）
6. ✅ CI/CDパイプラインが成功している

## 特別な考慮事項

### セキュリティ関連の変更

- セキュリティ関連の変更は特に慎重にレビューする
- セキュリティ監査レポートの推奨事項を確認する
- 必要に応じて、セキュリティ専門家のレビューを依頼する

### パフォーマンス関連の変更

- パフォーマンス改善の場合は、ベンチマーク結果を確認する
- メモリ使用量の増加がないか確認する
- データベースクエリの最適化が適切か確認する

### 大規模なリファクタリング

- 大規模なリファクタリングは段階的に実施する
- 各段階でテストが通過することを確認する
- 機能の変更がないことを確認する

## レビューツール

### 使用しているツール

- **GitHub Pull Requests**: コードレビューのプラットフォーム
- **GitHub Actions**: CI/CDパイプライン
- **ESLint**: JavaScript/TypeScriptのリンター
- **Clippy**: Rustのリンター
- **Jest**: テストフレームワーク

### ベストプラクティス

- 小さなPull Requestを作成する（200行以下を推奨）
- 1つのPull Requestで1つの機能や修正に集中する
- 関連する変更をグループ化する

## 参考資料

- [Google Code Review Guide](https://google.github.io/eng-practices/review/)
- [Effective Code Review](https://www.atlassian.com/agile/software-development/code-reviews)
- [OWASP Code Review Guide](https://owasp.org/www-project-code-review-guide/)

---

**最終更新日**: 2025-01-01  
**次回レビュー予定**: 2025-04-01

