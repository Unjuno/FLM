# FLM - 開発手順

## 文書情報

- **プロジェクト名**: FLM
- **最終更新日**: 2024年
- **ステータス**: ドラフト

---

## 目次

1. [開発環境セットアップ](#開発環境セットアップ)
2. [プロジェクト初期化](#プロジェクト初期化)
3. [開発フロー](#開発フロー)
4. [技術検証手順](#技術検証手順)
5. [MVP開発手順](#mvp開発手順)
6. [テスト手順](#テスト手順)
7. [ビルド・パッケージング手順](#ビルドパッケージング手順)
8. [リリース準備手順](#リリース準備手順)

---

## 開発環境セットアップ

### 1.1 必須ツールのインストール

#### Windows

```powershell
# Git インストール
# https://git-scm.com/download/win からダウンロード

# Node.js インストール (v18以上推奨)
# https://nodejs.org/ からダウンロード
node --version
npm --version

# Rust インストール（Tauri使用時）
# https://www.rust-lang.org/tools/install
rustup --version

# Ollama インストール（必須）
# https://ollama.ai/ からダウンロード
ollama --version

# VS Code インストール（推奨エディタ）
# https://code.visualstudio.com/
```

#### macOS

```bash
# Homebrew インストール（推奨）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Git インストール
brew install git

# Node.js インストール
brew install node

# Rust インストール（Tauri使用時）
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Ollama インストール
brew install ollama

# VS Code インストール
brew install --cask visual-studio-code
```

#### Linux (Ubuntu/Debian)

```bash
# Git インストール
sudo apt update
sudo apt install git

# Node.js インストール
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Rust インストール（Tauri使用時）
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Ollama インストール
curl -fsSL https://ollama.ai/install.sh | sh

# 依存関係（Tauri用）
sudo apt install libwebkit2gtk-4.0-dev \
    build-essential \
    curl \
    wget \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev
```

### 1.2 開発ツールのインストール

```bash
# グローバルパッケージ（プロジェクト全体で使用）
npm install -g typescript
npm install -g vite
npm install -g @tauri-apps/cli  # Tauri使用時

# プロジェクト作成後
cd localai-hub
npm install
```

---

## プロジェクト初期化

### 2.1 プロジェクト作成

```bash
# Tauriプロジェクト作成
npm create tauri-app@latest localai-hub

# プロジェクト構成の選択
# - フレームワーク: React / Vue / Svelte から選択
# - 言語: TypeScript
# - テンプレート: vanilla-ts / react-ts / vue-ts 等

cd localai-hub
npm install
```

### 2.2 ディレクトリ構造

```
localai-hub/
├── src/                    # フロントエンド（React/Vue）
│   ├── components/        # UIコンポーネント
│   ├── pages/             # ページ
│   ├── utils/             # ユーティリティ
│   └── main.tsx           # エントリーポイント
├── src-tauri/             # Tauriバックエンド（Rust）
│   ├── src/
│   │   ├── main.rs        # Rustエントリーポイント
│   │   └── commands.rs    # Tauriコマンド
│   └── Cargo.toml         # Rust依存関係
├── public/                # 静的ファイル
├── package.json           # Node.js依存関係
├── tsconfig.json          # TypeScript設定
└── tauri.conf.json        # Tauri設定
```

### 2.3 依存関係の追加

```bash
# フロントエンド依存関係
npm install axios          # HTTPクライアント
npm install react-router-dom  # ルーティング（React使用時）

# バックエンド依存関係（認証プロキシ用）
# 別ディレクトリに Node.js プロジェクト作成
mkdir auth-proxy
cd auth-proxy
npm init -y
npm install express
npm install express-http-proxy
npm install jsonwebtoken
npm install sqlite3
npm install crypto  # Node.js標準（追加不要）
```

---

## 開発フロー

### 3.1 Gitワークフロー

```bash
# リポジトリ初期化
git init
git remote add origin <repository-url>

# ブランチ戦略
main          # 本番環境
develop       # 開発ブランチ
feature/*     # 機能開発ブランチ
hotfix/*      # 緊急修正ブランチ
release/*     # リリース準備ブランチ

# 新機能開発
git checkout -b feature/F001-api-creation
# 開発作業
git add .
git commit -m "feat: API作成機能の実装"
git push origin feature/F001-api-creation
# プルリクエスト作成
```

### 3.2 コーディング規約

**TypeScript**:
- ESLint + Prettier使用
- 関数・変数名: camelCase
- コンポーネント名: PascalCase
- 定数: UPPER_SNAKE_CASE

**Rust**:
- rustfmt使用（自動フォーマット）
- 関数・変数名: snake_case
- 構造体名: PascalCase

**コミットメッセージ**:
```
feat: 新機能追加
fix: バグ修正
docs: ドキュメント更新
style: コードスタイル変更
refactor: リファクタリング
test: テスト追加・修正
chore: ビルド・ツール設定変更
```

---

## 技術検証手順

### 4.1 Tauri vs Electron検証（1週間）

#### Tauriプロトタイプ作成

```bash
# Tauriプロジェクト作成
npm create tauri-app@latest tauri-prototype
cd tauri-prototype

# 基本的なUI作成
# src/App.tsx に簡単なボタンとメッセージ表示を実装

# Ollama API統合テスト
# src/utils/ollama.ts を作成
# GET /api/tags の呼び出しテスト

# ビルドテスト
npm run tauri build
```

**検証項目**:
- [ ] ビルド時間
- [ ] アプリサイズ
- [ ] 起動速度
- [ ] メモリ使用量
- [ ] Ollama API統合の容易さ
- [ ] クロスプラットフォームビルド

#### Electronプロトタイプ作成（比較用）

```bash
# Electronプロジェクト作成
npm create electron-app@latest electron-prototype
cd electron-prototype

# 同様の機能を実装して比較
```

**検証結果記録**:
- `Procedure/技術検証レポート.md` に記録
- 最終選定理由を明確化

### 4.2 Ollama統合検証

```bash
# Ollama起動確認
ollama serve

# モデルインストールテスト
ollama pull llama2:7b

# APIテスト
curl http://localhost:11434/api/tags
curl http://localhost:11434/api/chat -d '{
  "model": "llama2:7b",
  "messages": [{"role": "user", "content": "Hello"}]
}'
```

---

## MVP開発手順

### 5.1 開発フェーズ

#### Phase 1: 基本UI構築（Week 1-2）

```bash
# ホーム画面作成
src/pages/Home.tsx

# ナビゲーション作成
src/components/Navigation.tsx

# API一覧コンポーネント
src/components/ApiList.tsx
```

#### Phase 2: モデル管理機能（F004）（Week 3-4）

```bash
# Ollama API統合
src/utils/ollamaApi.ts

# モデル一覧表示
src/pages/Models.tsx

# モデルダウンロード機能
src/components/ModelDownload.tsx
```

#### Phase 3: API作成機能（F001）（Week 5-6）

```bash
# API作成ウィザード
src/pages/CreateApi.tsx

# 認証プロキシ起動機能（Rust）
src-tauri/src/commands.rs

# SQLite統合
src-tauri/src/database.rs
```

#### Phase 4: 認証機能（F005）（Week 7-8）

```bash
# 認証プロキシ実装
auth-proxy/server.js

# APIキー生成
src-tauri/src/auth.rs

# SQLite暗号化保存
```

#### Phase 5: API利用機能（F002）（Week 9-10）

```bash
# APIテストインターフェース
src/pages/ApiTest.tsx

# チャットUI
src/components/ChatInterface.tsx
```

#### Phase 6: API管理機能（F003）（Week 11-12）

```bash
# API起動/停止機能
src-tauri/src/process_manager.rs

# 設定変更機能
src/pages/ApiSettings.tsx
```

#### Phase 7: 統合テスト・バグ修正（Week 13-16）

```bash
# エンドツーエンドテスト
npm run test:e2e

# バグ修正
# ドキュメント作成
```

---

## テスト手順

### 6.1 単体テスト

```bash
# テスト実行
npm run test

# カバレッジ確認
npm run test:coverage

# 目標: 80%以上
```

### 6.2 統合テスト

```bash
# Ollama API統合テスト
npm run test:integration

# 認証プロキシテスト
cd auth-proxy
npm run test
```

### 6.3 E2Eテスト

```bash
# Playwright使用
npm run test:e2e

# 主要ユーザーフロー:
# 1. API作成 → テスト → 削除
# 2. モデルダウンロード → API作成
# 3. 認証有効化 → APIテスト
```

### 6.4 ユーザーテスト

**ベータテスター募集**:
- 非開発者10-20名
- 各OS環境（Windows優先）

**テスト項目**:
- [ ] 5分以内でAPI作成できるか
- [ ] エラーメッセージがわかりやすいか
- [ ] UIが直感的か
- [ ] 専門用語が適切に置き換えられているか

---

## ビルド・パッケージング手順

### 7.1 開発ビルド

```bash
# 開発モード起動
npm run tauri dev

# 開発ビルド
npm run tauri build -- --debug
```

### 7.2 本番ビルド

```bash
# Windows
npm run tauri build -- --target x86_64-pc-windows-msvc

# macOS
npm run tauri build -- --target x86_64-apple-darwin
npm run tauri build -- --target aarch64-apple-darwin  # Apple Silicon

# Linux
npm run tauri build -- --target x86_64-unknown-linux-gnu
```

### 7.3 インストーラー生成

```bash
# Tauriが自動生成（設定済み）
# tauri.conf.json で設定

# Windows: .msi インストーラー
# macOS: .dmg ファイル
# Linux: .deb / .AppImage / .rpm
```

### 7.4 コード署名（本番環境）

**Windows**:
- Authenticode証明書取得
- Tauri設定に証明書パスを追加

**macOS**:
- Apple Developerアカウント取得
- Notarization実行

**Linux**:
- GPG署名（オプション）

---

## リリース準備手順

### 8.1 バージョン管理

```bash
# バージョン更新
npm version patch  # 1.0.0 → 1.0.1
npm version minor  # 1.0.0 → 1.1.0
npm version major  # 1.0.0 → 2.0.0

# CHANGELOG.md 更新
```

### 8.2 リリースノート作成

```markdown
# v1.0.0 リリースノート

## 新機能
- API作成機能（F001）
- API利用機能（F002）
- API管理機能（F003）
- モデル管理機能（F004）
- 認証機能（F005）

## 改善
- UI/UX改善
- エラーハンドリング強化

## 既知の問題
- （記載）
```

### 8.3 リリース前チェックリスト

- [ ] 全テスト通過
- [ ] ドキュメント更新
- [ ] バージョン番号更新
- [ ] CHANGELOG.md更新
- [ ] リリースノート作成
- [ ] ビルド成功確認
- [ ] インストーラー動作確認
- [ ] 各OSでの動作確認

### 8.4 リリース実行

```bash
# タグ作成
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0

# GitHub Releases作成
# - タグから自動生成または手動作成
# - リリースノート添付
# - 各OS向けインストーラーアップロード
```

---

## 参考資料

- コンセプトドキュメント: `DOCKS/CONCEPT.md`
- 機能仕様書: `DOCKS/SPECIFICATION.md`
- Tauri公式ドキュメント: https://tauri.app/
- Ollama公式ドキュメント: https://github.com/ollama/ollama

---

**文書終了**

