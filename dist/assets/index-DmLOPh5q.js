import{r as ke,a as Ee,g as we,b as a,u as xe,c as Pe,R as W,d as Te,N as _e,B as Ae}from"./react-vendor-B_iA_kAh.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const d of m.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function n(l){if(l.ep)return;l.ep=!0;const m=r(l);fetch(l.href,m)}})();var re={exports:{}},G={};var oe;function Me(){if(oe)return G;oe=1;var t=ke(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,l=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m={key:!0,ref:!0,__self:!0,__source:!0};function d(g,f,y){var j,b={},P=null,S=null;y!==void 0&&(P=""+y),f.key!==void 0&&(P=""+f.key),f.ref!==void 0&&(S=f.ref);for(j in f)n.call(f,j)&&!m.hasOwnProperty(j)&&(b[j]=f[j]);if(g&&g.defaultProps)for(j in f=g.defaultProps,f)b[j]===void 0&&(b[j]=f[j]);return{$$typeof:s,type:g,key:P,ref:S,props:b,_owner:l.current}}return G.Fragment=r,G.jsx=d,G.jsxs=d,G}var ce;function Le(){return ce||(ce=1,re.exports=Me()),re.exports}var e=Le(),X={},de;function Ie(){if(de)return X;de=1;var t=Ee();return X.createRoot=t.createRoot,X.hydrateRoot=t.hydrateRoot,X}var Re=Ie();const De=we(Re);async function Fe(t,s={},r){return window.__TAURI_INTERNALS__.invoke(t,s,r)}function Oe(){return typeof window<"u"&&"__TAURI__"in window}async function L(t,s){if(!Oe())throw new Error("Tauri is not available. Please ensure you are running this application in a Tauri environment.");try{return await Fe(t,s)}catch(r){if(r&&typeof r=="object"&&"code"in r){const n=r,l=new Error(`CLI Error [${n.code}]: ${n.message}`);throw Object.defineProperty(l,"cliError",{value:{code:n.code,message:n.message,stderr:n.stderr,originalError:r},enumerable:!0,writable:!1}),l}if(r instanceof Error){const n=r.message.toLowerCase();if(n.includes("network")||n.includes("connection")||n.includes("fetch"))throw new Error(`Network error: ${r.message}. Please check your connection and try again.`)}throw r}}function Ue(t){if(t&&typeof t=="object"&&"cliError"in t){const s=t.cliError;if(s&&typeof s=="object"&&"code"in s&&"message"in s)return s}return null}const $e={loading:"読み込み中...",error:"エラー",success:"成功",cancel:"キャンセル",confirm:"確認",close:"閉じる",save:"保存",delete:"削除",edit:"編集",add:"追加",remove:"削除",search:"検索",filter:"フィルター",export:"エクスポート",import:"インポート",refresh:"更新",retry:"再試行",back:"戻る",next:"次へ",previous:"前へ",others:"他 {{count}}個...",actions:"操作"},Be={title:"FLM - Local LLM API Manager",subtitle:"ローカルLLM API管理ツール",proxyStatus:"プロキシ状態",engineStatus:"エンジン状態",running:"実行中",stopped:"停止中",startProxy:"プロキシを起動",stopProxy:"プロキシを停止",detectEngines:"エンジンを検出",enginesFound:"{{count}}個のエンジンが見つかりました",noEngines:"エンジンが見つかりませんでした",quickActions:"クイックアクション",chatTester:"Chat Tester",securityEvents:"セキュリティイベント",ipBlocklist:"IPブロックリスト",appOverview:"アプリケーション概要",appDescription:"FLMは、ローカルLLM（Large Language Model）のAPIを簡単に作成・管理できるデスクトップアプリケーションです。",port:"ポート",mode:"モード",feature1:"複数のLLMエンジン（Ollama、vLLM、LM Studio、llama.cpp）に対応",feature2:"OpenAI互換のAPIエンドポイントを提供",feature3:"セキュリティ機能（APIキー認証、IPブロックリスト、侵入検知）",feature4:"直感的なUIで初心者でも簡単に操作可能"},qe={title:"Chat Tester",subtitle:"モデルをテストする",model:"モデル",message:"メッセージ",temperature:"温度",maxTokens:"最大トークン数",send:"送信",response:"レスポンス",loading:"読み込み中...",error:"エラーが発生しました",proxyNotRunning:"プロキシが実行されていません。Dashboardでプロキシを起動してください。",proxyEndpointError:"プロキシエンドポイントの取得に失敗しました",proxyEndpointNotAvailable:"プロキシエンドポイントが取得できません",fetchingProxyEndpoint:"プロキシエンドポイントを取得中...",proxyEndpoint:"プロキシエンドポイント",modelListError:"モデルリストの取得に失敗しました",fetchingModelList:"モデルリストを取得中...",selectModel:"選択してください",modelNotAvailable:"モデルが利用できません",refresh:"更新",apiKey:"APIキー (オプション)",apiKeyPlaceholder:"Bearer token",streaming:"Streaming (SSE)",selectModelError:"モデルを選択してください",temperatureError:"Temperatureは0.0から2.0の範囲で指定してください",maxTokensError:"Max Tokensは1以上の整数を指定してください",messageRequired:"メッセージを入力してください",sendError:"チャットリクエストの送信に失敗しました",settings:"設定",addMessage:"メッセージを追加",removeMessage:"削除"},He={title:"セキュリティイベント",auditLogs:"監査ログ",intrusionDetection:"侵入検知",anomalyDetection:"異常検知",ipBlocklist:"IPブロックリスト",block:"ブロック",unblock:"ブロック解除",clearTemporary:"一時ブロックをクリア",exportCSV:"CSVエクスポート",exportJSON:"JSONエクスポート",filterApply:"フィルター適用",filterClear:"フィルタークリア",eventType:"イベントタイプ",severity:"重大度",ipAddress:"IPアドレス",minScore:"最小スコア",anomalyType:"異常タイプ",ipBlocklistManagement:"IPブロックリスト管理",fetchError:"IPブロックリストの取得に失敗しました",unblockConfirm:"IP {{ip}} のブロックを解除しますか？",unblockSuccess:"IP {{ip}} のブロックを解除しました",unblockError:"IPブロックの解除に失敗しました",clearTemporaryConfirm:"すべての一時ブロックを解除しますか？永続ブロックは残ります。",clearTemporarySuccess:"すべての一時ブロックを解除しました",clearTemporaryError:"一時ブロックの解除に失敗しました",clearAllTemporary:"一時ブロックをすべて解除",refresh:"更新",totalBlocks:"総ブロック数",permanentBlocks:"永続ブロック",temporaryBlocks:"一時ブロック",noBlockedIps:"ブロックされたIPアドレスはありません",blockedAt:"ブロック日時",reason:"理由",permanent:"永続",temporary:"一時",failureCount:"失敗回数",firstFailureAt:"初回失敗日時",blockedUntil:"ブロック期限",lastAttempt:"最終試行日時",type:"種類",cannotUnblockPermanent:"永続ブロックは解除できません"},Je={title:"設定",language:"言語",displayLanguage:"表示言語",languageHint:"アプリケーションの表示言語を選択します（現在: {{current}}）",japanese:"日本語",english:"English",autoDetect:"自動検出"},We={menu:"メニュー",home:"ホーム",chatTester:"Chat Tester",securityEvents:"セキュリティイベント",ipBlocklist:"IPブロックリスト",settings:"設定",modelProfiles:"モデルプロファイル",modelComparison:"モデル比較",collapse:"サイドバーを折りたたむ",expand:"サイドバーを展開"},ze={title:"モデルプロファイル",description:"エンジンごとに異なるモデルパラメータのプロファイルを管理します。",fetchError:"モデルプロファイルの取得に失敗しました",saveError:"モデルプロファイルの保存に失敗しました",deleteError:"モデルプロファイルの削除に失敗しました",createSuccess:"モデルプロファイルを作成しました",updateSuccess:"モデルプロファイルを更新しました",deleteSuccess:"モデルプロファイルを削除しました",deleteConfirm:"プロファイル「{{label}}」を削除しますか？この操作は元に戻せません。",requiredFields:"必須項目を入力してください",invalidJson:"パラメータJSONを解析できません。正しいJSON形式で入力してください。",filterByEngine:"エンジンでフィルター",filterByModel:"モデルでフィルター",enginePlaceholder:"例: ollama",modelPlaceholder:"例: llama3",createNew:"新規プロファイル作成",createProfile:"プロファイル作成",editProfile:"プロファイル編集",engineId:"エンジンID",modelId:"モデルID",label:"ラベル",labelPlaceholder:"プロファイル名",parameters:"パラメータ (JSON)",parametersHint:'JSON形式でパラメータを入力してください。例: {"temperature": 0.7, "max_tokens": 512}',profilesList:"プロファイル一覧",noProfiles:"プロファイルが見つかりません",updatedAt:"更新日時"},Ve={title:"モデル比較・ヘルス履歴",description:"エンジンのヘルス履歴を表示し、時間経過に伴うモデルのパフォーマンスを比較します。",fetchError:"ヘルス履歴の取得に失敗しました",timeRange:"期間",last24Hours:"過去24時間",last7Days:"過去7日間",last30Days:"過去30日間",filterByEngine:"エンジンでフィルター",filterByModel:"モデルでフィルター",enginePlaceholder:"例: ollama",modelPlaceholder:"例: llama3",totalChecks:"総チェック数",successRate:"成功率",avgLatency:"平均レイテンシ",avgErrorRate:"平均エラー率",statusBreakdown:"ステータス内訳",healthy:"正常",degraded:"劣化",unreachable:"到達不可",engineSummary:"エンジンサマリ",modelSummary:"モデルサマリ",recentLogs:"最近のログ",engine:"エンジン",model:"モデル",status:"ステータス",latency:"レイテンシ",errorRate:"エラー率",timestamp:"タイムスタンプ",nA:"N/A",noData:"ヘルス履歴データがありません",noModelData:"モデル固有のデータがありません"},Ke={generic:"エラーが発生しました",networkError:"ネットワークエラーが発生しました",cliError:"CLIエラーが発生しました",proxyNotRunning:"プロキシが実行されていません",details:"詳細",showDetails:"詳細を表示",hideDetails:"詳細を非表示"},Ge={proxyStarted:"プロキシが起動しました",proxyStopped:"プロキシが停止しました",enginesDetected:"エンジンの検出が完了しました",ipBlocked:"IPアドレスがブロックされました",ipUnblocked:"IPアドレスのブロックが解除されました",temporaryBlockedCleared:"一時ブロックがクリアされました",languageChanged:"言語を{{locale}}に変更しました"},le={common:$e,home:Be,chatTester:qe,security:He,settings:Je,sidebar:We,modelProfiles:ze,modelComparison:Ve,errors:Ke,messages:Ge},Ye={loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",confirm:"Confirm",close:"Close",save:"Save",delete:"Delete",edit:"Edit",add:"Add",remove:"Remove",search:"Search",filter:"Filter",export:"Export",import:"Import",refresh:"Refresh",retry:"Retry",back:"Back",next:"Next",previous:"Previous",others:"{{count}} more...",actions:"Actions"},Xe={title:"FLM - Local LLM API Manager",subtitle:"Local LLM API Management Tool",proxyStatus:"Proxy Status",engineStatus:"Engine Status",running:"Running",stopped:"Stopped",startProxy:"Start Proxy",stopProxy:"Stop Proxy",detectEngines:"Detect Engines",enginesFound:"{{count}} engines found",noEngines:"No engines found",quickActions:"Quick Actions",chatTester:"Chat Tester",securityEvents:"Security Events",ipBlocklist:"IP Blocklist",appOverview:"Application Overview",appDescription:"FLM is a desktop application that makes it easy to create and manage APIs for local LLMs (Large Language Models).",port:"Port",mode:"Mode",feature1:"Supports multiple LLM engines (Ollama, vLLM, LM Studio, llama.cpp)",feature2:"Provides OpenAI-compatible API endpoints",feature3:"Security features (API key authentication, IP blocklist, intrusion detection)",feature4:"Intuitive UI that is easy to use even for beginners"},Qe={title:"Chat Tester",subtitle:"Test Models",model:"Model",message:"Message",temperature:"Temperature",maxTokens:"Max Tokens",send:"Send",response:"Response",loading:"Loading...",error:"An error occurred",proxyNotRunning:"Proxy is not running. Please start the proxy from the Dashboard.",proxyEndpointError:"Failed to get proxy endpoint",proxyEndpointNotAvailable:"Proxy endpoint is not available",fetchingProxyEndpoint:"Fetching proxy endpoint...",proxyEndpoint:"Proxy Endpoint",modelListError:"Failed to fetch model list",fetchingModelList:"Fetching model list...",selectModel:"Please select",modelNotAvailable:"No models available",refresh:"Refresh",apiKey:"API Key (Optional)",apiKeyPlaceholder:"Bearer token",streaming:"Streaming (SSE)",selectModelError:"Please select a model",temperatureError:"Temperature must be between 0.0 and 2.0",maxTokensError:"Max Tokens must be a positive integer",messageRequired:"Please enter a message",sendError:"Failed to send chat request",settings:"Settings",addMessage:"Add Message",removeMessage:"Remove"},Ze={title:"Security Events",auditLogs:"Audit Logs",intrusionDetection:"Intrusion Detection",anomalyDetection:"Anomaly Detection",ipBlocklist:"IP Blocklist",block:"Block",unblock:"Unblock",clearTemporary:"Clear Temporary",exportCSV:"Export CSV",exportJSON:"Export JSON",filterApply:"Apply Filter",filterClear:"Clear Filter",eventType:"Event Type",severity:"Severity",ipAddress:"IP Address",minScore:"Min Score",anomalyType:"Anomaly Type",ipBlocklistManagement:"IP Blocklist Management",fetchError:"Failed to fetch IP blocklist",unblockConfirm:"Unblock IP {{ip}}?",unblockSuccess:"Unblocked IP {{ip}}",unblockError:"Failed to unblock IP",clearTemporaryConfirm:"Clear all temporary blocks? Permanent blocks will remain.",clearTemporarySuccess:"Cleared all temporary blocks",clearTemporaryError:"Failed to clear temporary blocks",clearAllTemporary:"Clear All Temporary Blocks",refresh:"Refresh",totalBlocks:"Total Blocks",permanentBlocks:"Permanent Blocks",temporaryBlocks:"Temporary Blocks",noBlockedIps:"No blocked IP addresses",blockedAt:"Blocked At",reason:"Reason",permanent:"Permanent",temporary:"Temporary",failureCount:"Failure Count",firstFailureAt:"First Failure At",blockedUntil:"Blocked Until",lastAttempt:"Last Attempt",type:"Type",cannotUnblockPermanent:"Cannot unblock permanent blocks"},et={title:"Settings",language:"Language",displayLanguage:"Display Language",languageHint:"Select the application display language (Current: {{current}})",japanese:"Japanese",english:"English",autoDetect:"Auto Detect"},tt={menu:"Menu",home:"Home",chatTester:"Chat Tester",securityEvents:"Security Events",ipBlocklist:"IP Blocklist",settings:"Settings",modelProfiles:"Model Profiles",modelComparison:"Model Comparison",collapse:"Collapse sidebar",expand:"Expand sidebar"},st={title:"Model Profiles",description:"Manage model-specific parameter profiles for different engines.",fetchError:"Failed to fetch model profiles",saveError:"Failed to save model profile",deleteError:"Failed to delete model profile",createSuccess:"Model profile created successfully",updateSuccess:"Model profile updated successfully",deleteSuccess:"Model profile deleted successfully",deleteConfirm:'Delete profile "{{label}}"? This action cannot be undone.',requiredFields:"Please fill in required fields",invalidJson:"Invalid JSON format. Please enter valid JSON.",filterByEngine:"Filter by Engine",filterByModel:"Filter by Model",enginePlaceholder:"e.g., ollama",modelPlaceholder:"e.g., llama3",createNew:"Create New Profile",createProfile:"Create Profile",editProfile:"Edit Profile",engineId:"Engine ID",modelId:"Model ID",label:"Label",labelPlaceholder:"Profile name",parameters:"Parameters (JSON)",parametersHint:'Enter parameters as JSON. Example: {"temperature": 0.7, "max_tokens": 512}',profilesList:"Profiles",noProfiles:"No profiles found",updatedAt:"Updated"},rt={title:"Model Comparison & Health History",description:"View engine health history and compare model performance over time.",fetchError:"Failed to fetch health history",timeRange:"Time Range",last24Hours:"Last 24 Hours",last7Days:"Last 7 Days",last30Days:"Last 30 Days",filterByEngine:"Filter by Engine",filterByModel:"Filter by Model",enginePlaceholder:"e.g., ollama",modelPlaceholder:"e.g., llama3",totalChecks:"Total Checks",successRate:"Success Rate",avgLatency:"Avg Latency",avgErrorRate:"Avg Error Rate",statusBreakdown:"Status Breakdown",healthy:"Healthy",degraded:"Degraded",unreachable:"Unreachable",engineSummary:"Engine Summary",modelSummary:"Model Summary",recentLogs:"Recent Logs",engine:"Engine",model:"Model",status:"Status",latency:"Latency",errorRate:"Error Rate",timestamp:"Timestamp",nA:"N/A",noData:"No health history data available",noModelData:"No model-specific data available"},at={generic:"An error occurred",networkError:"Network error occurred",cliError:"CLI error occurred",proxyNotRunning:"Proxy is not running",details:"Details",showDetails:"Show Details",hideDetails:"Hide Details"},nt={proxyStarted:"Proxy started",proxyStopped:"Proxy stopped",enginesDetected:"Engine detection completed",ipBlocked:"IP address blocked",ipUnblocked:"IP address unblocked",temporaryBlockedCleared:"Temporary blocks cleared",languageChanged:"Language changed to {{locale}}"},je={common:Ye,home:Xe,chatTester:Qe,security:Ze,settings:et,sidebar:tt,modelProfiles:st,modelComparison:rt,errors:at,messages:nt},ve=a.createContext(void 0),lt={ja:le,en:je},it=({children:t})=>{const[s,r]=a.useState("ja");a.useEffect(()=>{(async()=>{try{const f=navigator.language.toLowerCase();let y="ja";f.startsWith("ja")?y="ja":f.startsWith("en")&&(y="en");try{const j=await L("ipc_config_get",{key:"preferred_language"});j?.data?.value&&(j.data.value==="ja"||j.data.value==="en")&&(y=j.data.value)}catch{}r(y)}catch{r("ja")}})()},[]);const n=a.useCallback((g,f)=>{let y=g;for(const j of f)if(y&&typeof y=="object"&&j in y)y=y[j];else return null;return typeof y=="string"?y:null},[]),l=a.useCallback(async g=>{r(g);try{await L("ipc_config_set",{key:"preferred_language",value:g})}catch{}},[]),m=a.useCallback((g,f)=>{const y=g.split(".");let j=n(lt[s],y);return j===null&&s!=="ja"&&(j=n(le,y)),j===null&&(j=n(je,y)),j===null?g:f?j.replace(/\{\{(\w+)\}\}/g,(b,P)=>f[P]?.toString()||b):j},[s,n]),d=a.useMemo(()=>({locale:s,setLocale:l,t:m}),[s,l,m]);return e.jsx(ve.Provider,{value:d,children:t})},U=()=>{const t=a.useContext(ve);return t||{locale:"ja",setLocale:async()=>{},t:(r,n)=>{const l=r.split(".");let m=null,d=le;for(const g of l)if(d&&typeof d=="object"&&g in d)d=d[g];else return r;return m=typeof d=="string"?d:null,m===null?r:n?m.replace(/\{\{(\w+)\}\}/g,(g,f)=>n[f]?.toString()||g):m}}},ot={level:1,enableConsole:!0};let ue={...ot};function Q(t){return t>=ue.level&&ue.enableConsole}function ct(t){return{debug:(...r)=>{Q(0)&&console.debug("",...r)},info:(...r)=>{Q(1)&&console.info("",...r)},warn:(...r)=>{Q(2)&&console.warn("",...r)},error:(...r)=>{Q(3)&&console.error("",...r)}}}const q=ct(),be=a.createContext(void 0),ae="flm_preferred_theme",dt=({children:t})=>{const[s,r]=a.useState("light"),n=a.useCallback(g=>{const f=document.documentElement;g==="dark"?(f.classList.add("dark-theme"),f.classList.remove("light-theme")):(f.classList.add("light-theme"),f.classList.remove("dark-theme"))},[]);a.useEffect(()=>{(async()=>{try{const j=localStorage.getItem(ae);if(j==="light"||j==="dark")r(j),n(j);else{const P=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";r(P),n(P)}}catch(j){q.error("Failed to load theme:",j),r("light"),n("light")}})();const f=window.matchMedia("(prefers-color-scheme: dark)"),y=j=>{if(!localStorage.getItem(ae)){const P=j.matches?"dark":"light";r(P),n(P)}};return f.addEventListener("change",y),()=>f.removeEventListener("change",y)},[n]);const l=a.useCallback(async g=>{try{r(g),n(g),localStorage.setItem(ae,g)}catch(f){throw q.error("Failed to save theme:",f),f}},[n]),m=a.useCallback(async()=>{await l(s==="light"?"dark":"light")},[s,l]),d={theme:s,setTheme:l,toggleTheme:m};return e.jsx(be.Provider,{value:d,children:t})},ut=()=>{const t=a.useContext(be);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t},mt=({defaultCollapsed:t=!1,className:s="",onCollapseChange:r})=>{const n=xe(),l=Pe(),{t:m}=U(),[d,g]=a.useState(t),f=a.useCallback(()=>{const S=!d;g(S),r?.(S)},[d,r]),y=a.useCallback(S=>l.pathname===S||l.pathname.startsWith(`${S}/`),[l.pathname]),j=[{path:"/",label:m("sidebar.home")},{path:"/chat/tester",label:m("sidebar.chatTester")},{path:"/security/events",label:m("sidebar.securityEvents")},{path:"/security/ip-blocklist",label:m("sidebar.ipBlocklist")},{path:"/security/ip-whitelist",label:m("sidebar.ipWhitelist")},{path:"/models/profiles",label:m("sidebar.modelProfiles")},{path:"/models/comparison",label:m("sidebar.modelComparison")},{path:"/settings",label:m("sidebar.settings")}],b=a.useCallback(S=>{n(S)},[n]),P=`app-sidebar ${d?"collapsed":""} ${s}`.trim();return e.jsx("aside",{className:P,children:e.jsxs("div",{className:"sidebar-container",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("button",{className:"sidebar-toggle",onClick:f,"aria-label":m(d?"sidebar.expand":"sidebar.collapse"),"aria-expanded":!d,children:d?"▶":"◀"}),!d&&e.jsx("h2",{className:"sidebar-title",children:m("sidebar.menu")})]}),e.jsx("nav",{className:"sidebar-nav","aria-label":m("sidebar.menu"),children:e.jsx("ul",{className:"sidebar-nav-list",children:j.map(S=>{const N=y(S.path);return e.jsx("li",{className:"sidebar-nav-item",children:e.jsx("button",{className:`sidebar-nav-link ${N?"active":""}`,onClick:()=>b(S.path),"aria-label":S.label,"aria-current":N?"page":void 0,children:!d&&e.jsx("span",{className:"sidebar-nav-label",children:S.label})})},S.path)})})})]})})},$=({children:t,className:s=""})=>e.jsxs("div",{className:`app-layout ${s}`,children:[e.jsx(mt,{}),e.jsx("div",{className:"layout-body",children:e.jsx("main",{className:"main-content",children:t})})]});function Se(){if(typeof window<"u")try{const t=localStorage.getItem("locale");if(t==="en"||t==="ja")return t;if(navigator.language.toLowerCase().startsWith("en"))return"en"}catch{}return"ja"}function ht(t){const s=Se();return{ja:"ja-JP",en:"en-US"}[s]||"ja-JP"}function pt(t){return Se()==="en"?"Unknown":"不明"}const H=(t,s)=>{if(!t||t.trim()==="")return pt();try{const r=new Date(t);if(isNaN(r.getTime()))return t;const n=ht(s);return r.toLocaleString(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t}},gt=t=>typeof t=="string"?{"local-http":"Local HTTP","dev-selfsigned":"Dev Self-Signed","dev-self-signed":"Dev Self-Signed","https-acme":"HTTPS ACME","packaged-ca":"Packaged CA"}[t]||t:t&&typeof t=="object"?"LocalHttp"in t||"local-http"in t?"Local HTTP":"DevSelfSigned"in t||"dev-selfsigned"in t||"dev-self-signed"in t?"Dev Self-Signed":"HttpsAcme"in t||"https-acme"in t?"HTTPS ACME":"PackagedCa"in t||"packaged-ca"in t?"Packaged CA":JSON.stringify(t):"Unknown",ft=t=>{if(typeof t=="string")return{"installed-only":"Installed Only","running-healthy":"Running Healthy","running-degraded":"Running Degraded","error-network":"Network Error","error-api":"API Error"}[t]||t.replace(/-/g," ").replace(/\b\w/g,r=>r.toUpperCase());if(t&&typeof t=="object"){const s=t;if("status"in s){const r=s.status;if(typeof r=="string"){const n=typeof s.latency_ms=="number"?s.latency_ms:void 0,l=typeof s.reason=="string"?s.reason:void 0;return{"installed-only":"Installed Only","running-healthy":`Running Healthy${n?` (${n}ms)`:""}`,"running-degraded":`Running Degraded${n?` (${n}ms)`:""}${l?`: ${l}`:""}`,"error-network":`Network Error${l?`: ${l}`:""}`,"error-api":`API Error${l?`: ${l}`:""}`}[r]||r.replace(/-/g," ").replace(/\b\w/g,d=>d.toUpperCase())}}if("InstalledOnly"in s||"installed-only"in s)return"Installed Only";if("RunningHealthy"in s||"running-healthy"in s){const r=s.RunningHealthy||s["running-healthy"]||s,n=typeof r.latency_ms=="number"?r.latency_ms:void 0;return`Running Healthy${n?` (${n}ms)`:""}`}if("RunningDegraded"in s||"running-degraded"in s){const r=s.RunningDegraded||s["running-degraded"]||s,n=typeof r.latency_ms=="number"?r.latency_ms:void 0,l=typeof r.reason=="string"?r.reason:void 0;return`Running Degraded${n?` (${n}ms)`:""}${l?`: ${l}`:""}`}if("ErrorNetwork"in s||"error-network"in s){const r=s.ErrorNetwork||s["error-network"]||s,n=typeof r.reason=="string"?r.reason:void 0;return`Network Error${n?`: ${n}`:""}`}if("ErrorApi"in s||"error-api"in s){const r=s.ErrorApi||s["error-api"]||s,n=typeof r.reason=="string"?r.reason:void 0;return`API Error${n?`: ${n}`:""}`}return JSON.stringify(t)}return"Unknown"};function J(t,s){const r=t.current[s];r&&(clearTimeout(r),delete t.current[s])}function Y(t,s,r,n){J(t,s),t.current[s]=setTimeout(r,n)}function yt(t){Object.keys(t.current).forEach(s=>{J(t,s)})}function F(t){const{defaultMessage:s,silentPatterns:r=[],showStderr:n=!1}=t;return l=>{const m=Ue(l),d=l instanceof Error?l.message:s,g=r.some(y=>d.toLowerCase().includes(y.toLowerCase()));return{message:m?.stderr&&n?`${d}
詳細: ${m.stderr}`:d,shouldShow:!g,cliError:m??void 0}}}const B={STATUS_REFRESH_DELAY_MS:1e3,MESSAGE_AUTO_DISMISS_MS:3e3,STATUS_POLL_INTERVAL_MS:3e4},xt=["not found","not running","CLI_BINARY_NOT_FOUND"],Z={MODE:"dev-selfsigned",PORT:8080},me={TEMPERATURE:.7,MAX_TOKENS:1e3},O=W.memo(({message:t,onDismiss:s,details:r})=>e.jsxs("div",{className:"error-message",children:[e.jsxs("div",{className:"error-message-header",children:[e.jsx("strong",{children:"エラー:"}),s&&e.jsx("button",{className:"error-dismiss-button",onClick:s,"aria-label":"エラーメッセージを閉じる",children:"×"})]}),e.jsx("div",{className:"error-message-content",children:t}),r&&e.jsxs("details",{className:"error-details",children:[e.jsx("summary",{children:"詳細情報"}),e.jsx("pre",{className:"error-details-content",children:r})]})]}));O.displayName="ErrorMessage";const z=W.memo(({message:t,onDismiss:s,autoDismiss:r=3e3})=>(a.useEffect(()=>{if(r>0&&s){const n=setTimeout(()=>{s()},r);return()=>clearTimeout(n)}},[r,s]),e.jsxs("div",{className:"success-message",children:[e.jsxs("div",{className:"success-message-header",children:[e.jsx("strong",{children:"成功:"}),s&&e.jsx("button",{className:"success-dismiss-button",onClick:s,"aria-label":"成功メッセージを閉じる",children:"×"})]}),e.jsx("div",{className:"success-message-content",children:t})]})));z.displayName="SuccessMessage";const R=W.memo(({size:t="medium",message:s})=>e.jsxs("div",{className:`loading-spinner-container ${t}`,role:"status","aria-live":"polite","aria-label":s||"読み込み中",children:[e.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),s&&e.jsx("p",{className:"loading-message",id:"loading-message",children:s})]}));R.displayName="LoadingSpinner";const jt=new Set(["installed-only","running-healthy","running-degraded","error-network","error-api","unknown"]);function he(t){if(!t||typeof t!="object")return!1;const s=t;if(!("data"in s))return!1;const r=s.data;return Array.isArray(r)&&r.length>0}function pe(t){return t!==null&&typeof t=="object"&&"running"in t&&typeof t.running=="boolean"}function ne(t){if(!t||typeof t!="object")return null;const s=t;if(typeof s.id!="string"||!s.id.trim())return null;const r=s.id.trim(),n=typeof s.name=="string"&&s.name.trim()?s.name.trim():r;let l="unknown";return s.status!==void 0&&(typeof s.status=="string"?l=jt.has(s.status)?s.status:"unknown":typeof s.status=="object"&&s.status!==null&&(l=s.status)),{id:r,name:n,status:l}}const vt=()=>{const t=xe(),{t:s}=U(),[r,n]=a.useState(null),[l,m]=a.useState([]),[d,g]=a.useState(!1),[f,y]=a.useState(!1),[j,b]=a.useState(null),[P,S]=a.useState(null),N=a.useRef({}),T=a.useCallback(h=>{if(he(h)){const x=h.data;if(x&&x.length>0){const A=x[0];n({running:A.running??!1,port:A.port,mode:A.mode});return}}if(pe(h)){n(h);return}n({running:!1})},[]),_=a.useMemo(()=>F({defaultMessage:"プロキシステータスの取得に失敗しました",silentPatterns:xt}),[]),E=a.useCallback(async()=>{try{const h=await L("ipc_proxy_status");if(T(h),b(x=>x?.includes("プロキシステータス")?null:x),he(h)){const x=h.data;if(x&&x.length>0){const A=x[0];return{running:A.running??!1,port:A.port,mode:A.mode}}}return pe(h)?h:{running:!1}}catch(h){const x=_(h);return x.shouldShow?b(x.message):n({running:!1}),{running:!1}}},[T,_]),p=a.useCallback(async()=>{y(!0),b(null);try{const h=await L("ipc_detect_engines",{fresh:!1});if(h&&"data"in h&&h.data&&"engines"in h.data){const x=h.data.engines;Array.isArray(x)&&m(x.map(ne).filter(A=>A!==null))}else h&&"engines"in h&&Array.isArray(h.engines)?m(h.engines.map(ne).filter(x=>x!==null)):Array.isArray(h)?m(h.map(ne).filter(x=>x!==null)):m([])}catch(h){q.warn("エンジンの検出に失敗しました:",h),m([])}finally{y(!1)}},[]),c=a.useMemo(()=>F({defaultMessage:s("errors.generic")}),[s]),u=a.useMemo(()=>F({defaultMessage:s("errors.generic")}),[s]),o=a.useCallback(async()=>{g(!0),b(null),S(null),J(N,"status"),J(N,"message");try{await L("ipc_proxy_start",{mode:Z.MODE,port:Z.PORT,no_daemon:!0}),S(s("messages.proxyStarted")),Y(N,"status",()=>{E()},B.STATUS_REFRESH_DELAY_MS),Y(N,"message",()=>{S(null)},B.MESSAGE_AUTO_DISMISS_MS)}catch(h){const x=c(h);x.shouldShow&&b(x.message),S(null)}finally{g(!1)}},[E,c,s]),C=a.useCallback(async()=>{if(g(!0),b(null),S(null),J(N,"status"),J(N,"message"),!r||!r.running||!r.port){b(s("errors.proxyNotRunning")||"プロキシが実行されていません"),g(!1);return}try{await L("ipc_proxy_stop",{port:r.port}),S(s("messages.proxyStopped")),Y(N,"message",()=>{S(null)},B.MESSAGE_AUTO_DISMISS_MS),Y(N,"status",()=>{E()},B.STATUS_REFRESH_DELAY_MS)}catch(h){const x=u(h);x.shouldShow&&b(x.message),S(null)}finally{g(!1)}},[r,E,u,s]),i=a.useMemo(()=>F({defaultMessage:s("errors.generic")}),[s]),w=a.useCallback(async()=>{b(null),S(null),J(N,"detect"),J(N,"message");try{await p(),S(s("messages.enginesDetected")),Y(N,"detect",()=>{S(null)},B.MESSAGE_AUTO_DISMISS_MS)}catch(h){const x=i(h);x.shouldShow&&b(x.message)}},[p,i,s]);a.useEffect(()=>{E(),p();const h=setInterval(()=>{E()},B.STATUS_POLL_INTERVAL_MS);return()=>{clearInterval(h),yt(N)}},[E,p]),a.useEffect(()=>{const h=async()=>{if(r!==null&&!r.running)try{await L("ipc_proxy_start",{mode:Z.MODE,port:Z.PORT,no_daemon:!0}),setTimeout(()=>{E()},B.STATUS_REFRESH_DELAY_MS)}catch(A){q.warn("Failed to auto-start proxy:",A)}},x=setTimeout(()=>{h()},1e3);return()=>{clearTimeout(x)}},[r,E]);const k=a.useMemo(()=>{if(f)return e.jsx(R,{size:"small",message:s("common.loading")});if(l.length===0)return e.jsx("div",{className:"status-info",children:e.jsx("div",{className:"status-badge status-stopped",children:s("home.noEngines")})});const h=l.slice(0,3),x=l.length-3;return e.jsxs("div",{className:"status-info",children:[e.jsx("div",{className:"status-badge status-running",children:s("home.enginesFound",{count:l.length})}),e.jsxs("div",{className:"engine-list",children:[h.map(A=>e.jsxs("div",{className:"engine-item",children:[A.name," (",ft(A.status),")"]},A.id)),x>0&&e.jsx("div",{className:"engine-item",children:s("common.others",{count:x})})]})]})},[f,l,s]);return e.jsxs("div",{className:"home",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:s("home.title")}),e.jsx("p",{className:"page-subtitle",children:s("home.subtitle")})]}),j&&e.jsx(O,{message:j,onDismiss:()=>b(null)}),P&&e.jsx(z,{message:P,onDismiss:()=>S(null),autoDismiss:B.MESSAGE_AUTO_DISMISS_MS}),e.jsxs("div",{className:"home-content",children:[e.jsxs("section",{className:"status-section",children:[e.jsx("h2",{children:"システムステータス"}),e.jsxs("div",{className:"status-cards",children:[e.jsxs("div",{className:"status-card",children:[e.jsx("h3",{children:s("home.proxyStatus")}),r?e.jsxs("div",{className:"status-info",children:[e.jsx("div",{className:`status-badge ${r.running?"status-running":"status-stopped"}`,children:r.running?s("home.running"):s("home.stopped")}),r.running&&r.port&&e.jsxs("div",{className:"status-detail",children:[e.jsxs("span",{children:[s("home.port"),": ",r.port]}),r.mode&&e.jsxs("span",{children:[s("home.mode"),": ",gt(r.mode)]})]})]}):e.jsx(R,{size:"small",message:s("common.loading")})]}),e.jsxs("div",{className:"status-card",children:[e.jsx("h3",{children:s("home.engineStatus")}),k]})]})]}),e.jsxs("section",{className:"actions-section",children:[e.jsx("h2",{children:s("home.quickActions")}),e.jsxs("div",{className:"action-buttons",children:[r?.running?e.jsx("button",{className:"button-danger action-button",onClick:C,disabled:d,children:s("home.stopProxy")}):e.jsx("button",{className:"button-primary action-button",onClick:o,disabled:d,children:s("home.startProxy")}),e.jsx("button",{className:"button-secondary action-button",onClick:w,disabled:f||d,children:s(f?"common.loading":"home.detectEngines")}),e.jsx("button",{className:"button-secondary action-button",onClick:()=>t("/chat/tester"),children:s("home.chatTester")}),e.jsx("button",{className:"button-secondary action-button",onClick:()=>t("/security/events"),children:s("home.securityEvents")})]})]}),e.jsxs("section",{className:"info-section",children:[e.jsx("h2",{children:s("home.appOverview")}),e.jsxs("div",{className:"info-content",children:[e.jsx("p",{children:s("home.appDescription")}),e.jsxs("ul",{children:[e.jsx("li",{children:s("home.feature1")}),e.jsx("li",{children:s("home.feature2")}),e.jsx("li",{children:s("home.feature3")}),e.jsx("li",{children:s("home.feature4")})]})]})]})]})]})},Ne={MODELS:"/v1/models",CHAT_COMPLETIONS:"/v1/chat/completions"},ge="flm-";function Ce(t,s){try{const r=new URL(t);let n;const l=s.toLowerCase(),m=l.startsWith("http://")||l.startsWith("https://");if(s.startsWith("//"))throw new Error("Invalid URL: protocol-relative URLs are not allowed");if(m){if(n=new URL(s),n.origin!==r.origin)throw new Error("Invalid URL: origin mismatch")}else if(n=new URL(s,t),n.origin!==r.origin)throw new Error("Invalid URL: origin mismatch");if(n.protocol!=="http:"&&n.protocol!=="https:")throw new Error("Invalid URL: only http and https protocols are allowed");return n.toString()}catch{throw new Error(`Invalid proxy endpoint URL: ${t}`)}}function bt(t){if(!t)return"http";if(typeof t=="string")return t.toLowerCase().includes("https")?"https":"http";if(typeof t=="object"){const s=Object.keys(t),r=new Set(["HttpsAcme","DevSelfSigned","PackagedCa"]);return s.some(n=>r.has(n))?"https":"http"}return"http"}function St(t){if(!t||typeof t!="object")return!1;const s=t;return typeof s.id=="string"&&typeof s.object=="string"&&typeof s.created=="number"&&typeof s.model=="string"&&Array.isArray(s.choices)}function Nt(t){return!t||typeof t!="object"?null:"data"in t&&Array.isArray(t.data)&&t.data.length>0?t.data[0]:"running"in t?t:null}function Ct(t){const s=t.id||"";if(!s)return null;let r="",n=s;if(s.startsWith(ge)){const l=s.replace(ge,"").split("-");l.length>=2?(r=`flm://${l[0]}/${l.slice(1).join("-")}`,n=r):r=s}else r=s;return{id:s,flmUri:r,displayName:n}}function kt(t){if(!t||typeof t!="object"||!("data"in t))return[];const s=t;return Array.isArray(s.data)?s.data.map(r=>Ct(r)).filter(r=>r!==null):[]}async function Et(t){try{const s=await fetch(Ce(t,Ne.MODELS),{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch models: HTTP ${s.status}`);const r=await s.json();return kt(r)}catch(s){throw new Error(s instanceof Error?s.message:"モデルリストの取得に失敗しました")}}function wt(t){const s={"Content-Type":"application/json"};return t&&(s.Authorization=`Bearer ${t}`),s}async function Pt(t){let s=`Chat completion failed: HTTP ${t.status}`;try{const r=await t.text()}catch{}return s}function Tt(t,s){const r=s.headers.get("x-request-id")||s.headers.get("X-Request-Id");return r?{...t,request_id:r}:t}async function _t(t,s,r){try{const n=wt(s),l=await fetch(Ce(t,Ne.CHAT_COMPLETIONS),{method:"POST",headers:n,body:JSON.stringify(r)});if(!l.ok){const d=await Pt(l);throw new Error(d)}const m=await l.json();if(!St(m))throw new Error("Invalid response format from chat completion endpoint");return Tt(m,l)}catch(n){throw new Error(n instanceof Error?n.message:"チャットリクエストの送信に失敗しました")}}async function At(){try{const t=await L("ipc_proxy_status"),s=Nt(t);return s?.running?s.endpoints?.localhost?s.endpoints.localhost:s.port?`${bt(s.mode)}://localhost:${s.port}`:null:null}catch{return null}}function Mt(t){const s=typeof t=="string"?parseFloat(t):t;return!isNaN(s)&&s>=0&&s<=2}function Lt(t){const s=typeof t=="string"?parseInt(t,10):t;return Number.isInteger(s)&&s>0}function fe(t,s,r){const n=typeof t=="string"?parseFloat(t):t;return isNaN(n)||s!==void 0&&n<s||r!==void 0&&n>r?null:n}const It=()=>{const{t}=U(),[s,r]=a.useState(null),[n,l]=a.useState([]),[m,d]=a.useState(""),[g,f]=a.useState(""),[y,j]=a.useState([{role:"user",content:""}]),[b,P]=a.useState(!1),[S,N]=a.useState(me.TEMPERATURE),[T,_]=a.useState(me.MAX_TOKENS),[E,p]=a.useState(null),[c,u]=a.useState(!1),[o,C]=a.useState(null),i=a.useMemo(()=>F({defaultMessage:t("chatTester.proxyEndpointError")}),[t]),w=a.useCallback(async()=>{u(!0),C(null);try{const M=await At();r(M),M||C(t("chatTester.proxyNotRunning"))}catch(M){const v=i(M);v.shouldShow&&C(v.message)}finally{u(!1)}},[i,t]),k=a.useMemo(()=>F({defaultMessage:t("chatTester.modelListError")}),[t]),h=a.useMemo(()=>F({defaultMessage:t("chatTester.sendError")}),[t]),x=a.useCallback(async()=>{if(s){u(!0),C(null);try{const M=await Et(s);l(M),M.length>0&&!m&&d(M[0].id)}catch(M){const v=k(M);v.shouldShow&&C(v.message)}finally{u(!1)}}},[s,k]);a.useEffect(()=>{w()},[w]),a.useEffect(()=>{s&&x()},[s,x]);const A=()=>{j([...y,{role:"user",content:""}])},D=M=>{y.length>1&&j(y.filter((v,I)=>I!==M))},K=(M,v)=>{const I=[...y];I[M]={...I[M],content:v},j(I)},te=(M,v)=>{const I=[...y];I[M]={...I[M],role:v},j(I)},se=async()=>{if(!s){C(t("chatTester.proxyEndpointNotAvailable"));return}if(!m){C(t("chatTester.selectModelError"));return}if(!Mt(S)){C(t("chatTester.temperatureError"));return}if(!Lt(T)){C(t("chatTester.maxTokensError"));return}const M=y.filter(v=>v.content.trim().length>0);if(M.length===0){C(t("chatTester.messageRequired"));return}u(!0),C(null),p(null);try{const I=await _t(s,g||null,{model:m,messages:M,stream:b,temperature:S,max_tokens:T});p(I)}catch(v){const I=h(v);I.shouldShow&&C(I.message)}finally{u(!1)}};return e.jsxs("div",{className:"chat-tester",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:t("chatTester.title")})}),o&&e.jsx(O,{message:o,onDismiss:()=>C(null)}),!s&&!c&&e.jsx("div",{className:"proxy-warning",children:e.jsx("p",{children:t("chatTester.proxyNotRunning")})}),c&&!s&&e.jsx(R,{message:t("chatTester.fetchingProxyEndpoint")}),s&&e.jsxs("div",{className:"chat-tester-content",children:[e.jsxs("div",{className:"tester-config",children:[e.jsx("h2",{children:t("chatTester.settings")}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{children:[t("chatTester.proxyEndpoint"),":",e.jsx("code",{className:"endpoint-display",children:s})]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{htmlFor:"model-select",children:[t("chatTester.model"),":",e.jsxs("select",{id:"model-select",value:m,onChange:M=>d(M.target.value),className:"model-select",disabled:c||n.length===0,"aria-label":t("chatTester.model"),"aria-describedby":n.length===0&&!c?"model-select-help":void 0,children:[e.jsx("option",{value:"",children:t("chatTester.selectModel")}),n.map(M=>e.jsx("option",{value:M.id,children:M.displayName},M.id))]}),n.length===0&&!c&&e.jsx("span",{id:"model-select-help",className:"help-text",children:t("chatTester.modelNotAvailable")}),c&&n.length===0?e.jsx(R,{size:"small",message:t("chatTester.fetchingModelList")}):e.jsx("button",{className:"button-secondary button-small",onClick:x,disabled:c,children:t("chatTester.refresh")})]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{htmlFor:"api-key-input",children:[t("chatTester.apiKey"),":",e.jsx("input",{id:"api-key-input",type:"password",value:g,onChange:M=>f(M.target.value),placeholder:t("chatTester.apiKeyPlaceholder"),className:"input-text","aria-label":t("chatTester.apiKey")})]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{htmlFor:"streaming-checkbox",children:[e.jsx("input",{id:"streaming-checkbox",type:"checkbox",checked:b,onChange:M=>P(M.target.checked)}),t("chatTester.streaming")]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{htmlFor:"temperature-input",children:["Temperature:",e.jsx("input",{id:"temperature-input",type:"number",value:S,onChange:M=>{const v=fe(M.target.value,0,2);v!==null&&N(v)},min:"0",max:"2",step:"0.1",className:"input-number","aria-label":"Temperature（0.0から2.0の範囲）","aria-describedby":"temperature-help"}),e.jsx("span",{id:"temperature-help",className:"help-text",children:t("chatTester.temperatureError")})]})}),e.jsx("div",{className:"config-section",children:e.jsxs("label",{htmlFor:"max-tokens-input",children:["Max Tokens:",e.jsx("input",{id:"max-tokens-input",type:"number",value:T,onChange:M=>{const v=fe(M.target.value,1);v!==null&&Number.isInteger(v)&&_(v)},min:"1",className:"input-number","aria-label":"Max Tokens（1以上の整数）","aria-describedby":"max-tokens-help"}),e.jsx("span",{id:"max-tokens-help",className:"help-text",children:t("chatTester.maxTokensError")})]})})]}),e.jsxs("div",{className:"tester-messages",children:[e.jsx("h2",{children:t("chatTester.message")}),e.jsx("div",{className:"messages-list",children:y.map((M,v)=>e.jsxs("div",{className:"message-item",children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("label",{htmlFor:`role-select-${v}`,className:"sr-only",children:["メッセージ",v+1,"のロールを選択"]}),e.jsxs("select",{id:`role-select-${v}`,value:M.role,onChange:I=>te(v,I.target.value),className:"role-select",children:[e.jsx("option",{value:"system",children:"System"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"assistant",children:"Assistant"})]}),y.length>1&&e.jsx("button",{className:"button-danger button-small",onClick:()=>D(v),"aria-label":`メッセージ${v+1}を削除`,children:"削除"})]}),e.jsxs("label",{htmlFor:`message-textarea-${v}`,className:"sr-only",children:["メッセージ",v+1,"の内容を入力"]}),e.jsx("textarea",{id:`message-textarea-${v}`,value:M.content,onChange:I=>K(v,I.target.value),placeholder:t("chatTester.message")+"...",className:"message-textarea",rows:4})]},v))}),e.jsxs("button",{className:"button-secondary",onClick:A,"aria-label":"新しいメッセージを追加",children:["+ ",t("chatTester.addMessage")]}),e.jsx("div",{className:"send-actions",children:c?e.jsx(R,{size:"small",message:"送信中..."}):e.jsx("button",{className:"button-primary",onClick:se,disabled:!m||!s,children:t("chatTester.send")})})]}),E&&e.jsxs("div",{className:"tester-response",children:[e.jsx("h2",{children:t("chatTester.response")}),E.request_id&&e.jsx("div",{className:"response-meta",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Request ID:"})," ",e.jsx("code",{children:E.request_id})]})}),e.jsxs("div",{className:"response-content",children:[e.jsx("h3",{children:"選択された応答:"}),E.choices&&E.choices.length>0&&e.jsxs("div",{className:"choice-item",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",E.choices[0].message.role]}),e.jsx("p",{children:e.jsx("strong",{children:"Content:"})}),e.jsx("pre",{className:"response-text",children:E.choices[0].message.content}),e.jsxs("p",{children:[e.jsx("strong",{children:"Finish Reason:"})," ",E.choices[0].finish_reason]})]}),E.usage&&e.jsxs("div",{className:"response-usage",children:[e.jsx("h4",{children:"使用量:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Prompt Tokens: ",E.usage.prompt_tokens]}),e.jsxs("li",{children:["Completion Tokens: ",E.usage.completion_tokens]}),e.jsxs("li",{children:["Total Tokens: ",E.usage.total_tokens]})]})]})]}),e.jsxs("div",{className:"response-raw",children:[e.jsx("h3",{children:"Raw JSON:"}),e.jsx("pre",{className:"json-display",children:JSON.stringify(E,null,2)})]})]})]})]})};function Rt(t){if(!t||typeof t!="object")return!1;const s=t;return typeof s.version=="string"&&s.data!==null&&typeof s.data=="object"&&"logs"in s.data&&Array.isArray(s.data.logs)}function Dt(t){if(!t||typeof t!="object")return!1;const s=t;return typeof s.version=="string"&&s.data!==null&&typeof s.data=="object"&&"attempts"in s.data&&Array.isArray(s.data.attempts)}function Ft(t){if(!t||typeof t!="object")return!1;const s=t;return typeof s.version=="string"&&s.data!==null&&typeof s.data=="object"&&"detections"in s.data&&Array.isArray(s.data.detections)}function Ot(t){if(!t||typeof t!="object")return!1;const s=t;return typeof s.version=="string"&&s.data!==null&&typeof s.data=="object"&&"blocked_ips"in s.data&&Array.isArray(s.data.blocked_ips)}function Ut(t){return{id:t.id,requestId:t.request_id,apiKeyId:t.api_key_id,endpoint:t.endpoint,status:t.status,latencyMs:t.latency_ms,eventType:t.event_type,severity:t.severity,ip:t.ip,details:t.details,createdAt:t.created_at}}function $t(t){const s={};return t.eventType&&(s.event_type=t.eventType),t.severity&&(s.severity=t.severity),t.ip&&(s.ip=t.ip),t.limit!==void 0&&(s.limit=t.limit),t.offset!==void 0&&(s.offset=t.offset),s}async function Bt(t={}){const s=$t(t),r=await L("ipc_security_audit_logs",Object.keys(s).length>0?s:void 0);return!Rt(r)||!r.data?.logs?[]:r.data.logs.map(Ut)}function qt(t){return{id:t.id,ip:t.ip,pattern:t.pattern,score:t.score,requestPath:t.request_path,userAgent:t.user_agent,method:t.method,createdAt:t.created_at}}function Ht(t){const s={};return t.ip&&(s.ip=t.ip),t.minScore!==void 0&&(s.min_score=t.minScore),t.limit!==void 0&&(s.limit=t.limit),t.offset!==void 0&&(s.offset=t.offset),s}async function Jt(t={}){const s=Ht(t),r=await L("ipc_security_intrusion",Object.keys(s).length>0?s:void 0);return!Dt(r)||!r.data?.attempts?[]:r.data.attempts.map(qt)}function Wt(t){return{id:t.id,ip:t.ip,anomalyType:t.anomaly_type,score:t.score,details:t.details,createdAt:t.created_at}}function zt(t){const s={};return t.ip&&(s.ip=t.ip),t.anomalyType&&(s.anomaly_type=t.anomalyType),t.limit!==void 0&&(s.limit=t.limit),t.offset!==void 0&&(s.offset=t.offset),s}async function Vt(t={}){const s=zt(t),r=await L("ipc_security_anomaly",Object.keys(s).length>0?s:void 0);return!Ft(r)||!r.data?.detections?[]:r.data.detections.map(Wt)}function Kt(t){return{ip:t.ip,failureCount:t.failure_count,firstFailureAt:t.first_failure_at,blockedUntil:t.blocked_until,permanentBlock:t.permanent_block,lastAttempt:t.last_attempt}}async function Gt(){const t=await L("ipc_security_ip_blocklist_list");return!Ot(t)||!t.data?.blocked_ips?[]:t.data.blocked_ips.map(Kt)}async function Yt(t){await L("ipc_security_ip_blocklist_unblock",{ip:t})}async function Xt(){await L("ipc_security_ip_blocklist_clear")}function Qt(t){if(!t||typeof t!="object")return!1;const s=t;return typeof s.version=="string"&&s.data!==null&&typeof s.data=="object"&&"whitelisted_ips"in s.data&&Array.isArray(s.data.whitelisted_ips)}function Zt(t){return{ip:t.ip,addedAt:t.added_at}}async function es(){const t=await L("ipc_security_ip_whitelist_list");return!Qt(t)||!t.data?.whitelisted_ips?[]:t.data.whitelisted_ips.map(Zt)}async function ts(t){await L("ipc_security_ip_whitelist_add",{ip:t})}async function ss(t){await L("ipc_security_ip_whitelist_remove",{ip:t})}const rs=()=>{const[t,s]=a.useState([]),[r,n]=a.useState(!0),[l,m]=a.useState(null),[d,g]=a.useState(""),[f,y]=a.useState(""),[j,b]=a.useState(""),[P,S]=a.useState(1),[N]=a.useState(50),T=a.useMemo(()=>F({defaultMessage:"監査ログの取得に失敗しました",showStderr:!0}),[]),_=a.useCallback(async()=>{n(!0),m(null);try{const i={eventType:d.trim()||void 0,severity:f.trim()||void 0,ip:j.trim()||void 0,limit:N,offset:(P-1)*N},w=await Bt(i);s(w)}catch(i){const w=T(i);w.shouldShow&&m(w.message)}finally{n(!1)}},[d,f,j,P,N,T]);a.useEffect(()=>{_()},[_]);const E=()=>{S(1),_()},p=()=>{g(""),y(""),b(""),S(1)},c=i=>{if(!i)return"";switch(i.toLowerCase()){case"critical":return"severity-critical";case"high":return"severity-high";case"medium":return"severity-medium";case"low":return"severity-low";default:return""}},u=i=>i>=200&&i<300?"status-success":i>=400&&i<500?"status-client-error":i>=500?"status-server-error":"status-info",o=()=>{const i=["ID","Request ID","Endpoint","Status","Severity","IP","Event Type","Created At"],w=t.map(D=>[D.id.toString(),D.requestId,D.endpoint,D.status.toString(),D.severity||"",D.ip||"",D.eventType||"",D.createdAt]),k=[i.join(","),...w.map(D=>D.map(K=>`"${K}"`).join(","))].join(`
`),h=new Blob([k],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),A=URL.createObjectURL(h);x.href=A,x.download=`audit-logs-${new Date().toISOString()}.csv`,x.click(),setTimeout(()=>URL.revokeObjectURL(A),100)},C=()=>{const i=JSON.stringify(t,null,2),w=new Blob([i],{type:"application/json"}),k=document.createElement("a"),h=URL.createObjectURL(w);k.href=h,k.download=`audit-logs-${new Date().toISOString()}.json`,k.click(),setTimeout(()=>URL.revokeObjectURL(h),100)};return r&&t.length===0?e.jsx(R,{size:"medium",message:"読み込み中..."}):e.jsxs("div",{className:"audit-logs-view",children:[e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"event-type-filter",children:"イベントタイプ:"}),e.jsx("input",{id:"event-type-filter",type:"text",className:"form-input",value:d,onChange:i=>g(i.target.value),placeholder:"例: auth_failure, intrusion"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"severity-filter",children:"重要度:"}),e.jsxs("select",{id:"severity-filter",className:"form-select",value:f,onChange:i=>y(i.target.value),children:[e.jsx("option",{value:"",children:"すべて"}),e.jsx("option",{value:"low",children:"低"}),e.jsx("option",{value:"medium",children:"中"}),e.jsx("option",{value:"high",children:"高"}),e.jsx("option",{value:"critical",children:"緊急"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"ip-filter",children:"IPアドレス:"}),e.jsx("input",{id:"ip-filter",type:"text",className:"form-input",value:j,onChange:i=>b(i.target.value),placeholder:"例: 192.168.1.1"})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"button-primary",onClick:E,children:"フィルター適用"}),e.jsx("button",{className:"button-secondary",onClick:p,children:"クリア"})]})]}),e.jsxs("div",{className:"page-actions",children:[e.jsx("button",{className:"button-primary",onClick:_,children:"更新"}),e.jsx("button",{className:"button-secondary",onClick:o,children:"CSVエクスポート"}),e.jsx("button",{className:"button-secondary",onClick:C,children:"JSONエクスポート"})]}),l&&e.jsx(O,{message:l,onDismiss:()=>m(null)}),e.jsx("div",{className:"audit-logs-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Request ID"}),e.jsx("th",{children:"エンドポイント"}),e.jsx("th",{children:"ステータス"}),e.jsx("th",{children:"重要度"}),e.jsx("th",{children:"IPアドレス"}),e.jsx("th",{children:"イベントタイプ"}),e.jsx("th",{children:"作成日時"})]})}),e.jsx("tbody",{children:t.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.id}),e.jsx("td",{children:i.requestId}),e.jsx("td",{children:i.endpoint}),e.jsx("td",{className:u(i.status),children:i.status}),e.jsx("td",{className:c(i.severity),children:i.severity||"-"}),e.jsx("td",{children:i.ip||"-"}),e.jsx("td",{children:i.eventType||"-"}),e.jsx("td",{children:H(i.createdAt)})]},i.id))})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"button-secondary",onClick:()=>S(i=>Math.max(1,i-1)),disabled:P===1,children:"前へ"}),e.jsxs("span",{children:["ページ ",P]}),e.jsx("button",{className:"button-secondary",onClick:()=>S(i=>i+1),disabled:t.length<N,children:"次へ"})]})]})},as=()=>{const[t,s]=a.useState([]),[r,n]=a.useState(!0),[l,m]=a.useState(null),[d,g]=a.useState(""),[f,y]=a.useState(""),[j,b]=a.useState(1),[P]=a.useState(50),S=a.useMemo(()=>F({defaultMessage:"侵入検知イベントの取得に失敗しました",showStderr:!0}),[]),N=a.useCallback(async()=>{n(!0),m(null);try{const u={ip:d.trim()||void 0,minScore:f?(()=>{const C=parseInt(f,10);return isNaN(C)?void 0:C})():void 0,limit:P,offset:(j-1)*P},o=await Jt(u);s(o)}catch(u){const o=S(u);o.shouldShow&&m(o.message)}finally{n(!1)}},[d,f,j,P,S]);a.useEffect(()=>{N()},[N]);const T=()=>{b(1),N()},_=()=>{g(""),y(""),b(1)},E=u=>u>=100?"score-critical":u>=50?"score-high":u>=20?"score-medium":"score-low",p=()=>{const u=["ID","IP","Pattern","Score","Request Path","Method","User Agent","Created At"],o=t.map(h=>[h.id,h.ip,h.pattern,h.score.toString(),h.requestPath||"",h.method||"",h.userAgent||"",h.createdAt]),C=[u.join(","),...o.map(h=>h.map(x=>`"${x}"`).join(","))].join(`
`),i=new Blob([C],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a"),k=URL.createObjectURL(i);w.href=k,w.download=`intrusion-events-${new Date().toISOString()}.csv`,w.click(),setTimeout(()=>URL.revokeObjectURL(k),100)},c=()=>{const u=JSON.stringify(t,null,2),o=new Blob([u],{type:"application/json"}),C=document.createElement("a"),i=URL.createObjectURL(o);C.href=i,C.download=`intrusion-events-${new Date().toISOString()}.json`,C.click(),setTimeout(()=>URL.revokeObjectURL(i),100)};return r&&t.length===0?e.jsx(R,{size:"medium",message:"読み込み中..."}):e.jsxs("div",{className:"intrusion-events-view",children:[e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"ip-filter",children:"IPアドレス:"}),e.jsx("input",{id:"ip-filter",type:"text",className:"form-input",value:d,onChange:u=>g(u.target.value),placeholder:"例: 192.168.1.1"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"min-score-filter",children:"最小スコア:"}),e.jsx("input",{id:"min-score-filter",type:"number",className:"form-input",value:f,onChange:u=>y(u.target.value),placeholder:"例: 50"})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"button-primary",onClick:T,children:"フィルター適用"}),e.jsx("button",{className:"button-secondary",onClick:_,children:"クリア"})]})]}),e.jsxs("div",{className:"page-actions",children:[e.jsx("button",{className:"button-primary",onClick:N,children:"更新"}),e.jsx("button",{className:"button-secondary",onClick:p,children:"CSVエクスポート"}),e.jsx("button",{className:"button-secondary",onClick:c,children:"JSONエクスポート"})]}),l&&e.jsx(O,{message:l,onDismiss:()=>m(null)}),e.jsx("div",{className:"intrusion-events-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"IPアドレス"}),e.jsx("th",{children:"パターン"}),e.jsx("th",{children:"スコア"}),e.jsx("th",{children:"リクエストパス"}),e.jsx("th",{children:"メソッド"}),e.jsx("th",{children:"User Agent"}),e.jsx("th",{children:"作成日時"})]})}),e.jsx("tbody",{children:t.map(u=>e.jsxs("tr",{children:[e.jsx("td",{children:u.id}),e.jsx("td",{children:u.ip}),e.jsx("td",{children:u.pattern}),e.jsx("td",{className:E(u.score),children:u.score}),e.jsx("td",{children:u.requestPath||"-"}),e.jsx("td",{children:u.method||"-"}),e.jsx("td",{children:u.userAgent||"-"}),e.jsx("td",{children:H(u.createdAt)})]},u.id))})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"button-secondary",onClick:()=>b(u=>Math.max(1,u-1)),disabled:j===1,children:"前へ"}),e.jsxs("span",{children:["ページ ",j]}),e.jsx("button",{className:"button-secondary",onClick:()=>b(u=>u+1),disabled:t.length<P,children:"次へ"})]})]})},ns=()=>{const[t,s]=a.useState([]),[r,n]=a.useState(!0),[l,m]=a.useState(null),[d,g]=a.useState(""),[f,y]=a.useState(""),[j,b]=a.useState(1),[P]=a.useState(50),S=a.useMemo(()=>F({defaultMessage:"異常検知イベントの取得に失敗しました",showStderr:!0}),[]),N=a.useCallback(async()=>{n(!0),m(null);try{const o={ip:d.trim()||void 0,anomalyType:f.trim()||void 0,limit:P,offset:(j-1)*P},C=await Vt(o);s(C)}catch(o){const C=S(o);C.shouldShow&&m(C.message)}finally{n(!1)}},[d,f,j,P,S]);a.useEffect(()=>{N()},[N]);const T=()=>{b(1),N()},_=()=>{g(""),y(""),b(1)},E=o=>o>=200?"score-critical":o>=100?"score-high":o>=50?"score-medium":"score-low",p=o=>({high_request_rate_1s:"高リクエストレート (1秒)",high_request_rate_1m:"高リクエストレート (1分)",large_request_body:"大きなリクエストボディ",long_request_duration:"長時間リクエスト",non_existent_endpoint_access:"存在しないエンドポイントアクセス",repeated_request_pattern:"繰り返しリクエストパターン"})[o]||o,c=()=>{const o=["ID","IP","Anomaly Type","Score","Details","Created At"],C=t.map(x=>[x.id,x.ip,x.anomalyType,x.score.toString(),x.details||"",x.createdAt]),i=[o.join(","),...C.map(x=>x.map(A=>`"${A}"`).join(","))].join(`
`),w=new Blob([i],{type:"text/csv;charset=utf-8;"}),k=document.createElement("a"),h=URL.createObjectURL(w);k.href=h,k.download=`anomaly-events-${new Date().toISOString()}.csv`,k.click(),setTimeout(()=>URL.revokeObjectURL(h),100)},u=()=>{const o=JSON.stringify(t,null,2),C=new Blob([o],{type:"application/json"}),i=document.createElement("a"),w=URL.createObjectURL(C);i.href=w,i.download=`anomaly-events-${new Date().toISOString()}.json`,i.click(),setTimeout(()=>URL.revokeObjectURL(w),100)};return r&&t.length===0?e.jsx(R,{size:"medium",message:"読み込み中..."}):e.jsxs("div",{className:"anomaly-events-view",children:[e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"ip-filter",children:"IPアドレス:"}),e.jsx("input",{id:"ip-filter",type:"text",className:"form-input",value:d,onChange:o=>g(o.target.value),placeholder:"例: 192.168.1.1"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"anomaly-type-filter",children:"異常タイプ:"}),e.jsx("input",{id:"anomaly-type-filter",type:"text",className:"form-input",value:f,onChange:o=>y(o.target.value),placeholder:"例: high_request_rate_1s"})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"button-primary",onClick:T,children:"フィルター適用"}),e.jsx("button",{className:"button-secondary",onClick:_,children:"クリア"})]})]}),e.jsxs("div",{className:"page-actions",children:[e.jsx("button",{className:"button-primary",onClick:N,children:"更新"}),e.jsx("button",{className:"button-secondary",onClick:c,children:"CSVエクスポート"}),e.jsx("button",{className:"button-secondary",onClick:u,children:"JSONエクスポート"})]}),l&&e.jsx(O,{message:l,onDismiss:()=>m(null)}),e.jsx("div",{className:"anomaly-events-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"IPアドレス"}),e.jsx("th",{children:"異常タイプ"}),e.jsx("th",{children:"スコア"}),e.jsx("th",{children:"詳細"}),e.jsx("th",{children:"作成日時"})]})}),e.jsx("tbody",{children:t.map(o=>e.jsxs("tr",{children:[e.jsx("td",{children:o.id}),e.jsx("td",{children:o.ip}),e.jsx("td",{children:p(o.anomalyType)}),e.jsx("td",{className:E(o.score),children:o.score}),e.jsx("td",{children:o.details||"-"}),e.jsx("td",{children:H(o.createdAt)})]},o.id))})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"button-secondary",onClick:()=>b(o=>Math.max(1,o-1)),disabled:j===1,children:"前へ"}),e.jsxs("span",{children:["ページ ",j]}),e.jsx("button",{className:"button-secondary",onClick:()=>b(o=>o+1),disabled:t.length<P,children:"次へ"})]})]})},ls=()=>{const{t}=U(),[s,r]=a.useState("audit");return e.jsxs("div",{className:"security-events",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:t("security.title")})}),e.jsxs("div",{className:"tabs",children:[e.jsx("button",{className:`tab ${s==="audit"?"active":""}`,onClick:()=>r("audit"),children:t("security.auditLogs")}),e.jsx("button",{className:`tab ${s==="intrusion"?"active":""}`,onClick:()=>r("intrusion"),children:t("security.intrusionDetection")}),e.jsx("button",{className:`tab ${s==="anomaly"?"active":""}`,onClick:()=>r("anomaly"),children:t("security.anomalyDetection")})]}),e.jsxs("div",{className:"tab-content",children:[s==="audit"&&e.jsx(rs,{}),s==="intrusion"&&e.jsx(as,{}),s==="anomaly"&&e.jsx(ns,{})]})]})},ie=W.memo(({message:t,onConfirm:s,onCancel:r,confirmText:n="確認",cancelText:l="キャンセル",danger:m=!1})=>{const d=g=>{g.key==="Escape"?r():g.key==="Enter"&&g.target===g.currentTarget&&s()};return a.useEffect(()=>{const g=f=>{f.key==="Escape"&&r()};return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[r]),e.jsx("div",{className:"confirm-dialog-overlay",onClick:r,role:"dialog","aria-modal":"true","aria-labelledby":"confirm-dialog-message",children:e.jsxs("div",{className:"confirm-dialog",onClick:g=>g.stopPropagation(),onKeyDown:d,tabIndex:-1,children:[e.jsx("div",{className:"confirm-dialog-content",children:e.jsx("p",{id:"confirm-dialog-message",children:t})}),e.jsxs("div",{className:"confirm-dialog-actions",children:[e.jsx("button",{className:`button-secondary ${m?"button-danger":""}`,onClick:r,autoFocus:!0,children:l}),e.jsx("button",{className:`button-primary ${m?"button-danger":""}`,onClick:s,children:n})]})]})})});ie.displayName="ConfirmDialog";const is=()=>{const{t}=U(),[s,r]=a.useState([]),[n,l]=a.useState(!0),[m,d]=a.useState(null),[g,f]=a.useState(null),[y,j]=a.useState(null),b=a.useMemo(()=>F({defaultMessage:t("security.fetchError")}),[t]),P=a.useMemo(()=>F({defaultMessage:t("security.unblockError")}),[t]),S=a.useMemo(()=>F({defaultMessage:t("security.clearTemporaryError")}),[t]),N=a.useCallback(async()=>{l(!0),d(null);try{const c=await Gt();r(c)}catch(c){const u=b(c);u.shouldShow&&d(u.message)}finally{l(!1)}},[b]);a.useEffect(()=>{N()},[N]);const T=a.useCallback(async c=>{j({message:t("security.unblockConfirm",{ip:c}),onConfirm:async()=>{j(null),d(null),f(null);try{await Yt(c),f(t("security.unblockSuccess",{ip:c})),await N()}catch(u){const o=P(u);o.shouldShow&&d(o.message)}}})},[N,P,t]),_=a.useCallback(()=>{j({message:t("security.clearTemporaryConfirm"),onConfirm:async()=>{j(null),d(null),f(null);try{await Xt(),f(t("security.clearTemporarySuccess")),await N()}catch(c){const u=S(c);u.shouldShow&&d(u.message)}}})},[N,S,t]),E=a.useMemo(()=>s.filter(c=>c.permanentBlock),[s]),p=a.useMemo(()=>s.filter(c=>!c.permanentBlock),[s]);return n?e.jsx("div",{className:"ip-blocklist-management",children:e.jsx(R,{size:"medium",message:"読み込み中..."})}):e.jsxs("div",{className:"ip-blocklist-management",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:t("security.ipBlocklistManagement")}),e.jsxs("div",{className:"page-actions",children:[p.length>0&&e.jsx("button",{className:"button-secondary",onClick:_,children:t("security.clearAllTemporary")}),e.jsx("button",{className:"button-primary",onClick:N,children:t("security.refresh")})]})]}),m&&e.jsx(O,{message:m,onDismiss:()=>d(null)}),g&&e.jsx(z,{message:g,onDismiss:()=>f(null),autoDismiss:B.MESSAGE_AUTO_DISMISS_MS}),y&&e.jsx(ie,{message:y.message,onConfirm:y.onConfirm,onCancel:()=>j(null),danger:y.danger}),e.jsxs("div",{className:"blocklist-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsxs("span",{className:"summary-label",children:[t("security.totalBlocks"),":"]}),e.jsx("span",{className:"summary-value",children:s.length})]}),e.jsxs("div",{className:"summary-item",children:[e.jsxs("span",{className:"summary-label",children:[t("security.permanentBlocks"),":"]}),e.jsx("span",{className:"summary-value",children:E.length})]}),e.jsxs("div",{className:"summary-item",children:[e.jsxs("span",{className:"summary-label",children:[t("security.temporaryBlocks"),":"]}),e.jsx("span",{className:"summary-value",children:p.length})]})]}),s.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:t("security.noBlockedIps")})}):e.jsx("div",{className:"blocklist-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("security.ipAddress")}),e.jsx("th",{children:t("security.failureCount")}),e.jsx("th",{children:t("security.firstFailureAt")}),e.jsx("th",{children:t("security.blockedUntil")}),e.jsx("th",{children:t("security.lastAttempt")}),e.jsx("th",{children:t("security.type")}),e.jsx("th",{children:t("common.actions")})]})}),e.jsx("tbody",{children:s.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:c.ip})}),e.jsx("td",{children:c.failureCount}),e.jsx("td",{children:H(c.firstFailureAt)}),e.jsx("td",{children:c.blockedUntil?H(c.blockedUntil):t("security.permanent")}),e.jsx("td",{children:H(c.lastAttempt)}),e.jsx("td",{children:e.jsx("span",{className:`block-type ${c.permanentBlock?"permanent":"temporary"}`,children:c.permanentBlock?t("security.permanent"):t("security.temporary")})}),e.jsx("td",{children:e.jsx("button",{className:"button-danger-small",onClick:()=>T(c.ip),disabled:c.permanentBlock,title:c.permanentBlock?t("security.cannotUnblockPermanent"):t("security.unblock"),children:t("security.unblock")})})]},c.ip))})]})})]})},os=()=>{const{t}=U(),[s,r]=a.useState([]),[n,l]=a.useState(!0),[m,d]=a.useState(null),[g,f]=a.useState(null),[y,j]=a.useState(""),[b,P]=a.useState(!1),[S,N]=a.useState(null),T=a.useCallback(i=>F({defaultMessage:t("security.fetchError")||"Failed to fetch whitelisted IPs"})(i),[t]),_=a.useCallback(i=>F({defaultMessage:t("security.addWhitelistError")||"Failed to add IP to whitelist"})(i),[t]),E=a.useCallback(i=>F({defaultMessage:t("security.removeWhitelistError")||"Failed to remove IP from whitelist"})(i),[t]),p=a.useCallback(async()=>{l(!0),d(null);try{const i=await es();r(i)}catch(i){const w=T(i);w.shouldShow&&d(w.message)}finally{l(!1)}},[T]);a.useEffect(()=>{p()},[p]);const c=a.useCallback(i=>{const w=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,k=/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::1$|^::$|^(?:[0-9a-fA-F]{1,4}:)*::(?:[0-9a-fA-F]{1,4}:)*[0-9a-fA-F]{1,4}$/;return w.test(i)||k.test(i)},[]),u=a.useCallback(i=>{const w=i.trim();if(!w)return!1;if(w.includes("/")){const[k,h]=w.split("/"),x=parseInt(h,10);return isNaN(x)||x<0||x>128?!1:c(k)}return c(w)},[c]),o=a.useCallback(async()=>{const i=y.trim();if(!i){d(t("security.ipRequired")||"IP address or CIDR is required");return}if(!u(i)){d(t("security.invalidIpFormat")||"Invalid IP address or CIDR format. Please enter a valid IPv4/IPv6 address or CIDR notation (e.g., 192.168.1.0/24)");return}P(!0),d(null),f(null);try{await ts(i),f(t("security.addWhitelistSuccess",{ip:i})||`IP ${i} added to whitelist successfully`),j(""),await p()}catch(w){const k=_(w);k.shouldShow&&d(k.message)}finally{P(!1)}},[y,p,_,t,u]),C=a.useCallback(i=>{N({message:t("security.removeWhitelistConfirm",{ip:i})||`Remove ${i} from whitelist?`,onConfirm:async()=>{N(null),d(null),f(null);try{await ss(i),f(t("security.removeWhitelistSuccess",{ip:i})||`IP ${i} removed from whitelist successfully`),await p()}catch(w){const k=E(w);k.shouldShow&&d(k.message)}},danger:!0})},[p,E,t]);return n&&s.length===0?e.jsx("div",{className:"ip-whitelist-management",children:e.jsx(R,{size:"medium",message:t("common.loading")||"読み込み中..."})}):e.jsxs("div",{className:"ip-whitelist-management",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:t("security.ipWhitelistManagement")||"IP Whitelist Management"}),e.jsx("div",{className:"page-actions",children:e.jsx("button",{className:"button-primary",onClick:p,children:t("security.refresh")||"Refresh"})})]}),m&&e.jsx(O,{message:m,onDismiss:()=>d(null)}),g&&e.jsx(z,{message:g,onDismiss:()=>f(null),autoDismiss:B.MESSAGE_AUTO_DISMISS_MS}),S&&e.jsx(ie,{message:S.message,onConfirm:S.onConfirm,onCancel:()=>N(null),danger:S.danger}),e.jsx("div",{className:"whitelist-summary",children:e.jsxs("div",{className:"summary-item",children:[e.jsxs("span",{className:"summary-label",children:[t("security.totalWhitelisted")||"Total Whitelisted",":"]}),e.jsx("span",{className:"summary-value",children:s.length})]})}),e.jsxs("div",{className:"add-ip-section",children:[e.jsx("h2",{children:t("security.addIpToWhitelist")||"Add IP to Whitelist"}),e.jsxs("div",{className:"add-ip-form",children:[e.jsx("input",{type:"text",value:y,onChange:i=>j(i.target.value),placeholder:t("security.ipOrCidrPlaceholder")||"e.g., 192.168.1.0/24 or 10.0.0.1",className:"ip-input",disabled:b,onKeyPress:i=>{i.key==="Enter"&&o()}}),e.jsx("button",{className:"button-primary",onClick:o,disabled:b||!y.trim(),children:b?t("common.adding")||"Adding...":t("security.add")||"Add"})]}),e.jsx("small",{className:"form-hint",children:t("security.ipWhitelistHint")||"Enter an IP address (IPv4 or IPv6) or CIDR notation (e.g., 192.168.1.0/24)"})]}),s.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:t("security.noWhitelistedIps")||"No IPs in whitelist"})}):e.jsx("div",{className:"whitelist-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("security.ipAddress")||"IP Address / CIDR"}),e.jsx("th",{children:t("security.addedAt")||"Added At"}),e.jsx("th",{children:t("common.actions")||"Actions"})]})}),e.jsx("tbody",{children:s.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:i.ip})}),e.jsx("td",{children:H(i.addedAt)}),e.jsx("td",{children:e.jsx("button",{className:"button-danger-small",onClick:()=>C(i.ip),disabled:n,children:t("security.remove")||"Remove"})})]},i.ip))})]})})]})},cs=()=>{const{locale:t,setLocale:s,t:r}=U(),{theme:n,setTheme:l,toggleTheme:m}=ut(),[d,g]=a.useState(!1),[f,y]=a.useState(null),[j,b]=a.useState(null),[P,S]=a.useState(t);a.useEffect(()=>{S(t)},[t]);const N=async _=>{g(!0),y(null),b(null);try{await s(_),S(_);const E=r(_==="ja"?"settings.japanese":"settings.english");b(r("messages.languageChanged",{locale:E})),setTimeout(()=>b(null),3e3)}catch(E){const p=E instanceof Error?E.message:String(E);y(r("errors.generic")+": "+p)}finally{g(!1)}},T=async _=>{g(!0),y(null),b(null);try{await l(_),b(`Theme changed to ${_}`),setTimeout(()=>b(null),3e3)}catch(E){const p=E instanceof Error?E.message:String(E);y("Failed to change theme: "+p)}finally{g(!1)}};return e.jsxs("div",{className:"settings-page",children:[e.jsx("h1",{children:r("settings.title")}),f&&e.jsx(O,{message:f,onDismiss:()=>y(null)}),j&&e.jsx(z,{message:j,onDismiss:()=>b(null)}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:r("settings.language")}),e.jsxs("div",{className:"settings-field",children:[e.jsx("label",{htmlFor:"language-select",children:r("settings.displayLanguage")}),e.jsxs("select",{id:"language-select",value:P,onChange:_=>N(_.target.value),disabled:d,"aria-label":r("settings.displayLanguage"),children:[e.jsx("option",{value:"ja",children:r("settings.japanese")}),e.jsx("option",{value:"en",children:r("settings.english")})]}),d&&e.jsx(R,{size:"small"})]}),e.jsx("p",{className:"settings-hint",children:r("settings.languageHint",{current:r(P==="ja"?"settings.japanese":"settings.english")})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"Theme"}),e.jsxs("div",{className:"settings-field",children:[e.jsx("label",{htmlFor:"theme-select",children:"Appearance"}),e.jsxs("select",{id:"theme-select",value:n,onChange:_=>T(_.target.value),disabled:d,"aria-label":"Theme selection",children:[e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"dark",children:"Dark"})]}),d&&e.jsx(R,{size:"small"})]}),e.jsxs("p",{className:"settings-hint",children:["Current theme: ",n==="light"?"Light":"Dark"]})]})]})},ds=()=>{const{t}=U(),[s,r]=a.useState(!1),[n,l]=a.useState(null),[m,d]=a.useState(null),[g,f]=a.useState(""),[y,j]=a.useState([8080,8081]),[b,P]=a.useState([]),[S,N]=a.useState(""),[T,_]=a.useState(""),[E,p]=a.useState(""),[c,u]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const x=await L("get_platform"),A=typeof x=="string"?JSON.parse(x):x,D=A?.os||A||x;f(String(D).toLowerCase())}catch(x){q.error("Failed to detect OS:",x),navigator.platform.toLowerCase().includes("win")?f("windows"):navigator.platform.toLowerCase().includes("mac")?f("macos"):f("linux")}})()},[]);const o=async()=>{r(!0),l(null),d(null);try{const x=await L("system_firewall_preview",{os:g,ports:y,ip_whitelist:b});N(x.script),_(x.shell),p(x.display_name)}catch(h){const x=h instanceof Error?h.message:String(h);l(`Failed to generate firewall script: ${x}`)}finally{r(!1)}},C=async()=>{if(!S||!T){l("Please generate a firewall script preview first");return}r(!0),l(null),d(null);try{const x=await L("system_firewall_apply",{script:S,shell:T});x.exit_code===0?(d("Firewall rules applied successfully"),u(!0)):l(`Firewall application failed (exit code: ${x.exit_code})
${x.stderr}`)}catch(h){const x=h instanceof Error?h.message:String(h);l(`Failed to apply firewall script: ${x}`)}finally{r(!1)}},i=async()=>{r(!0),l(null),d(null);try{const h=await L("system_firewall_rollback",{os:g});h.exit_code===0?(d("Firewall rules rolled back successfully"),u(!1)):l(`Firewall rollback failed (exit code: ${h.exit_code})
${h.stderr}`)}catch(h){const x=h instanceof Error?h.message:String(h);l(`Failed to rollback firewall script: ${x}`)}finally{r(!1)}},w=()=>{navigator.clipboard.writeText(S),d("Script copied to clipboard"),setTimeout(()=>d(null),2e3)},k=()=>{const h=new Blob([S],{type:"text/plain"}),x=URL.createObjectURL(h),A=document.createElement("a");A.href=x,A.download=`firewall-script-${Date.now()}.${T==="powershell"?"ps1":"sh"}`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(x),d("Script saved to file"),setTimeout(()=>d(null),2e3)};return e.jsxs("div",{className:"setup-wizard-page",children:[e.jsx("h1",{children:"Setup Wizard - Firewall Configuration"}),n&&e.jsx(O,{message:n,onDismiss:()=>l(null)}),m&&e.jsx(z,{message:m,onDismiss:()=>d(null)}),e.jsxs("div",{className:"firewall-config-section",children:[e.jsx("h2",{children:"Configuration"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"os-input",children:"Operating System:"}),e.jsx("input",{id:"os-input",type:"text",value:g,readOnly:!0,className:"form-input","aria-label":"Operating System (read-only)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ports-input",children:"Ports (comma-separated):"}),e.jsx("input",{id:"ports-input",type:"text",value:y.join(", "),onChange:h=>{const x=h.target.value.split(",").map(A=>parseInt(A.trim(),10)).filter(A=>!isNaN(A));j(x)},className:"form-input",placeholder:"8080, 8081","aria-label":"Ports (comma-separated)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ip-whitelist-input",children:"IP Whitelist (comma-separated, optional):"}),e.jsx("input",{id:"ip-whitelist-input",type:"text",value:b.join(", "),onChange:h=>{const x=h.target.value.split(",").map(A=>A.trim()).filter(A=>A.length>0);P(x)},className:"form-input",placeholder:"203.0.113.0/24, 2001:db8::/48","aria-label":"IP Whitelist (comma-separated, optional)"})]}),e.jsx("button",{onClick:o,disabled:s||y.length===0,className:"btn btn-primary",children:"Generate Script Preview"})]}),S&&e.jsxs("div",{className:"firewall-preview-section",children:[e.jsx("h2",{children:"Script Preview"}),e.jsx("div",{className:"script-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Shell:"})," ",E]})}),e.jsx("div",{className:"script-preview",children:e.jsx("pre",{children:S})}),e.jsxs("div",{className:"script-actions",children:[e.jsx("button",{onClick:w,className:"btn btn-secondary",children:"Copy Script"}),e.jsx("button",{onClick:k,className:"btn btn-secondary",children:"Save Script"}),e.jsx("button",{onClick:C,disabled:s||c,className:"btn btn-primary",children:"Apply Script (Requires Admin)"}),c&&e.jsx("button",{onClick:i,disabled:s,className:"btn btn-danger",children:"Rollback"})]})]}),s&&e.jsx(R,{})]})};async function us(t){try{const s=t?{engine:t.engine,model:t.model}:void 0,r=await L("ipc_model_profiles_list",s?{payload:s}:void 0);return r.data?.profiles?r.data.profiles:[]}catch(s){throw q.error("Failed to fetch model profiles:",s),new Error(s instanceof Error?s.message:"Failed to fetch model profiles")}}async function ms(t){try{const s=JSON.stringify(t.parameters),r=await L("ipc_model_profiles_save",{payload:{engine:t.engineId,model:t.modelId,label:t.label,params_json:s}});if(r.data?.profile)return r.data.profile;throw new Error("Invalid response from save model profile")}catch(s){throw q.error("Failed to save model profile:",s),new Error(s instanceof Error?s.message:"Failed to save model profile")}}async function hs(t){try{await L("ipc_model_profiles_delete",{payload:{id:t}})}catch(s){throw q.error("Failed to delete model profile:",s),new Error(s instanceof Error?s.message:"Failed to delete model profile")}}const ps=({engineId:t,modelId:s,parameters:r,onChange:n,onError:l})=>{const{t:m}=U(),[d,g]=a.useState(!1),[f,y]=a.useState(null),[j,b]=a.useState(null),[P,S]=a.useState(r);a.useEffect(()=>{S(r)},[r]);const N=a.useCallback(async()=>{if(t){g(!0),y(null);try{const p=await L("ipc_detect_engines",{fresh:!1});let c=null;if(p&&"data"in p&&p.data){const u=p.data.engines;if(Array.isArray(u)){const o=u.find(C=>C.id===t);o&&"capabilities"in o&&(c={id:o.id,name:o.name||o.id,parameters:gs(o.capabilities)})}}c||(c=ye(t)),b(c)}catch(p){const c=p instanceof Error?p.message:"Failed to load engine capabilities";y(c),l&&l(c),b(ye(t))}finally{g(!1)}}},[t,l]);a.useEffect(()=>{N()},[N]);const T=(p,c)=>{const u={...P,[p]:c};S(u),n(u)},_=(p,c,u)=>{const o=`param-${p}`,C=u!==void 0?u:c.default;switch(c.type){case"boolean":return e.jsxs("div",{className:"parameter-field",children:[e.jsxs("label",{htmlFor:o,className:"parameter-label",children:[p,c.required&&e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:o,type:"checkbox",checked:C===!0,onChange:i=>T(p,i.target.checked),className:"parameter-input parameter-checkbox"}),c.description&&e.jsx("small",{className:"parameter-hint",children:c.description})]},p);case"number":return e.jsxs("div",{className:"parameter-field",children:[e.jsxs("label",{htmlFor:o,className:"parameter-label",children:[p,c.required&&e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:o,type:"number",value:C,onChange:i=>T(p,parseFloat(i.target.value)||0),min:c.min,max:c.max,step:"any",className:"parameter-input parameter-number"}),c.description&&e.jsx("small",{className:"parameter-hint",children:c.description})]},p);case"string":return c.enum&&c.enum.length>0?e.jsxs("div",{className:"parameter-field",children:[e.jsxs("label",{htmlFor:o,className:"parameter-label",children:[p,c.required&&e.jsx("span",{className:"required",children:"*"})]}),e.jsx("select",{id:o,value:C||"",onChange:i=>T(p,i.target.value),className:"parameter-input parameter-select",children:c.enum.map(i=>e.jsx("option",{value:String(i),children:String(i)},String(i)))}),c.description&&e.jsx("small",{className:"parameter-hint",children:c.description})]},p):e.jsxs("div",{className:"parameter-field",children:[e.jsxs("label",{htmlFor:o,className:"parameter-label",children:[p,c.required&&e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:o,type:"text",value:C||"",onChange:i=>T(p,i.target.value),className:"parameter-input parameter-text"}),c.description&&e.jsx("small",{className:"parameter-hint",children:c.description})]},p);case"array":case"object":return e.jsxs("div",{className:"parameter-field",children:[e.jsxs("label",{htmlFor:o,className:"parameter-label",children:[p,c.required&&e.jsx("span",{className:"required",children:"*"})]}),e.jsx("textarea",{id:o,value:JSON.stringify(C,null,2),onChange:i=>{try{const w=JSON.parse(i.target.value);T(p,w)}catch{}},className:"parameter-input parameter-textarea",rows:4}),c.description&&e.jsx("small",{className:"parameter-hint",children:c.description})]},p);default:return null}};if(d)return e.jsx("div",{className:"model-detail-settings",children:e.jsx(R,{message:m("modelProfiles.loadingCapabilities")||"Loading capabilities..."})});if(f&&!j)return e.jsx("div",{className:"model-detail-settings",children:e.jsx(O,{message:f,onDismiss:()=>y(null)})});if(!j||!j.parameters)return e.jsx("div",{className:"model-detail-settings",children:e.jsx("p",{className:"no-capabilities",children:m("modelProfiles.noCapabilities")||"No parameter definitions available for this engine."})});const E=Object.entries(j.parameters);return e.jsxs("div",{className:"model-detail-settings",children:[f&&e.jsx(O,{message:f,onDismiss:()=>y(null)}),e.jsxs("div",{className:"capabilities-header",children:[e.jsxs("h3",{children:[m("modelProfiles.engineParameters")||"Engine Parameters"," (",j.name,")"]}),e.jsx("p",{className:"capabilities-description",children:m("modelProfiles.parametersDescription")||"Configure engine-specific parameters for this model profile."})]}),e.jsx("div",{className:"parameters-form",children:E.length===0?e.jsx("p",{className:"no-parameters",children:m("modelProfiles.noParameters")||"No parameters defined for this engine."}):E.map(([p,c])=>_(p,c,P[p]))})]})};function gs(t){if(!(!t||typeof t!="object"))try{const s=t,r={};for(const[n,l]of Object.entries(s))if(l&&typeof l=="object"){const m=l;r[n]={type:m.type||"string",description:m.description,default:m.default,min:m.min,max:m.max,enum:m.enum,required:m.required}}return Object.keys(r).length>0?r:void 0}catch{return}}function ye(t){const s={temperature:{type:"number",description:"Sampling temperature (0.0 to 2.0)",default:.7,min:0,max:2},max_tokens:{type:"number",description:"Maximum number of tokens to generate",default:512,min:1,max:4096},top_p:{type:"number",description:"Nucleus sampling parameter (0.0 to 1.0)",default:.9,min:0,max:1},top_k:{type:"number",description:"Top-k sampling parameter",default:40,min:1},frequency_penalty:{type:"number",description:"Frequency penalty (-2.0 to 2.0)",default:0,min:-2,max:2},presence_penalty:{type:"number",description:"Presence penalty (-2.0 to 2.0)",default:0,min:-2,max:2}},n={ollama:{num_ctx:{type:"number",description:"Context window size",default:2048,min:512,max:32768},num_predict:{type:"number",description:"Maximum number of tokens to predict",default:-1,min:-1},repeat_penalty:{type:"number",description:"Repeat penalty",default:1.1,min:0}},vllm:{max_model_len:{type:"number",description:"Maximum model length",default:2048,min:512},gpu_memory_utilization:{type:"number",description:"GPU memory utilization (0.0 to 1.0)",default:.9,min:0,max:1}},"lm-studio":{stop:{type:"array",description:"Stop sequences",default:[]},stream:{type:"boolean",description:"Enable streaming",default:!1}}}[t.toLowerCase()]||{},l={...s,...n};return{id:t,name:t,parameters:l}}const ee=`{
  "temperature": 0.7,
  "max_tokens": 512
}`,fs=()=>{const{t}=U(),[s,r]=a.useState([]),[n,l]=a.useState(!0),[m,d]=a.useState(null),[g,f]=a.useState(null),[y,j]=a.useState(""),[b,P]=a.useState(""),[S,N]=a.useState(""),[T,_]=a.useState(""),[E,p]=a.useState(""),[c,u]=a.useState(ee),[o,C]=a.useState(null),[i,w]=a.useState(!1),[k,h]=a.useState(!1),x=a.useCallback(async()=>{l(!0),d(null);try{const v=await us({engine:y.trim()||void 0,model:b.trim()||void 0});r(v)}catch(v){d(v instanceof Error?v.message:t("modelProfiles.fetchError")||"Failed to fetch model profiles")}finally{l(!1)}},[y,b,t]);a.useEffect(()=>{x()},[x]);const A=()=>{N(""),_(""),p(""),u(ee),C(null),w(!1),h(!1)},D=v=>{C(v.id),N(v.engineId),_(v.modelId),p(v.label),u(JSON.stringify(v.parameters,null,2)||ee),w(!0)},K=v=>{u(JSON.stringify(v,null,2))},te=async v=>{if(v.preventDefault(),!S.trim()||!T.trim()||!E.trim()){d(t("modelProfiles.requiredFields")||"Required fields are missing");return}let I;try{I=JSON.parse(c)}catch{d(t("modelProfiles.invalidJson")||"Invalid JSON format. Please enter valid JSON.");return}l(!0),d(null);try{await ms({engineId:S.trim(),modelId:T.trim(),label:E.trim(),parameters:I}),f(o?t("modelProfiles.updateSuccess")||"Model profile updated successfully":t("modelProfiles.createSuccess")||"Model profile created successfully"),setTimeout(()=>f(null),3e3),await x(),A()}catch(V){d(V instanceof Error?V.message:t("modelProfiles.saveError")||"Failed to save model profile")}finally{l(!1)}},se=async v=>{if(window.confirm(t("modelProfiles.deleteConfirm",{label:v.label})||`Delete profile "${v.label}"? This action cannot be undone.`)){l(!0),d(null);try{await hs(v.id),f(t("modelProfiles.deleteSuccess")||"Model profile deleted successfully"),setTimeout(()=>f(null),3e3),o===v.id&&A(),await x()}catch(V){d(V instanceof Error?V.message:t("modelProfiles.deleteError")||"Failed to delete model profile")}finally{l(!1)}}},M=s.filter(v=>!(y&&!v.engineId.toLowerCase().includes(y.toLowerCase())||b&&!v.modelId.toLowerCase().includes(b.toLowerCase())));return e.jsxs("div",{className:"model-profiles-page",children:[e.jsx("h1",{children:t("modelProfiles.title")||"Model Profiles"}),e.jsx("p",{className:"page-description",children:t("modelProfiles.description")||"Manage model-specific parameter profiles for different engines."}),m&&e.jsx(O,{message:m,onDismiss:()=>d(null)}),g&&e.jsxs("div",{className:"success-message",children:[g,e.jsx("button",{className:"success-dismiss",onClick:()=>f(null),"aria-label":"Close",children:"×"})]}),e.jsxs("div",{className:"model-profiles-content",children:[e.jsxs("div",{className:"model-profiles-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"engine-filter",children:t("modelProfiles.filterByEngine")||"Filter by Engine"}),e.jsx("input",{id:"engine-filter",type:"text",value:y,onChange:v=>j(v.target.value),placeholder:t("modelProfiles.enginePlaceholder")||"e.g., ollama"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"model-filter",children:t("modelProfiles.filterByModel")||"Filter by Model"}),e.jsx("input",{id:"model-filter",type:"text",value:b,onChange:v=>P(v.target.value),placeholder:t("modelProfiles.modelPlaceholder")||"e.g., llama3"})]}),e.jsx("button",{className:"btn-primary",onClick:()=>w(!i),disabled:n,children:i?t("common.cancel")||"Cancel":t("modelProfiles.createNew")||"Create New Profile"})]}),i&&e.jsxs("div",{className:"model-profiles-form",children:[e.jsx("h2",{children:o?t("modelProfiles.editProfile")||"Edit Profile":t("modelProfiles.createProfile")||"Create Profile"}),e.jsxs("form",{onSubmit:te,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"engine-id",children:[t("modelProfiles.engineId")||"Engine ID"," *"]}),e.jsx("input",{id:"engine-id",type:"text",value:S,onChange:v=>N(v.target.value),placeholder:"e.g., ollama",required:!0,disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"model-id",children:[t("modelProfiles.modelId")||"Model ID"," *"]}),e.jsx("input",{id:"model-id",type:"text",value:T,onChange:v=>_(v.target.value),placeholder:"e.g., flm://ollama/llama3",required:!0,disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"label",children:[t("modelProfiles.label")||"Label"," *"]}),e.jsx("input",{id:"label",type:"text",value:E,onChange:v=>p(v.target.value),placeholder:t("modelProfiles.labelPlaceholder")||"Profile name",required:!0,disabled:n})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs("label",{htmlFor:"parameters",children:[t("modelProfiles.parameters")||"Parameters (JSON)"," *"]}),S&&e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>h(!k),disabled:n,style:{fontSize:"0.875rem",padding:"0.25rem 0.75rem"},children:k?t("modelProfiles.hideAdvanced")||"Hide Advanced":t("modelProfiles.showAdvanced")||"Show Advanced Settings"})]}),k&&S&&T?e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx(ps,{engineId:S,modelId:T,parameters:(()=>{try{return JSON.parse(c)}catch{return{}}})(),onChange:K,onError:v=>d(v)})}):null,e.jsx("textarea",{id:"parameters",value:c,onChange:v=>u(v.target.value),rows:k?6:10,required:!0,disabled:n,placeholder:ee}),e.jsx("small",{className:"form-hint",children:t("modelProfiles.parametersHint")||'Enter parameters as JSON. Example: {"temperature": 0.7, "max_tokens": 512}'})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:"small"})," ",t("common.loading")||"Loading..."]}):t("common.save")||"Save"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:A,disabled:n,children:t("common.cancel")||"Cancel"})]})]})]}),e.jsxs("div",{className:"model-profiles-list",children:[e.jsx("h2",{children:t("modelProfiles.profilesList")||"Profiles"}),n&&!i?e.jsx(R,{message:t("common.loading")||"Loading..."}):M.length===0?e.jsx("p",{className:"empty-message",children:t("modelProfiles.noProfiles")||"No profiles found"}):e.jsx("div",{className:"profiles-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("modelProfiles.label")||"Label"}),e.jsx("th",{children:t("modelProfiles.engineId")||"Engine"}),e.jsx("th",{children:t("modelProfiles.modelId")||"Model"}),e.jsx("th",{children:t("modelProfiles.updatedAt")||"Updated"}),e.jsx("th",{children:t("common.actions")||"Actions"})]})}),e.jsx("tbody",{children:M.map(v=>e.jsxs("tr",{children:[e.jsx("td",{children:v.label}),e.jsx("td",{children:v.engineId}),e.jsx("td",{children:v.modelId}),e.jsx("td",{children:H(v.updatedAt)}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-edit",onClick:()=>D(v),disabled:n,"aria-label":t("common.edit")||"Edit",children:t("common.edit")||"Edit"}),e.jsx("button",{className:"btn-delete",onClick:()=>se(v),disabled:n,"aria-label":t("common.delete")||"Delete",children:t("common.delete")||"Delete"})]})})]},v.id))})]})})]})]})]})};async function ys(t){try{const s=t?{engine:t.engine,model:t.model,hours:t.hours||24,limit:t.limit||100}:{hours:24,limit:100},r=await L("ipc_engines_health_history",{payload:s});return r.data?.logs?r.data.logs:[]}catch(s){throw q.error("Failed to fetch engine health history:",s),new Error(s instanceof Error?s.message:"Failed to fetch engine health history")}}const xs=()=>{const{t}=U(),[s,r]=a.useState([]),[n,l]=a.useState(!0),[m,d]=a.useState(null),[g,f]=a.useState("24h"),[y,j]=a.useState(""),[b,P]=a.useState(""),S=a.useMemo(()=>({"24h":24,"7d":168,"30d":720}),[]),N=a.useCallback(async()=>{l(!0),d(null);try{const p=await ys({engine:y.trim()||void 0,model:b.trim()||void 0,hours:S[g],limit:1e3});r(p)}catch(p){d(p instanceof Error?p.message:t("modelComparison.fetchError")||"Failed to fetch health history")}finally{l(!1)}},[y,b,g,t,S]);a.useEffect(()=>{N()},[N]);const T=W.useMemo(()=>{if(s.length===0)return null;const p=s.filter(h=>h.status==="healthy").length,c=s.filter(h=>h.status==="degraded").length,u=s.filter(h=>h.status==="unreachable").length,o=s.length,C=o>0?p/o*100:0,i=s.map(h=>h.latency_ms).filter(h=>h!==null),w=i.length>0?i.reduce((h,x)=>h+x,0)/i.length:null,k=s.reduce((h,x)=>h+x.error_rate,0)/s.length;return{total:o,healthy:p,degraded:c,unreachable:u,successRate:C,avgLatency:w,avgErrorRate:k}},[s]),_=W.useMemo(()=>{const p={};for(const c of s)p[c.engine_id]||(p[c.engine_id]=[]),p[c.engine_id].push(c);return p},[s]),E=W.useMemo(()=>{const p={};for(const c of s)c.model_id&&(p[c.model_id]||(p[c.model_id]=[]),p[c.model_id].push(c));return p},[s]);return e.jsxs("div",{className:"model-comparison-page",children:[e.jsx("h1",{children:t("modelComparison.title")||"Model Comparison & Health History"}),e.jsx("p",{className:"page-description",children:t("modelComparison.description")||"View engine health history and compare model performance over time."}),m&&e.jsx(O,{message:m,onDismiss:()=>d(null)}),e.jsxs("div",{className:"model-comparison-content",children:[e.jsxs("div",{className:"model-comparison-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"time-range",children:t("modelComparison.timeRange")||"Time Range"}),e.jsxs("select",{id:"time-range",value:g,onChange:p=>f(p.target.value),disabled:n,children:[e.jsx("option",{value:"24h",children:t("modelComparison.last24Hours")||"Last 24 Hours"}),e.jsx("option",{value:"7d",children:t("modelComparison.last7Days")||"Last 7 Days"}),e.jsx("option",{value:"30d",children:t("modelComparison.last30Days")||"Last 30 Days"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"engine-filter",children:t("modelComparison.filterByEngine")||"Filter by Engine"}),e.jsx("input",{id:"engine-filter",type:"text",value:y,onChange:p=>j(p.target.value),placeholder:t("modelComparison.enginePlaceholder")||"e.g., ollama",disabled:n})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"model-filter",children:t("modelComparison.filterByModel")||"Filter by Model"}),e.jsx("input",{id:"model-filter",type:"text",value:b,onChange:p=>P(p.target.value),placeholder:t("modelComparison.modelPlaceholder")||"e.g., llama3",disabled:n})]}),e.jsx("button",{className:"btn-primary",onClick:N,disabled:n,children:t("common.refresh")||"Refresh"})]}),n?e.jsx(R,{message:t("common.loading")||"Loading..."}):T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-cards",children:[e.jsxs("div",{className:"summary-card",children:[e.jsx("h3",{children:t("modelComparison.totalChecks")||"Total Checks"}),e.jsx("p",{className:"summary-value",children:T.total})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("h3",{children:t("modelComparison.successRate")||"Success Rate"}),e.jsxs("p",{className:"summary-value",children:[T.successRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("h3",{children:t("modelComparison.avgLatency")||"Avg Latency"}),e.jsx("p",{className:"summary-value",children:T.avgLatency?`${T.avgLatency.toFixed(0)}ms`:t("modelComparison.nA")||"N/A"})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("h3",{children:t("modelComparison.avgErrorRate")||"Avg Error Rate"}),e.jsxs("p",{className:"summary-value",children:[(T.avgErrorRate*100).toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"status-breakdown",children:[e.jsx("h2",{children:t("modelComparison.statusBreakdown")||"Status Breakdown"}),e.jsxs("div",{className:"status-cards",children:[e.jsxs("div",{className:"status-card healthy",children:[e.jsx("h4",{children:t("modelComparison.healthy")||"Healthy"}),e.jsx("p",{children:T.healthy})]}),e.jsxs("div",{className:"status-card degraded",children:[e.jsx("h4",{children:t("modelComparison.degraded")||"Degraded"}),e.jsx("p",{children:T.degraded})]}),e.jsxs("div",{className:"status-card unreachable",children:[e.jsx("h4",{children:t("modelComparison.unreachable")||"Unreachable"}),e.jsx("p",{children:T.unreachable})]})]})]}),e.jsxs("div",{className:"engine-summary",children:[e.jsx("h2",{children:t("modelComparison.engineSummary")||"Engine Summary"}),e.jsx("div",{className:"summary-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("modelComparison.engine")||"Engine"}),e.jsx("th",{children:t("modelComparison.totalChecks")||"Total Checks"}),e.jsx("th",{children:t("modelComparison.healthy")||"Healthy"}),e.jsx("th",{children:t("modelComparison.degraded")||"Degraded"}),e.jsx("th",{children:t("modelComparison.unreachable")||"Unreachable"}),e.jsx("th",{children:t("modelComparison.avgLatency")||"Avg Latency"})]})}),e.jsx("tbody",{children:Object.entries(_).map(([p,c])=>{const u=c.filter(k=>k.status==="healthy").length,o=c.filter(k=>k.status==="degraded").length,C=c.filter(k=>k.status==="unreachable").length,i=c.map(k=>k.latency_ms).filter(k=>k!==null),w=i.length>0?i.reduce((k,h)=>k+h,0)/i.length:null;return e.jsxs("tr",{children:[e.jsx("td",{children:p}),e.jsx("td",{children:c.length}),e.jsx("td",{children:u}),e.jsx("td",{children:o}),e.jsx("td",{children:C}),e.jsx("td",{children:w?`${w.toFixed(0)}ms`:t("modelComparison.nA")||"N/A"})]},p)})})]})})]}),e.jsxs("div",{className:"model-summary",children:[e.jsx("h2",{children:t("modelComparison.modelSummary")||"Model Summary"}),Object.keys(E).length>0?e.jsx("div",{className:"summary-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("modelComparison.model")||"Model"}),e.jsx("th",{children:t("modelComparison.totalChecks")||"Total Checks"}),e.jsx("th",{children:t("modelComparison.healthy")||"Healthy"}),e.jsx("th",{children:t("modelComparison.degraded")||"Degraded"}),e.jsx("th",{children:t("modelComparison.unreachable")||"Unreachable"}),e.jsx("th",{children:t("modelComparison.avgLatency")||"Avg Latency"})]})}),e.jsx("tbody",{children:Object.entries(E).map(([p,c])=>{const u=c.filter(k=>k.status==="healthy").length,o=c.filter(k=>k.status==="degraded").length,C=c.filter(k=>k.status==="unreachable").length,i=c.map(k=>k.latency_ms).filter(k=>k!==null),w=i.length>0?i.reduce((k,h)=>k+h,0)/i.length:null;return e.jsxs("tr",{children:[e.jsx("td",{children:p}),e.jsx("td",{children:c.length}),e.jsx("td",{children:u}),e.jsx("td",{children:o}),e.jsx("td",{children:C}),e.jsx("td",{children:w?`${w.toFixed(0)}ms`:t("modelComparison.nA")||"N/A"})]},p)})})]})}):e.jsx("p",{className:"empty-message",children:t("modelComparison.noModelData")||"No model-specific data available"})]}),e.jsxs("div",{className:"recent-logs",children:[e.jsx("h2",{children:t("modelComparison.recentLogs")||"Recent Logs"}),e.jsx("div",{className:"logs-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("modelComparison.timestamp")||"Timestamp"}),e.jsx("th",{children:t("modelComparison.engine")||"Engine"}),e.jsx("th",{children:t("modelComparison.model")||"Model"}),e.jsx("th",{children:t("modelComparison.status")||"Status"}),e.jsx("th",{children:t("modelComparison.latency")||"Latency"}),e.jsx("th",{children:t("modelComparison.errorRate")||"Error Rate"})]})}),e.jsx("tbody",{children:s.slice(0,50).map(p=>e.jsxs("tr",{children:[e.jsx("td",{children:H(p.created_at)}),e.jsx("td",{children:p.engine_id}),e.jsx("td",{children:p.model_id||"-"}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${p.status}`,children:p.status})}),e.jsx("td",{children:p.latency_ms?`${p.latency_ms}ms`:t("modelComparison.nA")||"N/A"}),e.jsxs("td",{children:[(p.error_rate*100).toFixed(2),"%"]})]},p.id))})]})})]})]}):e.jsx("p",{className:"empty-message",children:t("modelComparison.noData")||"No health history data available"})]})]})},js=({maxNotifications:t=5,defaultDuration:s=5e3})=>{const{t:r}=U(),[n,l]=a.useState([]),m=a.useCallback(g=>{l(f=>f.filter(y=>y.id!==g))},[]),d=a.useCallback(g=>{const f=`notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,y={...g,id:f,timestamp:Date.now(),duration:g.duration??s};l(j=>[y,...j].slice(0,t)),y.duration&&y.duration>0&&setTimeout(()=>{m(f)},y.duration)},[s,t,m]);return a.useEffect(()=>(window.flmNotifications={add:d},()=>{delete window.flmNotifications}),[d]),n.length===0?null:e.jsx("div",{className:"notification-system",role:"region","aria-label":"Notifications",children:n.map(g=>e.jsx("div",{className:`notification notification-${g.severity}`,role:"alert","aria-live":g.severity==="error"?"assertive":"polite",children:e.jsxs("div",{className:"notification-content",children:[e.jsx("span",{className:"notification-message",children:g.message}),e.jsx("button",{className:"notification-dismiss",onClick:()=>m(g.id),"aria-label":r("common.dismiss")||"Dismiss",children:"×"})]})},g.id))})},vs=()=>({addNotification:a.useCallback(s=>{const r=window.flmNotifications;r&&r.add(s)},[])}),bs=()=>{const{t}=U(),{addNotification:s}=vs(),[r,n]=a.useState(!1),[l,m]=a.useState(!1),[d,g]=a.useState(null),[f,y]=a.useState(null),[j,b]=a.useState([]),P=[{value:"intrusion",label:t("security.intrusion")||"Intrusion Detection"},{value:"anomaly",label:t("security.anomaly")||"Anomaly Detection"},{value:"rate_limit",label:t("security.rateLimit")||"Rate Limit Exceeded"},{value:"api_error",label:t("security.apiError")||"API Error"}],S=[{value:"critical",label:t("security.critical")||"Critical"},{value:"high",label:t("security.high")||"High"},{value:"medium",label:t("security.medium")||"Medium"},{value:"low",label:t("security.low")||"Low"}],N=a.useCallback(async()=>{n(!0),g(null);try{const u=await L("ipc_config_get",{key:"alert_rules"});if(u&&"data"in u&&u.data){const o=u.data.rules;Array.isArray(o)?b(o):b(T())}else b(T())}catch{b(T())}finally{n(!1)}},[]);a.useEffect(()=>{N()},[N]);const T=()=>[{id:"intrusion-critical",eventType:"intrusion",severity:"critical",threshold:90,enabled:!0,notifyUI:!0,notifyLog:!0},{id:"intrusion-high",eventType:"intrusion",severity:"high",threshold:70,enabled:!0,notifyUI:!0,notifyLog:!0},{id:"anomaly-critical",eventType:"anomaly",severity:"critical",enabled:!0,notifyUI:!0,notifyLog:!0}],_=(u,o,C)=>{b(i=>i.map(w=>w.id===u?{...w,[o]:C}:w))},E=()=>{const u={id:`rule-${Date.now()}`,eventType:"intrusion",severity:"medium",enabled:!0,notifyUI:!0,notifyLog:!0};b(o=>[...o,u])},p=u=>{b(o=>o.filter(C=>C.id!==u))},c=async()=>{m(!0),g(null),y(null);try{await L("ipc_config_set",{key:"alert_rules",value:JSON.stringify(j)}),y(t("alertSettings.saveSuccess")||"Alert settings saved successfully"),s({message:t("alertSettings.saveSuccess")||"Alert settings saved successfully",severity:"success"}),setTimeout(()=>y(null),3e3)}catch(u){const o=u instanceof Error?u.message:t("alertSettings.saveError")||"Failed to save alert settings";g(o),s({message:o,severity:"error"})}finally{m(!1)}};return r?e.jsx("div",{className:"alert-settings",children:e.jsx(R,{message:t("common.loading")||"Loading..."})}):e.jsxs("div",{className:"alert-settings",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:t("alertSettings.title")||"Alert Settings"}),e.jsxs("div",{className:"page-actions",children:[e.jsx("button",{className:"button-secondary",onClick:E,children:t("alertSettings.addRule")||"Add Rule"}),e.jsx("button",{className:"button-primary",onClick:c,disabled:l,children:l?t("common.saving")||"Saving...":t("common.save")||"Save"})]})]}),d&&e.jsx(O,{message:d,onDismiss:()=>g(null)}),f&&e.jsx(z,{message:f,onDismiss:()=>y(null)}),e.jsxs("div",{className:"alert-settings-content",children:[e.jsx("p",{className:"page-description",children:t("alertSettings.description")||"Configure alert rules for security events. Alerts can be displayed as UI notifications or logged to the audit log."}),j.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:t("alertSettings.noRules")||"No alert rules configured"}),e.jsx("button",{className:"button-primary",onClick:E,children:t("alertSettings.addFirstRule")||"Add First Rule"})]}):e.jsx("div",{className:"rules-list",children:j.map(u=>e.jsxs("div",{className:"rule-card",children:[e.jsxs("div",{className:"rule-header",children:[e.jsxs("h3",{children:[P.find(o=>o.value===u.eventType)?.label||u.eventType," -"," ",S.find(o=>o.value===u.severity)?.label||u.severity]}),e.jsx("button",{className:"button-danger-small",onClick:()=>p(u.id),children:t("common.delete")||"Delete"})]}),e.jsxs("div",{className:"rule-fields",children:[e.jsx("div",{className:"form-field",children:e.jsxs("label",{children:[t("alertSettings.eventType")||"Event Type",e.jsx("select",{value:u.eventType,onChange:o=>_(u.id,"eventType",o.target.value),children:P.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]})}),e.jsx("div",{className:"form-field",children:e.jsxs("label",{children:[t("alertSettings.severity")||"Severity",e.jsx("select",{value:u.severity,onChange:o=>_(u.id,"severity",o.target.value),children:S.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]})}),u.eventType==="intrusion"&&e.jsx("div",{className:"form-field",children:e.jsxs("label",{children:[t("alertSettings.threshold")||"Threshold",e.jsx("input",{type:"number",value:u.threshold||"",onChange:o=>_(u.id,"threshold",parseInt(o.target.value,10)||void 0),min:0,max:100})]})}),e.jsx("div",{className:"form-field checkbox-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:u.enabled,onChange:o=>_(u.id,"enabled",o.target.checked)}),t("alertSettings.enabled")||"Enabled"]})}),e.jsx("div",{className:"form-field checkbox-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:u.notifyUI,onChange:o=>_(u.id,"notifyUI",o.target.checked)}),t("alertSettings.notifyUI")||"Show UI Notification"]})}),e.jsx("div",{className:"form-field checkbox-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:u.notifyLog,onChange:o=>_(u.id,"notifyLog",o.target.checked)}),t("alertSettings.notifyLog")||"Log to Audit Log"]})})]})]},u.id))})]})]})},Ss=[{path:"/",element:e.jsx($,{children:e.jsx(vt,{})})},{path:"/chat/tester",element:e.jsx($,{children:e.jsx(It,{})})},{path:"/security/events",element:e.jsx($,{children:e.jsx(ls,{})})},{path:"/security/ip-blocklist",element:e.jsx($,{children:e.jsx(is,{})})},{path:"/security/ip-whitelist",element:e.jsx($,{children:e.jsx(os,{})})},{path:"/settings",element:e.jsx($,{children:e.jsx(cs,{})})},{path:"/models/profiles",element:e.jsx($,{children:e.jsx(fs,{})})},{path:"/models/comparison",element:e.jsx($,{children:e.jsx(xs,{})})},{path:"/setup",element:e.jsx($,{children:e.jsx(ds,{})})},{path:"/settings/alerts",element:e.jsx($,{children:e.jsx(bs,{})})}];class Ns extends a.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){this.setState({errorInfo:r}),this.props.onError&&this.props.onError(s,r)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const s=this.state.error?.message||"予期しないエラーが発生しました",r=this.state.errorInfo?.componentStack?`Component Stack:
${this.state.errorInfo.componentStack}`:void 0;return e.jsxs("div",{className:"error-boundary",children:[e.jsx(O,{message:s,details:r,onDismiss:this.handleReset}),e.jsx("div",{className:"error-boundary-actions",children:e.jsx("button",{className:"button-primary",onClick:this.handleReset,children:"再試行"})})]})}return this.props.children}}const Cs=()=>e.jsx("div",{className:"page-loading",children:e.jsx("p",{children:"読み込み中..."})});function ks(){const t=Te([...Ss,{path:"*",element:e.jsx(_e,{to:"/",replace:!0})}]),s=(r,n)=>{q.error("Application error caught by ErrorBoundary:",r,n)};return e.jsx(Ns,{onError:s,children:e.jsxs("div",{className:"app",children:[e.jsx(a.Suspense,{fallback:e.jsx(Cs,{}),children:t}),e.jsx(js,{})]})})}De.createRoot(document.getElementById("root")).render(e.jsx(W.StrictMode,{children:e.jsx(Ae,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(dt,{children:e.jsx(it,{children:e.jsx(ks,{})})})})}));typeof window<"u"&&window.dispatchEvent(new Event("flm-app-initialized"));
